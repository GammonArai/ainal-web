# Vercelで動作する予約Botの仕組み

## 🎯 実装のポイント

### 1. ステートレス設計
- セッション管理なし
- 各メッセージで完結する処理
- コールバックデータに状態を含める

### 2. 10秒制限対策
- 複雑な処理を避ける
- データベースアクセスを最小限に
- タイムアウト処理を実装（9秒）

### 3. 予約フロー

```
ユーザー                  Bot
  │                      │
  ├─ /start ─────────────▶│
  │◀──── メニューボタン ────┤
  │                      │
  ├─ 「予約する」クリック ──▶│
  │◀─── サービス一覧 ──────┤
  │                      │
  ├─ サービス選択 ────────▶│
  │◀──── 日付選択 ────────┤
  │                      │
  ├─ 日付選択 ──────────▶│
  │◀──── 時間選択 ────────┤
  │                      │
  ├─ 時間選択 ──────────▶│
  │◀──── ホテル選択 ──────┤
  │                      │
  ├─ ホテル選択 ─────────▶│
  │◀──── 確認画面 ────────┤
  │                      │
  ├─ 確定ボタン ─────────▶│
  │◀─ 連絡先入力案内 ─────┤
  │                      │
  ├─ 連絡先送信 ─────────▶│
  │◀──── 完了メッセージ ───┤
```

## 📱 実際の動作

### スタート画面
```
🌸 愛なるマッサージへようこそ！

福岡市内の出張マッサージ・アカスリ専門店です。
完全予約制・女性セラピストが真心込めて施術いたします。

📍 対応エリア：中洲・博多・天神
⏰ 営業時間：10:00〜26:00
💳 お支払い：現金のみ

[📅 予約する] [ℹ️ 料金表] [📞 お問い合わせ]
```

### サービス選択
```
施術メニューをお選びください：

[オイルマッサージ90分 25,000円]
[オイルマッサージ120分 30,000円]
[アロママッサージ90分 28,000円]
[アロママッサージ120分 33,000円]
[アカスリ60分 20,000円]
[アカスリ+オイル120分 35,000円]
```

### 予約確認
```
📋 **ご予約内容の確認**

• サービス: オイルマッサージ90分
• 料金: 25,000円
• 日付: 本日
• 時間: 20:00-22:00
• 場所: 中洲エリアのホテル

こちらの内容でよろしいですか？

[✅ 確定する] [❌ キャンセル]
```

## 🔧 技術的な工夫

### 1. コールバックデータの活用
```javascript
// データを連結して状態を保持
`hotel:${hotelIndex}:${timeIndex}:${date}:${serviceId}`
```

### 2. インラインキーボード
- 直感的な操作
- ミスタップ防止
- 状態管理不要

### 3. エラーハンドリング
- 9秒でタイムアウト
- Telegramには常に200を返す
- ユーザーにはフレンドリーなメッセージ

## 📊 制限事項と対策

### 制限事項
- 複雑な条件分岐は困難
- リアルタイムの空き状況確認は別途API必要
- 決済処理は外部サービス連携必須

### 対策
- シンプルな選択式UI
- 最終確認は人間が行う
- 複雑な処理は管理画面で

## 🚀 拡張案

### Phase 1（現在）
- 基本的な予約フロー
- 固定メニュー・時間帯

### Phase 2
- 空き状況API連携
- リマインダー機能
- キャンセル機能

### Phase 3
- 決済連携
- ポイントシステム
- レビュー機能

## 💡 まとめ

Vercelでも工夫次第で実用的な予約Botが作れます！

- ✅ 10秒以内で処理完了
- ✅ ステートレスな設計
- ✅ ユーザーフレンドリーなUI
- ✅ 実用的な予約機能

より高度な機能が必要になったら、RailwayやVPSへの移行を検討しましょう。