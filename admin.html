<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理者ダッシュボード | 愛なるマッサージ</title>
    <meta name="description" content="愛なるマッサージの管理者ダッシュボード。予約管理、売上分析、スタッフ管理を効率的に行えます。">
    
    <!-- ファビコン -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/images/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/images/android-chrome-512x512.png">
    
    <link rel="stylesheet" href="modern-styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --admin-primary: #1a1b3a;
            --admin-secondary: #2d2f4f;
            --admin-accent: #6366f1;
            --admin-success: #10b981;
            --admin-warning: #f59e0b;
            --admin-danger: #ef4444;
            --admin-sidebar: #0f0f23;
            --admin-border: #e2e8f0;
            --admin-light-bg: #f8fafc;
            --admin-card-bg: #ffffff;
            --admin-hover: #f1f5f9;
            --gradient-admin: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            --gradient-warning: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-info: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --shadow-soft: 0 2px 10px rgba(0, 0, 0, 0.04);
            --shadow-medium: 0 4px 25px rgba(0, 0, 0, 0.08);
            --shadow-strong: 0 8px 30px rgba(0, 0, 0, 0.12);
            --border-radius: 16px;
            --border-radius-small: 12px;
            --border-radius-large: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--admin-light-bg);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .admin-layout {
            display: flex;
            min-height: 100vh;
            background: var(--admin-light-bg);
        }

        .admin-sidebar {
            width: 280px;
            background: var(--admin-sidebar);
            color: white;
            padding: 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .admin-logo {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-8);
            padding: var(--space-8) var(--space-6) var(--space-6);
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .admin-logo i {
            font-size: 2.2rem;
            background: var(--gradient-admin);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .admin-logo h1 {
            font-size: 1.4rem;
            font-weight: 700;
            color: white;
            margin: 0;
            background: linear-gradient(135deg, #ffffff 0%, #e2e8f0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .admin-nav {
            list-style: none;
            margin: 0;
            padding: var(--space-4) var(--space-3);
        }

        .admin-nav-item {
            margin-bottom: var(--space-1);
        }

        .admin-nav-link {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-4) var(--space-4);
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            border-radius: var(--border-radius-small);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            font-size: 0.95rem;
            position: relative;
            overflow: hidden;
        }

        .admin-nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient-admin);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }

        .admin-nav-link:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            transform: translateX(4px);
            box-shadow: var(--shadow-soft);
        }

        .admin-nav-link.active {
            background: var(--gradient-admin);
            color: white;
            box-shadow: var(--shadow-medium);
            transform: translateX(6px);
        }

        .admin-nav-link.active::before {
            opacity: 1;
        }

        .admin-nav-link i {
            width: 24px;
            text-align: center;
            font-size: 1.1rem;
        }

        .admin-main {
            flex: 1;
            margin-left: 280px;
            padding: var(--space-8);
            min-height: 100vh;
        }

        .admin-header {
            background: var(--admin-card-bg);
            padding: var(--space-8);
            border-radius: var(--border-radius-large);
            box-shadow: var(--shadow-soft);
            margin-bottom: var(--space-8);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(99, 102, 241, 0.1);
            position: relative;
            overflow: hidden;
        }

        .admin-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-admin);
        }

        .admin-title {
            font-size: 2.2rem;
            font-weight: 800;
            background: var(--gradient-admin);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .admin-title i {
            font-size: 2rem;
            background: var(--gradient-admin);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .admin-user {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .admin-avatar {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-8);
        }

        .stat-card {
            background: var(--admin-card-bg);
            padding: var(--space-8);
            border-radius: var(--border-radius-large);
            box-shadow: var(--shadow-soft);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(99, 102, 241, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-strong);
            border-color: rgba(99, 102, 241, 0.2);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-admin);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-card.revenue::before { background: var(--gradient-success); }
        .stat-card.bookings::before { background: var(--gradient-info); }
        .stat-card.customers::before { background: var(--gradient-warning); }
        .stat-card.therapists::before { background: var(--gradient-admin); }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-6);
        }

        .stat-icon {
            width: 64px;
            height: 64px;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .stat-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: inherit;
            opacity: 0.1;
            backdrop-filter: blur(10px);
        }

        .stat-icon.revenue { background: var(--gradient-success); }
        .stat-icon.bookings { background: var(--gradient-info); }
        .stat-icon.customers { background: var(--admin-warning); }
        .stat-icon.therapists { background: var(--accent-purple); }

        .stat-value {
            font-size: 2.8rem;
            font-weight: 900;
            background: var(--gradient-admin);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
            margin-bottom: var(--space-2);
            font-family: 'Inter', sans-serif;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.95rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            opacity: 0.8;
        }

        .stat-change {
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        .stat-change.positive { color: var(--admin-success); }
        .stat-change.negative { color: var(--admin-danger); }

        .admin-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--space-8);
            margin-bottom: var(--space-8);
        }

        .admin-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: var(--border-radius-large);
            box-shadow: var(--shadow-soft);
            overflow: hidden;
            border: 1px solid rgba(99, 102, 241, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
            position: relative;
        }

        .admin-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-admin);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s ease;
            z-index: 1;
        }

        .admin-card:hover {
            box-shadow: var(--shadow-strong);
            border-color: rgba(99, 102, 241, 0.3);
            transform: translateY(-4px);
            background: rgba(255, 255, 255, 1);
        }

        .admin-card:hover::before {
            transform: scaleX(1);
        }

        .admin-card-header {
            padding: var(--space-8);
            border-bottom: 1px solid rgba(99, 102, 241, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(99, 102, 241, 0.02);
        }

        .admin-card-title {
            font-size: 1.35rem;
            font-weight: 700;
            background: var(--gradient-admin);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .admin-card-title i {
            font-size: 1.2rem;
            background: var(--gradient-admin);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .admin-card-content {
            padding: var(--space-8);
            background: var(--admin-card-bg);
        }

        .booking-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .booking-item {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            padding: var(--space-4);
            border-bottom: 1px solid var(--admin-border);
            transition: background 0.3s ease;
        }

        .booking-item:hover {
            background: #f8fafc;
        }

        .booking-item:last-child {
            border-bottom: none;
        }

        .booking-avatar {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            flex-shrink: 0;
        }

        .booking-info {
            flex: 1;
        }

        .booking-customer {
            font-weight: 600;
            color: var(--admin-primary);
            margin-bottom: var(--space-1);
        }

        .booking-details {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .booking-status {
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .booking-status.confirmed {
            background: rgba(16, 185, 129, 0.1);
            color: var(--admin-success);
        }

        .booking-status.pending {
            background: rgba(245, 158, 11, 0.1);
            color: var(--admin-warning);
        }

        .booking-status.completed {
            background: rgba(14, 165, 233, 0.1);
            color: var(--admin-accent);
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-4);
        }

        .quick-action {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-4);
            background: rgba(99, 102, 241, 0.05);
            border-radius: var(--border-radius);
            text-decoration: none;
            color: var(--admin-primary);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(99, 102, 241, 0.1);
            position: relative;
            overflow: hidden;
        }

        .quick-action::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .quick-action:hover {
            background: rgba(99, 102, 241, 0.1);
            transform: translateY(-3px);
            border-color: rgba(99, 102, 241, 0.2);
            box-shadow: var(--shadow-medium);
        }

        .quick-action:hover::before {
            left: 100%;
        }

        .action-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .action-text {
            font-weight: 600;
        }

        .chart-container {
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            background: #f8fafc;
            border-radius: var(--radius-lg);
            margin: var(--space-6) 0;
        }

        .therapist-schedule {
            margin-top: var(--space-6);
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: var(--space-2);
            margin-top: var(--space-4);
        }

        .schedule-day {
            text-align: center;
            padding: var(--space-2);
            border-radius: var(--radius-md);
            font-size: 0.9rem;
        }

        .schedule-day.header {
            font-weight: 600;
            color: var(--admin-primary);
        }

        .schedule-day.available {
            background: rgba(16, 185, 129, 0.1);
            color: var(--admin-success);
        }

        .schedule-day.busy {
            background: rgba(239, 68, 68, 0.1);
            color: var(--admin-danger);
        }

        .schedule-day.off {
            background: #f1f5f9;
            color: var(--text-muted);
        }

        .notification-item {
            display: flex;
            align-items: flex-start;
            gap: var(--space-3);
            padding: var(--space-4);
            border-bottom: 1px solid var(--admin-border);
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-icon {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-top: var(--space-2);
            flex-shrink: 0;
        }

        .notification-icon.new { background: var(--admin-accent); }
        .notification-icon.urgent { background: var(--admin-danger); }
        .notification-icon.info { background: var(--admin-warning); }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            color: var(--admin-primary);
            margin-bottom: var(--space-1);
        }

        .notification-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: var(--space-1);
        }

        .notification-time {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* ボタンスタイル */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-4) var(--space-6);
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.95rem;
            position: relative;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--gradient-admin);
            color: white;
            box-shadow: var(--shadow-soft);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-strong);
        }

        .btn-secondary {
            background: var(--gradient-info);
            color: white;
            box-shadow: var(--shadow-soft);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-strong);
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
            box-shadow: var(--shadow-soft);
        }

        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-strong);
        }

        .btn-danger {
            background: var(--gradient-warning);
            color: white;
            box-shadow: var(--shadow-soft);
        }

        .btn-danger:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-strong);
        }

        .btn-outline {
            background: transparent;
            color: var(--admin-accent);
            border: 2px solid var(--admin-accent);
            box-shadow: none;
        }

        .btn-outline:hover {
            background: var(--admin-accent);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .btn-small {
            padding: var(--space-2) var(--space-4);
            font-size: 0.85rem;
            border-radius: var(--border-radius-small);
        }

        .btn-large {
            padding: var(--space-5) var(--space-8);
            font-size: 1.1rem;
            border-radius: var(--border-radius-large);
        }

        /* フォーム要素スタイル */
        input, textarea, select {
            padding: var(--space-4);
            border: 2px solid rgba(99, 102, 241, 0.1);
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            transition: all 0.3s ease;
            background: var(--admin-card-bg);
            font-family: 'Inter', sans-serif;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--admin-accent);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            background: white;
        }

        /* ステータスバッジ */
        .status-badge {
            padding: var(--space-1) var(--space-3);
            border-radius: var(--border-radius-small);
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-pending { 
            background: rgba(245, 158, 11, 0.15); 
            color: var(--admin-warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        .status-approved { 
            background: rgba(16, 185, 129, 0.15); 
            color: var(--admin-success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .status-rejected { 
            background: rgba(239, 68, 68, 0.15); 
            color: var(--admin-danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* グリッドレイアウト */
        .grid {
            display: grid;
            gap: var(--space-6);
        }

        .grid-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-4 { grid-template-columns: repeat(4, 1fr); }

        /* アニメーション */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }

        /* スクロールバー */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(99, 102, 241, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gradient-admin);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--admin-accent);
        }

        /* レスポンシブデザイン */
        @media (max-width: 1024px) {
            .admin-sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                z-index: 1001;
            }

            .admin-sidebar.open {
                transform: translateX(0);
            }

            .admin-main {
                margin-left: 0;
                padding: var(--space-6);
            }

            .admin-grid {
                grid-template-columns: 1fr;
            }

            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: var(--space-4);
            }

            .admin-main {
                padding: var(--space-4);
            }

            .admin-header {
                padding: var(--space-6);
                flex-direction: column;
                gap: var(--space-4);
                text-align: center;
            }

            .admin-title {
                font-size: 1.8rem;
            }

            .btn-large {
                padding: var(--space-4) var(--space-6);
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .admin-title {
                font-size: 1.6rem;
            }

            .admin-card-header {
                padding: var(--space-6);
            }

            .admin-card-content {
                padding: var(--space-6);
            }
        }
    </style>
</head>
<body class="modern-massage">
    <div class="admin-layout">
        <!-- サイドバー -->
        <aside class="admin-sidebar" id="admin-sidebar">
            <div class="admin-logo">
                <i class="fas fa-spa"></i>
                <h1>愛なるマッサージ</h1>
            </div>

            <nav>
                <ul class="admin-nav">
                    <li class="admin-nav-item">
                        <a href="#dashboard" class="admin-nav-link active">
                            <i class="fas fa-chart-line"></i>
                            ダッシュボード
                        </a>
                    </li>
                    <li class="admin-nav-item">
                        <a href="#bookings" class="admin-nav-link">
                            <i class="fas fa-calendar-alt"></i>
                            予約管理
                        </a>
                    </li>
                    <li class="admin-nav-item">
                        <a href="#customers" class="admin-nav-link" onclick="showCustomers()">
                            <i class="fas fa-users"></i>
                            顧客・会員・NG客管理
                        </a>
                    </li>
                    <li class="admin-nav-item">
                        <a href="#staff-management" class="admin-nav-link" onclick="showStaffManagement()">
                            <i class="fas fa-user-friends"></i>
                            スタッフ総合管理
                        </a>
                    </li>
                    <li class="admin-nav-item">
                        <a href="#financial-management" class="admin-nav-link" onclick="showFinancialManagement()">
                            <i class="fas fa-chart-line"></i>
                            財務管理
                        </a>
                    </li>
                    <li class="admin-nav-item">
                        <a href="#payment-requests" class="admin-nav-link" onclick="showPaymentRequests()">
                            <i class="fas fa-qrcode"></i>
                            支払い請求
                        </a>
                    </li>
                    <li class="admin-nav-item">
                        <a href="#content-management" class="admin-nav-link" onclick="showContentManagement()">
                            <i class="fas fa-edit"></i>
                            コンテンツ管理
                        </a>
                    </li>
                    <li class="admin-nav-item">
                        <a href="#promotions" class="admin-nav-link">
                            <i class="fas fa-tags"></i>
                            キャンペーン
                        </a>
                    </li>
                    <li class="admin-nav-item">
                        <a href="#settings" class="admin-nav-link">
                            <i class="fas fa-cog"></i>
                            設定
                        </a>
                    </li>
                    <li class="admin-nav-item" style="margin-top: var(--space-6); border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: var(--space-6);">
                        <a href="#logout" class="admin-nav-link" onclick="logout()" style="color: #ef4444;">
                            <i class="fas fa-sign-out-alt"></i>
                            ログアウト
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- メインコンテンツ -->
        <main class="admin-main">
            <!-- ヘッダー -->
            <header class="admin-header fade-in-up">
                <h1 class="admin-title">
                    <i class="fas fa-chart-line"></i>
                    ダッシュボード
                </h1>
                <div class="admin-user">
                    <div class="admin-avatar">管</div>
                    <div>
                        <div style="font-weight: 600; color: var(--admin-primary);">管理者</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">システム管理者</div>
                    </div>
                </div>
            </header>

            <!-- 統計カード -->
            <div class="stats-grid">
                <div class="stat-card revenue fade-in-up" style="animation-delay: 0s;">
                    <div class="stat-header">
                        <div>
                            <div class="stat-value">¥245,000</div>
                            <div class="stat-label">今月の売上</div>
                        </div>
                        <div class="stat-icon revenue">
                            <i class="fas fa-yen-sign"></i>
                        </div>
                    </div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        前月比 +12.5%
                    </div>
                </div>

                <div class="stat-card bookings fade-in-up" style="animation-delay: 0.1s;">
                    <div class="stat-header">
                        <div>
                            <div class="stat-value">68</div>
                            <div class="stat-label">今月の予約数</div>
                        </div>
                        <div class="stat-icon bookings">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                    </div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        前月比 +8.2%
                    </div>
                </div>

                <div class="stat-card customers fade-in-up" style="animation-delay: 0.2s;">
                    <div class="stat-header">
                        <div>
                            <div class="stat-value">156</div>
                            <div class="stat-label">総顧客数</div>
                        </div>
                        <div class="stat-icon customers">
                            <i class="fas fa-user-plus"></i>
                        </div>
                    </div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        今月 +15名
                    </div>
                </div>

                <div class="stat-card therapists fade-in-up" style="animation-delay: 0.3s;">
                    <div class="stat-header">
                        <div>
                            <div class="stat-value">3</div>
                            <div class="stat-label">在籍スタッフ数</div>
                        </div>
                        <div class="stat-icon therapists">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                    <div class="stat-change">
                        <i class="fas fa-check"></i>
                        全員稼働中
                    </div>
                </div>
            </div>

            <!-- メインコンテンツグリッド -->
            <div class="admin-grid">
                <!-- 今日の予約 -->
                <div class="admin-card fade-in-up" style="animation-delay: 0.4s;">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">今日の予約</h3>
                        <span id="today-date" style="color: var(--text-secondary); font-size: 0.9rem;"></span>
                    </div>
                    <div class="admin-card-content">
                        <ul class="booking-list" id="today-bookings-list">
                            <!-- 今日の予約が動的に表示されます -->
                        </ul>
                        
                        <div style="margin-top: var(--space-6); padding-top: var(--space-4); border-top: 1px solid var(--admin-border);">
                            <div style="display: flex; justify-content: between; align-items: center;">
                                <span style="font-weight: 600; color: var(--admin-primary);">本日の売上予定</span>
                                <span style="font-size: 1.2rem; font-weight: 700; color: var(--admin-success);">¥45,500</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- クイックアクション & 通知 -->
                <div>
                    <div class="admin-card fade-in-up" style="margin-bottom: var(--space-6); animation-delay: 0.5s;">
                        <div class="admin-card-header">
                            <h3 class="admin-card-title">クイックアクション</h3>
                        </div>
                        <div class="admin-card-content">
                            <div class="quick-actions">
                                <a href="#" class="quick-action">
                                    <div class="action-icon">
                                        <i class="fas fa-plus"></i>
                                    </div>
                                    <div class="action-text">新規予約</div>
                                </a>
                                <a href="#" class="quick-action">
                                    <div class="action-icon">
                                        <i class="fas fa-user-plus"></i>
                                    </div>
                                    <div class="action-text">顧客追加</div>
                                </a>
                                <a href="#" class="quick-action">
                                    <div class="action-icon">
                                        <i class="fas fa-calendar"></i>
                                    </div>
                                    <div class="action-text">スケジュール</div>
                                </a>
                                <a href="#" class="quick-action">
                                    <div class="action-icon">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div class="action-text">売上レポート</div>
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="admin-card fade-in-up" style="animation-delay: 0.6s;">
                        <div class="admin-card-header">
                            <h3 class="admin-card-title">最新通知</h3>
                        </div>
                        <div class="admin-card-content">
                            <div class="notification-item">
                                <div class="notification-icon new"></div>
                                <div class="notification-content">
                                    <div class="notification-title">新規予約</div>
                                    <div class="notification-text">高橋様からマッサージ90分の予約</div>
                                    <div class="notification-time">5分前</div>
                                </div>
                            </div>
                            <div class="notification-item">
                                <div class="notification-icon urgent"></div>
                                <div class="notification-content">
                                    <div class="notification-title">キャンセル</div>
                                    <div class="notification-text">本日21:00の予約がキャンセル</div>
                                    <div class="notification-time">15分前</div>
                                </div>
                            </div>
                            <div class="notification-item">
                                <div class="notification-icon info"></div>
                                <div class="notification-content">
                                    <div class="notification-title">スタッフ出勤</div>
                                    <div class="notification-text">田中美香が出勤しました</div>
                                    <div class="notification-time">1時間前</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 売上チャート -->
            <div class="admin-card">
                <div class="admin-card-header">
                    <h3 class="admin-card-title">売上推移</h3>
                    <select style="padding: var(--space-2) var(--space-3); border: 1px solid var(--admin-border); border-radius: var(--radius-md);">
                        <option>過去7日間</option>
                        <option>過去30日間</option>
                        <option>過去3ヶ月</option>
                    </select>
                </div>
                <div class="admin-card-content">
                    <div class="chart-container">
                        <canvas id="salesChart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>

            <!-- スタッフスケジュール -->
            <div class="admin-card">
                <div class="admin-card-header">
                    <h3 class="admin-card-title">今週のスタッフスケジュール</h3>
                </div>
                <div class="admin-card-content">
                    <div class="therapist-schedule">
                        <h4 style="margin-bottom: var(--space-4); color: var(--admin-primary);">田中美香</h4>
                        <div class="schedule-grid">
                            <div class="schedule-day header">月</div>
                            <div class="schedule-day header">火</div>
                            <div class="schedule-day header">水</div>
                            <div class="schedule-day header">木</div>
                            <div class="schedule-day header">金</div>
                            <div class="schedule-day header">土</div>
                            <div class="schedule-day header">日</div>
                            <div class="schedule-day available">18-24</div>
                            <div class="schedule-day busy">19-翌2</div>
                            <div class="schedule-day available">18-24</div>
                            <div class="schedule-day available">18-24</div>
                            <div class="schedule-day busy">19-翌2</div>
                            <div class="schedule-day available">18-24</div>
                            <div class="schedule-day available">18-24</div>
                        </div>
                    </div>

                    <div class="therapist-schedule">
                        <h4 style="margin-bottom: var(--space-4); color: var(--admin-primary);">佐藤恵子</h4>
                        <div class="schedule-grid">
                            <div class="schedule-day header">月</div>
                            <div class="schedule-day header">火</div>
                            <div class="schedule-day header">水</div>
                            <div class="schedule-day header">木</div>
                            <div class="schedule-day header">金</div>
                            <div class="schedule-day header">土</div>
                            <div class="schedule-day header">日</div>
                            <div class="schedule-day busy">18-翌3</div>
                            <div class="schedule-day available">18-翌2</div>
                            <div class="schedule-day busy">18-翌3</div>
                            <div class="schedule-day available">18-翌2</div>
                            <div class="schedule-day available">18-翌2</div>
                            <div class="schedule-day available">18-翌2</div>
                            <div class="schedule-day busy">19-翌1</div>
                        </div>
                    </div>

                    <div class="therapist-schedule">
                        <h4 style="margin-bottom: var(--space-4); color: var(--admin-primary);">山田智子</h4>
                        <div class="schedule-grid">
                            <div class="schedule-day header">月</div>
                            <div class="schedule-day header">火</div>
                            <div class="schedule-day header">水</div>
                            <div class="schedule-day header">木</div>
                            <div class="schedule-day header">金</div>
                            <div class="schedule-day header">土</div>
                            <div class="schedule-day header">日</div>
                            <div class="schedule-day available">19-翌2</div>
                            <div class="schedule-day available">18-翌1</div>
                            <div class="schedule-day available">19-翌2</div>
                            <div class="schedule-day busy">20-翌3</div>
                            <div class="schedule-day available">19-翌2</div>
                            <div class="schedule-day available">19-翌2</div>
                            <div class="schedule-day available">18-翌1</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // セキュリティ設定
        const SECURITY_CONFIG = {
            sessionTimeout: 2 * 60 * 60 * 1000, // 2時間
            idleTimeout: 30 * 60 * 1000, // 30分間の無操作でタイムアウト
            checkInterval: 60 * 1000 // 1分ごとにセッションをチェック
        };

        // セッション管理
        let lastActivity = new Date().getTime();
        let sessionCheckInterval;

        // セッション検証
        function validateSession() {
            const adminSession = localStorage.getItem('adminSession');
            const sessionExpiry = parseInt(localStorage.getItem('adminSessionExpiry') || '0');
            const now = new Date().getTime();

            if (!adminSession || sessionExpiry < now) {
                // セッションが無効または期限切れ
                alert('セッションの有効期限が切れました。再度ログインしてください。');
                logout();
                return false;
            }

            // アイドルタイムアウトチェック
            if (now - lastActivity > SECURITY_CONFIG.idleTimeout) {
                alert('長時間の無操作により、セキュリティのため自動ログアウトしました。');
                logout();
                return false;
            }

            return true;
        }

        // セキュアログアウト
        function logout() {
            // セッション情報を削除
            localStorage.removeItem('adminSession');
            localStorage.removeItem('adminSessionExpiry');
            localStorage.removeItem('adminLoginTime');
            
            // アクセスログ記録
            logAccess('LOGOUT', {
                timestamp: new Date().toISOString(),
                reason: 'Manual logout'
            });
            
            // ログインページにリダイレクト
            window.location.href = 'admin-login.html';
        }

        // アクティビティ更新
        function updateActivity() {
            lastActivity = new Date().getTime();
        }

        // アクセスログ記録
        function logAccess(action, details) {
            const logs = JSON.parse(localStorage.getItem('adminAccessLogs') || '[]');
            logs.push({
                action,
                ...details
            });
            
            // 最新100件のみ保持
            if (logs.length > 100) {
                logs.splice(0, logs.length - 100);
            }
            
            localStorage.setItem('adminAccessLogs', JSON.stringify(logs));
        }

        // ページロード時の初期化
        window.addEventListener('load', function() {
            // セッション検証
            if (!validateSession()) {
                return;
            }

            // 定期的なセッションチェックを開始
            sessionCheckInterval = setInterval(validateSession, SECURITY_CONFIG.checkInterval);

            // ユーザーアクティビティの監視
            ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'].forEach(event => {
                document.addEventListener(event, updateActivity, { passive: true });
            });

            // ページ離脱時の処理
            window.addEventListener('beforeunload', function() {
                if (sessionCheckInterval) {
                    clearInterval(sessionCheckInterval);
                }
            });

            // アクセスログ記録
            logAccess('PAGE_ACCESS', {
                timestamp: new Date().toISOString(),
                page: 'admin-dashboard',
                userAgent: navigator.userAgent
            });
        });

        // Telegram Bot API設定
        const TELEGRAM_BOT_TOKEN = '8112391212:AAFL1KvxMv6C8kqVCtFCumWIfR3MxBjGhYM';
        const TELEGRAM_API_URL = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}`;

        // =============================================================================
        // 愛なるマッサージ 統一サイト設定システム (SITE_CONFIG)
        // 全ページで一貫したデザインとデータ構造を提供するための中央管理システム
        // =============================================================================
        
        const SITE_CONFIG = {
            // ブランド基本情報
            brand: {
                name: '愛なるマッサージ',
                logo: '<i class="fas fa-spa"></i> 愛なるマッサージ',
                tagline: '心と体に愛を込めた癒しの出張マッサージ・アカスリ専門店',
                description: '福岡市中洲・博多・天神エリア専門の高品質出張マッサージサービス',
                businessType: 'massage_akasuri',
                ageRestriction: 18,
                targetAudience: 'adult'
            },
            
            // 統一ナビゲーション構造
            navigation: {
                main: [
                    { title: 'ホーム', url: 'index.html', icon: 'fas fa-home' },
                    { title: '対応可能ホテル', url: 'hotels.html', icon: 'fas fa-building' },
                    { title: '施術内容', url: 'services.html', icon: 'fas fa-spa' },
                    { title: '施術者紹介', url: 'therapists.html', icon: 'fas fa-user-md' },
                    { title: '感染対策', url: 'safety.html', icon: 'fas fa-shield-virus' },
                    { title: '施術イメージ', url: 'manga.html', icon: 'fas fa-images' },
                    { title: '健康コラム', url: 'column.html', icon: 'fas fa-blog' },
                    { title: '求人情報', url: 'recruit.html', icon: 'fas fa-briefcase' }
                ],
                footer: [
                    { title: 'プライバシーポリシー', url: 'privacy.html' },
                    { title: 'ご利用規約', url: 'terms.html' },
                    { title: 'お問い合わせ', url: '#contact' }
                ]
            },
            
            // 統一デザインシステム
            design: {
                // CSS変数マッピング（modern-styles.css基準）
                colors: {
                    primary: '#6366f1',        // --accent-purple
                    primaryDark: '#1a1a1a',    // --primary-dark
                    secondary: '#06b6d4',      // --accent-cyan
                    accent: '#ec4899',         // --accent-pink
                    text: '#1a202c',           // --text-primary
                    textSecondary: '#4a5568',  // --text-secondary
                    background: '#ffffff',     // --warm-white
                    backgroundSecondary: '#f8fafc', // --light-gray
                    border: '#e2e8f0'          // --border-gray
                },
                gradients: {
                    primary: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    accent: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                    dark: 'linear-gradient(135deg, #2d3748 0%, #1a202c 100%)',
                    cyan: 'linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%)'
                },
                fonts: {
                    primary: "'Inter', 'Noto Sans JP', -apple-system, BlinkMacSystemFont, sans-serif",
                    serif: "'Playfair Display', 'Noto Serif JP', Georgia, serif"
                },
                styles: {
                    primaryCss: 'modern-styles.css',
                    components: ['premium-styles.css', 'services-styles.css'],
                    framework: 'modern'
                }
            },
            
            // 連絡先・予約システム
            contact: {
                telegram: {
                    botName: '@AnalSenseiBot',
                    url: 'https://t.me/AnalSenseiBot',
                    active: true
                },
                area: '福岡市中洲・博多・天神エリア',
                payment: {
                    methods: ['現金'],
                    phonePayment: false,
                    cashPayment: false
                },
                businessModel: 'complete_reservation', // 完全予約制
                operatingHours: null // 営業時間なし（完全予約制）
            },
            
            // SNS・外部リンク
            social: {
                twitter: {
                    handle: '@ainaru_massage',
                    url: 'https://x.com/ainaru_massage'
                }
            },
            
            // 年齢認証システム
            ageVerification: {
                required: true,
                minimumAge: 18,
                sessionDuration: 24, // 時間
                storageKey: 'ageVerified'
            },
            
            // 会員システム設定
            membership: {
                enabled: true,
                ranks: {
                    regular: { name: '通常会員', minVisits: 0, maxVisits: 4, canBookSameDay: false },
                    bronze: { name: 'ブロンズ会員', minVisits: 5, maxVisits: 14, canBookSameDay: true },
                    silver: { name: 'シルバー会員', minVisits: 15, maxVisits: 49, canBookSameDay: true },
                    gold: { name: 'ゴールド会員', minVisits: 50, maxVisits: null, canBookSameDay: true }
                }
            },
            
            // サービス設定
            services: {
                main: ['マッサージ', 'アカスリ'],
                ageRequirement: '27歳以上のセラピスト',
                outcall: true,
                location: 'hotel_outcall'
            },
            
            // システム設定
            system: {
                version: '2.1.0',
                lastUpdated: '2024-06-15',
                environment: 'production',
                dataStorage: 'localStorage',
                sessionTimeout: 30 // 分
            }
        };
        
        // SITE_CONFIGをlocalStorageに保存（他のページからアクセス可能にする）
        localStorage.setItem('siteConfig', JSON.stringify(SITE_CONFIG));
        
        // 統一ヘッダー生成関数
        function generateUnifiedHeader() {
            return `
                <header class="header">
                    <nav class="navbar">
                        <div class="nav-container">
                            <div class="nav-logo">
                                <h1>${SITE_CONFIG.brand.logo}</h1>
                            </div>
                            <ul class="nav-menu">
                                ${SITE_CONFIG.navigation.main.map(item => `
                                    <li class="nav-item">
                                        <a href="${item.url}" class="nav-link">
                                            <i class="${item.icon}"></i> ${item.title}
                                        </a>
                                    </li>
                                `).join('')}
                            </ul>
                            <div class="hamburger">
                                <span class="bar"></span>
                                <span class="bar"></span>
                                <span class="bar"></span>
                            </div>
                        </div>
                    </nav>
                </header>
            `;
        }
        
        // 統一フッター生成関数
        function generateUnifiedFooter() {
            return `
                <footer class="footer">
                    <div class="container">
                        <div class="footer-content">
                            <div class="footer-section">
                                <h3>${SITE_CONFIG.brand.name}</h3>
                                <p>${SITE_CONFIG.brand.tagline}</p>
                                <div style="margin-top: var(--space-4);">
                                    <p><i class="fab fa-telegram"></i> <a href="${SITE_CONFIG.contact.telegram.url}" target="_blank" style="color: rgba(255,255,255,0.9); text-decoration: none;">${SITE_CONFIG.contact.telegram.botName}</a></p>
                                    <p><i class="fas fa-mobile-alt"></i> ${SITE_CONFIG.contact.payment.methods.join('・')}決済のみ対応</p>
                                    <p><i class="fas fa-map-marker-alt"></i> ${SITE_CONFIG.contact.area}</p>
                                </div>
                                <div style="margin-top: var(--space-6);">
                                    <h4 style="margin-bottom: var(--space-3); font-size: 1rem;">フォローする</h4>
                                    <a href="${SITE_CONFIG.social.twitter.url}" target="_blank" style="display: inline-flex; align-items: center; gap: var(--space-2); color: rgba(255,255,255,0.7); text-decoration: none; transition: color 0.3s ease;" onmouseover="this.style.color='#1da1f2'" onmouseout="this.style.color='rgba(255,255,255,0.7)'">
                                        <i class="fab fa-x-twitter" style="font-size: 1.2rem;"></i>
                                        <span>${SITE_CONFIG.social.twitter.handle}</span>
                                    </a>
                                </div>
                            </div>
                            <div class="footer-section">
                                <h4>サービス</h4>
                                <ul>
                                    <li><a href="services.html#massage">マッサージ</a></li>
                                    <li><a href="services.html#akasuri">アカスリ</a></li>
                                    <li><a href="safety.html">感染対策</a></li>
                                </ul>
                            </div>
                            <div class="footer-section">
                                <h4>ご案内</h4>
                                <ul>
                                    ${SITE_CONFIG.navigation.footer.map(item => `
                                        <li><a href="${item.url}">${item.title}</a></li>
                                    `).join('')}
                                </ul>
                            </div>
                        </div>
                        <div class="footer-bottom">
                            <p>&copy; 2024 ${SITE_CONFIG.brand.name}. All rights reserved.</p>
                        </div>
                    </div>
                </footer>
            `;
        }

        // 管理画面データ
        let adminData = {
            bookings: [
                { id: 1, customer: '田中様', telegramId: '@tanaka_taro', service: 'マッサージ', time: '19:00-20:30', duration: '90分', hotel: 'グランドハイアット', status: 'confirmed', price: 12000, date: '2024-06-15', bookingMethod: 'telegram', therapist: '田中美香', reminderSent: false },
                { id: 2, customer: '佐藤様', telegramId: '@sato_hanako', service: 'アカスリ', time: '20:30-21:15', duration: '45分', hotel: 'ホテルオークラ', status: 'pending', price: 6000, date: '2024-06-15', bookingMethod: 'telegram', therapist: '佐藤恵子', reminderSent: false },
                { id: 3, customer: '山田様', telegramId: '@yamada_ichiro', service: 'マッサージ', time: '22:00-23:30', duration: '90分', hotel: '日航ホテル', status: 'confirmed', price: 12000, date: '2024-06-15', bookingMethod: 'telegram', therapist: '山田智子', reminderSent: false },
                { id: 4, customer: '鈴木様', telegramId: '123456789', service: 'マッサージ', time: '23:30-翌0:30', duration: '60分', hotel: 'リッチモンドホテル', status: 'completed', price: 8000, date: '2024-06-14', bookingMethod: 'phone', therapist: '田中美香', reminderSent: true }
            ],
            customers: [
                { 
                    id: 1, 
                    name: '田中太郎', 
                    phone: '090-1234-5678', 
                    email: 'tanaka@example.com', 
                    visits: 25, 
                    lastVisit: '2024-06-14',
                    membershipRank: 'silver', // bronze, silver, gold
                    membershipStartDate: '2023-08-15',
                    totalSpent: 480000,
                    canBookSameDay: true,
                    preferredTherapist: '田中美香',
                    notes: 'VIP顧客 - 特別配慮必要'
                },
                { 
                    id: 2, 
                    name: '佐藤花子', 
                    phone: '090-2345-6789', 
                    email: 'sato@example.com', 
                    visits: 3, 
                    lastVisit: '2024-06-12',
                    membershipRank: 'regular', // 5回未満は通常会員
                    membershipStartDate: '2024-05-01',
                    totalSpent: 45000,
                    canBookSameDay: false,
                    preferredTherapist: null,
                    notes: '新規顧客'
                },
                { 
                    id: 3, 
                    name: '山田一郎', 
                    phone: '090-3456-7890', 
                    email: 'yamada@example.com', 
                    visits: 55, 
                    lastVisit: '2024-06-10',
                    membershipRank: 'gold', // 50回以上でゴールド
                    membershipStartDate: '2022-12-01',
                    totalSpent: 1200000,
                    canBookSameDay: true,
                    preferredTherapist: '佐藤恵子',
                    notes: 'ゴールド会員 - 最優先対応'
                },
                { 
                    id: 4, 
                    name: '鈴木次郎', 
                    phone: '090-4567-8901', 
                    email: 'suzuki@example.com', 
                    visits: 8, 
                    lastVisit: '2024-06-13',
                    membershipRank: 'bronze', // 5-14回でブロンズ
                    membershipStartDate: '2024-03-20',
                    totalSpent: 160000,
                    canBookSameDay: true,
                    preferredTherapist: null,
                    notes: 'ブロンズ会員'
                }
            ],
            // 会員ランクシステム設定
            membershipSystem: {
                ranks: {
                    regular: {
                        name: '通常会員',
                        minVisits: 0,
                        maxVisits: 4,
                        canBookSameDay: false,
                        priority: 1,
                        benefits: ['基本サービス'],
                        color: '#6b7280'
                    },
                    bronze: {
                        name: 'ブロンズ会員',
                        minVisits: 5,
                        maxVisits: 14,
                        canBookSameDay: true,
                        priority: 2,
                        benefits: ['当日予約可能', '基本サービス'],
                        color: '#cd7f32'
                    },
                    silver: {
                        name: 'シルバー会員',
                        minVisits: 15,
                        maxVisits: 49,
                        canBookSameDay: true,
                        priority: 3,
                        benefits: ['当日予約可能', '優先予約', '特別割引'],
                        color: '#c0c0c0'
                    },
                    gold: {
                        name: 'ゴールド会員',
                        minVisits: 50,
                        maxVisits: 999,
                        canBookSameDay: true,
                        priority: 4,
                        benefits: ['当日予約可能', '最優先予約', '特別割引', 'VIP対応'],
                        color: '#ffd700'
                    }
                }
            },
            therapists: [
                { 
                    id: 1, 
                    name: '田中美香', 
                    specialty: 'アロママッサージ', 
                    description: '10年以上の経験を持つベテランセラピストです。お客様一人ひとりの体調に合わせたオーダーメイドの施術を心がけています。アロマオイルの香りでリラックスしながら、心身ともに癒やされる時間をお過ごしください。',
                    experience: '10年以上',
                    profileImage: '/images/therapists/tanaka-mika.jpg',
                    nominationFee: true,
                    status: 'active',
                    schedule: ['月','火','水','木','金'],
                    weeklySchedule: {
                        '2024-06-17': { // 月曜日
                            available: true,
                            timeSlots: ['18:00-21:00', '21:00-24:00', '24:00-03:00']
                        },
                        '2024-06-18': { // 火曜日
                            available: true,
                            timeSlots: ['19:00-22:00', '22:00-01:00']
                        },
                        '2024-06-19': { // 水曜日
                            available: true,
                            timeSlots: ['18:00-21:00', '21:00-24:00']
                        },
                        '2024-06-20': { // 木曜日
                            available: true,
                            timeSlots: ['20:00-23:00', '23:00-02:00']
                        },
                        '2024-06-21': { // 金曜日
                            available: true,
                            timeSlots: ['18:00-21:00', '21:00-24:00', '24:00-03:00']
                        },
                        '2024-06-22': { // 土曜日
                            available: false,
                            timeSlots: []
                        },
                        '2024-06-23': { // 日曜日
                            available: false,
                            timeSlots: []
                        }
                    }
                },
                { 
                    id: 2, 
                    name: '佐藤恵子', 
                    specialty: 'アカスリ・美容', 
                    description: '韓国で本格的なアカスリ技術を習得しました。美肌効果抜群のアカスリで、お肌をつるつるに仕上げます。美容に関するアドバイスも喜んでさせていただきます。',
                    experience: '5-10年',
                    profileImage: '/images/therapists/sato-keiko.jpg',
                    nominationFee: false,
                    status: 'active',
                    schedule: ['火','水','木','金','土','日'],
                    weeklySchedule: {
                        '2024-06-17': { // 月曜日
                            available: false,
                            timeSlots: []
                        },
                        '2024-06-18': { // 火曜日
                            available: true,
                            timeSlots: ['19:00-22:00', '22:00-01:00']
                        },
                        '2024-06-19': { // 水曜日
                            available: true,
                            timeSlots: ['18:00-21:00', '21:00-24:00', '24:00-03:00']
                        },
                        '2024-06-20': { // 木曜日
                            available: true,
                            timeSlots: ['19:00-22:00', '22:00-01:00']
                        },
                        '2024-06-21': { // 金曜日
                            available: true,
                            timeSlots: ['18:00-21:00', '21:00-24:00']
                        },
                        '2024-06-22': { // 土曜日
                            available: true,
                            timeSlots: ['18:00-21:00', '21:00-24:00', '24:00-03:00']
                        },
                        '2024-06-23': { // 日曜日
                            available: true,
                            timeSlots: ['18:00-21:00', '21:00-24:00']
                        }
                    }
                }
            ],
            services: [
                { 
                    id: 1, 
                    name: 'マッサージ60分', 
                    price: 15000, 
                    category: 'massage',
                    duration: 60,
                    description: '基本内容にハンドマッサージをお付けできます',
                    options: ['ハンドマッサージ付き']
                },
                { 
                    id: 2, 
                    name: 'マッサージ90分', 
                    price: 20000, 
                    category: 'massage',
                    duration: 90,
                    description: '基本内容にハンドマッサージをお付けできます',
                    options: ['ハンドマッサージ付き']
                },
                { 
                    id: 3, 
                    name: 'マッサージ120分', 
                    price: 30000, 
                    category: 'massage',
                    duration: 120,
                    description: '基本内容にハンドマッサージをお付けできます',
                    options: ['ハンドマッサージ付き']
                },
                { 
                    id: 4, 
                    name: '2名対応 90分', 
                    price: 35000, 
                    category: 'couple',
                    duration: 90,
                    description: '2名同時施術対応',
                    capacity: 2,
                    hotelFeeMultiplier: 1.5,
                    options: ['ハンドマッサージ付き']
                },
                { 
                    id: 5, 
                    name: '2名対応 120分', 
                    price: 50000, 
                    category: 'couple',
                    duration: 120,
                    description: '2名同時施術対応',
                    capacity: 2,
                    hotelFeeMultiplier: 1.5,
                    options: ['ハンドマッサージ付き']
                }
            ],
            extensionRates: [
                { 
                    type: '1名延長30分', 
                    price: 8000, 
                    duration: 30,
                    capacity: 1
                },
                { 
                    type: '2名延長30分', 
                    price: 12000, 
                    duration: 30,
                    capacity: 2
                }
            ],
            cmsContent: {
                homepage: {
                    heroTitle: '心と体に愛を込めた癒しの出張マッサージ',
                    heroDescription: '中洲・博多エリアのホテルへお伺いして、本格的なマッサージとアカスリをご提供。プライベートな空間で、お客様だけの特別な時間をお過ごしください。',
                    phone: '092-XXXX-XXXX',
                    businessHours: '17:30 - 翌2:30'
                },
                features: [
                    { icon: 'fas fa-door-closed', title: 'ホテル出張サービス', description: 'お客様のご宿泊されているホテルへ直接お伺いいたします。プライベートな空間で、人目を気にせずリラックスしていただけます。' },
                    { icon: 'fas fa-user-md', title: '熟練の施術者', description: '経験豊富で技術力の高い施術者のみが在籍。定期研修を受けた プロフェッショナルが、お客様の体調に合わせたオーダーメイドの施術をご提供します。' },
                    { icon: 'fas fa-moon', title: '深夜営業', description: '平日は翌3時まで、週末は翌5時まで営業。お仕事が遅い方でも安心してご利用いただけます。ホテルでゆっくりと癒しのひとときを。' }
                ],
                therapists: [
                    { id: 1, name: '田中美香', specialty: 'アロママッサージ', description: '10年以上の経験を持つベテランセラピスト。お客様一人ひとりに合わせた丁寧な施術が評判です。', image: 'placeholder' },
                    { id: 2, name: '佐藤恵子', specialty: 'アカスリ・美容', description: '韓国で修行を積んだアカスリのスペシャリスト。美容効果の高い施術で多くのお客様にご愛顧いただいています。', image: 'placeholder' },
                    { id: 3, name: '山田智子', specialty: 'リラクゼーション', description: '心身のバランスを整えるホリスティックなアプローチで、深いリラクゼーションを提供します。', image: 'placeholder' }
                ]
            },
            scheduleSubmissions: [
                { id: 1, therapistId: 'TH001', therapistName: '田中美香', targetWeek: '2024-06-17〜2024-06-23', submittedAt: '2024-06-14', status: 'pending', days: ['月', '火', '木', '金'] },
                { id: 2, therapistId: 'TH002', therapistName: '佐藤恵子', targetWeek: '2024-06-17〜2024-06-23', submittedAt: '2024-06-13', status: 'approved', days: ['水', '金', '土', '日'] }
            ],
            newsletters: [
                { id: 1, title: '6月キャンペーンのお知らせ', content: '夏の疲れ解消キャンペーン開始！', status: 'sent', sentAt: '2024-06-10', recipients: 45 },
                { id: 2, title: '新メニュー追加のご案内', content: 'ホットストーンマッサージが新登場', status: 'draft', createdAt: '2024-06-12' }
            ],
            blogs: [
                { 
                    id: 1, 
                    title: 'マッサージの効果について', 
                    content: '# マッサージの効果について\n\n## 血行促進効果\n\nマッサージによる適度な刺激は血管を拡張させ、血流を改善します。これにより、酸素や栄養素が全身に効率よく運ばれ、老廃物の排出も促進されます。\n\n## ストレス軽減\n\n副交感神経を活性化させることで、心身のリラックス状態を作り出します。日常のストレスから解放され、心身ともにリフレッシュできます。\n\n## 筋肉疲労の回復\n\n筋肉の緊張をほぐし、疲労物質の蓄積を防ぎます。デスクワークによる肩こりや腰痛の改善にも効果的です。', 
                    status: 'published', 
                    publishedAt: '2024-06-01', 
                    author: 'admin', 
                    views: 234,
                    markdownFile: '/content/blogs/massage-effects.md',
                    featuredImage: '/images/blogs/massage-effects.jpg',
                    images: [
                        '/images/blogs/massage-effects.jpg',
                        '/images/blogs/massage-circulation.jpg'
                    ],
                    tags: ['マッサージ', '健康効果', 'リラクゼーション'],
                    excerpt: 'マッサージが身体に与える様々な効果について詳しく解説します。血行促進、ストレス軽減、筋肉疲労回復など...'
                },
                { 
                    id: 2, 
                    title: 'アカスリの歴史と効果', 
                    content: '# アカスリの歴史と効果\n\n## 韓国の伝統美容法\n\nアカスリは古くから韓国で親しまれてきた伝統的な美容法です。朝鮮王朝時代から続く歴史ある技術で、当時は宮廷でも行われていました。\n\n## 美肌効果\n\n### 角質除去\n古い角質を丁寧に除去することで、肌のターンオーバーを促進します。くすみが取れ、透明感のある肌を実現します。\n\n### 血行促進\n肌の表面を刺激することで血流が改善され、肌の新陳代謝が活発になります。\n\n## 現代のアカスリ\n\n伝統的な技術を現代的にアレンジし、より安全で効果的な施術を提供しています。', 
                    status: 'draft', 
                    createdAt: '2024-06-10', 
                    author: 'admin',
                    markdownFile: '/content/blogs/akasuri-history.md',
                    featuredImage: '/images/blogs/akasuri-history.jpg',
                    images: [
                        '/images/blogs/akasuri-history.jpg',
                        '/images/blogs/traditional-akasuri.jpg',
                        '/images/blogs/modern-akasuri.jpg'
                    ],
                    tags: ['アカスリ', '韓国', '美容', '歴史'],
                    excerpt: '韓国の伝統的な美容法であるアカスリの歴史と、現代における美容効果について解説します。'
                },
                { 
                    id: 3, 
                    title: '睡眠の質を向上させるマッサージ技法', 
                    content: '# 睡眠の質を向上させるマッサージ技法\n\n## 良質な睡眠の重要性\n\n現代社会において、質の高い睡眠は健康維持に欠かせません。ストレスや生活習慣の乱れにより、多くの人が睡眠に関する悩みを抱えています。\n\n## マッサージと睡眠の関係\n\n### 副交感神経の活性化\nマッサージによる適度な刺激は副交感神経を優位にし、体をリラックス状態に導きます。\n\n### メラトニン分泌の促進\nリラックス状態になることで、睡眠ホルモンであるメラトニンの分泌が促進されます。\n\n## 効果的な施術ポイント\n\n1. **首・肩周り**: 緊張をほぐし、血流を改善\n2. **足裏**: 反射区を刺激し、全身をリラックス\n3. **頭部**: 頭皮マッサージで心身の緊張を和らげる', 
                    status: 'published', 
                    publishedAt: '2024-06-05', 
                    author: 'admin', 
                    views: 189,
                    markdownFile: '/content/blogs/sleep-massage.md',
                    featuredImage: '/images/blogs/sleep-massage.jpg',
                    images: [
                        '/images/blogs/sleep-massage.jpg',
                        '/images/blogs/neck-massage.jpg',
                        '/images/blogs/foot-massage.jpg'
                    ],
                    tags: ['睡眠', 'マッサージ', '健康', 'リラクゼーション'],
                    excerpt: '質の高い睡眠を得るためのマッサージ技法について解説。副交感神経の活性化とメラトニン分泌促進について。'
                }
            ],
            members: [
                { id: 1, telegramId: '@tanaka_taro', name: '田中太郎', phone: '090-1234-5678', joinDate: '2024-05-01', visits: 5, lastVisit: '2024-06-14', lastLogin: '2024-06-14 19:30', totalSpent: 60000, status: 'active', registrationMethod: 'telegram', isOnline: false, lastSeen: '2024-06-14 20:15', 
                    identityVerification: { 
                        mynumberPhoto: 'verified', 
                        mynumberPhotoUrl: '/uploads/mynumber_tanaka_001.jpg', 
                        consentForm: 'signed', 
                        consentFormUrl: '/uploads/consent_tanaka_001.pdf', 
                        verifiedAt: '2024-05-01 14:30', 
                        verifiedBy: 'admin',
                        isFirstVisit: false
                    }
                },
                { id: 2, telegramId: '@sato_hanako', name: '佐藤花子', phone: '090-2345-6789', joinDate: '2024-04-15', visits: 3, lastVisit: '2024-06-12', lastLogin: '2024-06-12 14:20', totalSpent: 36000, status: 'active', registrationMethod: 'telegram', isOnline: true, lastSeen: '2024-06-14 21:05',
                    identityVerification: { 
                        mynumberPhoto: 'verified', 
                        mynumberPhotoUrl: '/uploads/mynumber_sato_002.jpg', 
                        consentForm: 'signed', 
                        consentFormUrl: '/uploads/consent_sato_002.pdf', 
                        verifiedAt: '2024-04-15 16:45', 
                        verifiedBy: 'admin',
                        isFirstVisit: false
                    }
                },
                { id: 3, telegramId: '@yamada_ichiro', name: '山田一郎', phone: '090-3456-7890', joinDate: '2024-03-20', visits: 8, lastVisit: '2024-06-10', lastLogin: '2024-06-10 16:45', totalSpent: 120000, status: 'vip', registrationMethod: 'telegram', isOnline: false, lastSeen: '2024-06-13 22:30',
                    identityVerification: { 
                        mynumberPhoto: 'verified', 
                        mynumberPhotoUrl: '/uploads/mynumber_yamada_003.jpg', 
                        consentForm: 'signed', 
                        consentFormUrl: '/uploads/consent_yamada_003.pdf', 
                        verifiedAt: '2024-03-20 19:15', 
                        verifiedBy: 'admin',
                        isFirstVisit: false
                    }
                },
                { id: 4, telegramId: '123456789', name: '鈴木次郎', phone: '090-4567-8901', joinDate: '2024-06-01', visits: 2, lastVisit: '2024-06-05', lastLogin: '2024-06-05 18:10', totalSpent: 16000, status: 'active', registrationMethod: 'telegram', isOnline: false, lastSeen: '2024-06-05 19:00',
                    identityVerification: { 
                        mynumberPhoto: 'verified', 
                        mynumberPhotoUrl: '/uploads/mynumber_suzuki_004.jpg', 
                        consentForm: 'signed', 
                        consentFormUrl: '/uploads/consent_suzuki_004.pdf', 
                        verifiedAt: '2024-06-01 20:00', 
                        verifiedBy: 'admin',
                        isFirstVisit: false
                    }
                },
                { id: 5, telegramId: '@test_user', name: 'テストユーザー', phone: '090-5678-9012', joinDate: '2024-06-14', visits: 1, lastVisit: '2024-06-14', lastLogin: '2024-06-14 21:00', totalSpent: 8000, status: 'active', registrationMethod: 'telegram', isOnline: true, lastSeen: '2024-06-14 21:05',
                    identityVerification: { 
                        mynumberPhoto: 'pending', 
                        mynumberPhotoUrl: null, 
                        consentForm: 'pending', 
                        consentFormUrl: null, 
                        verifiedAt: null, 
                        verifiedBy: null,
                        isFirstVisit: true
                    }
                }
            ],
            hotels: [
                { 
                    id: 1, 
                    name: 'ホテル ル・アネックス', 
                    area: '中洲', 
                    address: '福岡市博多区中洲3-5-15', 
                    phone: '092-XXX-XXXX',
                    website: 'https://hotel-annexe.jp',
                    features: ['24時間営業', '時間単位利用可', 'プライベート空間', '清潔な施設'],
                    description: '中洲エリアの時間制利用可能ホテル。24時間対応で、プライベートな空間をお得な時間単位でご利用いただけます。',
                    status: 'active', 
                    visits: 45,
                    isLoveHotel: true,
                    amenities: ['シャワー', 'タオル', 'アメニティ', '清潔なベッド']
                },
                { 
                    id: 2, 
                    name: 'ホテル ピュア中洲', 
                    area: '中洲', 
                    address: '福岡市博多区中洲4-2-8', 
                    phone: '092-XXX-XXXX',
                    website: 'https://pure-nakasu.com',
                    features: ['24時間営業', '時間単位利用可', 'プライベート空間', 'コスパ良好'],
                    description: '中洲の中心部に位置し、時間制でお得にご利用いただけるホテル。清潔で快適な空間をお約束します。',
                    status: 'active', 
                    visits: 38,
                    isLoveHotel: true,
                    amenities: ['シャワー', 'タオル', 'アメニティ', '清潔なベッド']
                },
                { 
                    id: 3, 
                    name: 'ホテル ルミエール', 
                    area: '中洲', 
                    address: '福岡市博多区中洲2-8-12', 
                    phone: '092-XXX-XXXX',
                    website: 'https://lumiere-nakasu.jp',
                    features: ['24時間営業', '時間単位利用可', 'プライベート空間', '高級感'],
                    description: '中洲エリアの上質なホテル。24時間営業で時間制利用可能。リラックスできる上質な空間をご提供します。',
                    status: 'active', 
                    visits: 28,
                    isLoveHotel: true,
                    amenities: ['シャワー', 'タオル', 'アメニティ', '清潔なベッド', '高級アメニティ']
                }
            ],
            inventory: [
                { id: 1, name: 'アロマオイル（ラベンダー）', category: 'oils', stock: 12, minStock: 5, unit: '本', price: 2500, supplier: 'アロマ商事' },
                { id: 2, name: 'マッサージタオル', category: 'linens', stock: 45, minStock: 20, unit: '枚', price: 800, supplier: 'タオル卸' },
                { id: 3, name: 'ホットストーン（小）', category: 'equipment', stock: 8, minStock: 3, unit: '個', price: 3500, supplier: 'エステ用品' },
                { id: 4, name: 'アカスリグローブ', category: 'equipment', stock: 15, minStock: 10, unit: '個', price: 1200, supplier: 'コスメ用品' }
            ],
            reviews: [
                { id: 1, customerName: '田中様', service: 'マッサージ90分', rating: 5, comment: '非常に満足しました。技術が素晴らしく、疲れが完全に取れました。', date: '2024-06-14', status: 'approved', therapist: '田中美香' },
                { id: 2, customerName: '佐藤様', service: 'アカスリ60分', rating: 4, comment: 'お肌がとても綺麗になりました。また利用したいです。', date: '2024-06-12', status: 'approved', therapist: '佐藤恵子' },
                { id: 3, customerName: '山田様', service: 'コンビネーション', rating: 5, comment: '最高のサービスでした！', date: '2024-06-10', status: 'pending', therapist: '山田智子' }
            ],
            promotions: [
                { id: 1, title: '夏の疲れ解消キャンペーン', description: '90分コース20%OFF', discount: 20, discountType: 'percentage', startDate: '2024-06-15', endDate: '2024-07-15', status: 'active', usageCount: 12, showOnHomeBanner: true, bannerColor: '#ff6b6b', bannerText: '🌟 夏の疲れを癒そう！90分コース20%OFF実施中！' },
                { id: 2, title: '初回限定特典', description: '初回ご利用50分以上で10%OFF', discount: 10, discountType: 'percentage', startDate: '2024-06-01', endDate: '2024-12-31', status: 'active', usageCount: 28, showOnHomeBanner: false, bannerColor: '#4ecdc4', bannerText: '🎉 初回限定！50分以上で10%OFF！' },
                { id: 3, title: 'リピーター感謝祭', description: '5回以上ご利用で次回1000円OFF', discount: 1000, discountType: 'fixed', startDate: '2024-07-01', endDate: '2024-07-31', status: 'scheduled', usageCount: 0, showOnHomeBanner: false, bannerColor: '#45b7d1', bannerText: '💎 リピーター様限定！次回1000円OFF' }
            ],
            services: [
                {
                    id: 1,
                    name: "アナルマッサージ（個人向け）",
                    subtitle: "初回の方におすすめの基本コース",
                    description: "経験豊富な女性セラピストによる丁寧なアナル開発マッサージ。初心者の方でも安心してお楽しみいただける優しい施術です。専用オイルとローションを使用し、段階的にリラックスしながら進めます。",
                    tags: ["初心者向け", "リラックス", "個人専用", "女性スタッフ"],
                    duration: ["45分", "60分", "90分"],
                    pricing: {
                        "45分": 25000,
                        "60分": 35000,
                        "90分": 50000
                    },
                    popular: true,
                    status: "active"
                },
                {
                    id: 2,
                    name: "カップル向けアナル講習",
                    subtitle: "パートナーと一緒に学ぶ特別コース",
                    description: "カップルでご参加いただける特別なアナル開発講習コース。パートナー同士でのより良いコミュニケーションと技術を学べます。プライベートな空間で専門知識を身につけることができます。",
                    tags: ["カップル向け", "講習", "コミュニケーション", "特別コース"],
                    duration: ["60分", "90分", "120分"],
                    pricing: {
                        "60分": 45000,
                        "90分": 65000,
                        "120分": 85000
                    },
                    popular: false,
                    status: "active"
                },
                {
                    id: 3,
                    name: "延長・追加オプション",
                    subtitle: "既存コースの延長・特別オプション",
                    description: "基本コースに追加できる延長オプションや特別メニューです。お客様のご要望に応じてカスタマイズ可能です。",
                    tags: ["延長", "オプション", "カスタマイズ"],
                    duration: ["15分延長", "30分延長", "特別オプション"],
                    pricing: {
                        "15分延長": 8000,
                        "30分延長": 15000,
                        "特別オプション": 20000
                    },
                    popular: false,
                    status: "active"
                }
            ],
            medicalEquipment: [
                {
                    id: 1,
                    name: "強酸性水生成器",
                    category: "消毒システム",
                    description: "医療現場で使用される次亜塩素酸水生成器。pH2.7以下、有効塩素濃度20-60ppmの強酸性水を生成し、細菌・ウイルス・真菌を瞬時に不活化します。",
                    imageUrl: "images/safety/acidic-water-generator.jpg",
                    features: [
                        "厚生労働省認定医療機器",
                        "99.99%除菌効果",
                        "残留性なし・安全性確認済み",
                        "院内感染対策ガイドライン準拠"
                    ],
                    specifications: "機器認定番号: 22500BZX00123000",
                    medicalGrade: true,
                    status: 'active'
                },
                {
                    id: 2,
                    name: "医療用ステンレス器具",
                    category: "施術器具",
                    description: "SUS316L医療用ステンレスを使用した挿入器具。手術用器具と同等の品質で、高い耐腐食性と生体適合性を実現しています。",
                    imageUrl: "images/safety/medical-steel-tools.jpg",
                    features: [
                        "SUS316L医療グレードステンレス",
                        "手術用器具と同等品質",
                        "高い生体適合性",
                        "オートクレーブ滅菌対応"
                    ],
                    specifications: "材質: SUS316L / 表面粗さ: Ra0.1μm以下",
                    medicalGrade: true,
                    status: 'active'
                },
                {
                    id: 3,
                    name: "医療用ラテックス手袋",
                    category: "防護用品",
                    description: "手術用と同品質の医療用ラテックス手袋。優れた感触性と強度を持ち、微細な作業にも対応可能です。",
                    imageUrl: "images/safety/medical-latex-gloves.jpg",
                    features: [
                        "手術用グレード品質",
                        "AQL1.5品質レベル",
                        "粉末不使用（パウダーフリー）",
                        "アレルギー検査済み"
                    ],
                    specifications: "EN455規格準拠 / FDA認証取得",
                    medicalGrade: true,
                    status: 'active'
                },
                {
                    id: 4,
                    name: "医療用オートクレーブ",
                    category: "滅菌装置",
                    description: "高温高圧滅菌器により、すべての器具を134℃、3気圧で完全滅菌。手術器具レベルの無菌状態を実現します。",
                    imageUrl: "images/safety/autoclave.jpg",
                    features: [
                        "クラスB規格滅菌器",
                        "134℃高温滅菌",
                        "バキューム機能付き",
                        "滅菌履歴記録システム"
                    ],
                    specifications: "滅菌条件: 134℃×3分 / EN13060準拠",
                    medicalGrade: true,
                    status: 'active'
                },
                {
                    id: 5,
                    name: "紫外線消毒庫",
                    category: "保管システム",
                    description: "UV-C紫外線による追加消毒と清潔保管。滅菌済み器具を使用直前まで清潔に保管します。",
                    imageUrl: "images/safety/uv-sterilizer.jpg",
                    features: [
                        "UV-C 253.7nm波長",
                        "99.9%追加殺菌効果",
                        "温度管理機能",
                        "自動タイマー制御"
                    ],
                    specifications: "UV出力: 30W / 有効照射距離: 1m",
                    medicalGrade: true,
                    status: 'active'
                },
                {
                    id: 6,
                    name: "使い捨て医療用シーツ",
                    category: "衛生用品",
                    description: "医療用不織布を使用した使い捨てシーツ。防水・通気性を兼ね備え、クロスコンタミネーションを完全防止します。",
                    imageUrl: "images/safety/disposable-sheets.jpg",
                    features: [
                        "医療用不織布素材",
                        "防水・通気性",
                        "使い捨てで交差感染防止",
                        "肌触り良好"
                    ],
                    specifications: "素材: SMS不織布 / 厚さ: 25g/㎡",
                    medicalGrade: true,
                    status: 'active'
                }
            ],
            // NG客管理
            ngCustomers: [
                { 
                    id: 1, 
                    name: '田中一郎', 
                    telegramId: '@ng_tanaka', 
                    phone: '090-1111-1111',
                    reason: '支払い遅延・態度不良',
                    dateAdded: '2024-06-01',
                    addedBy: '管理者',
                    severity: 'high', // low, medium, high
                    notes: '複数回の支払い遅延と施術中の不適切な発言あり',
                    status: 'active'
                },
                { 
                    id: 2, 
                    name: '佐藤次郎', 
                    telegramId: '@problem_sato', 
                    phone: '090-2222-2222',
                    reason: '無断キャンセル多発',
                    dateAdded: '2024-05-15',
                    addedBy: '管理者',
                    severity: 'medium',
                    notes: '3回連続の無断キャンセル',
                    status: 'active'
                }
            ],
            // バック率設定（キャスト別）
            therapistBackRates: [
                {
                    therapistId: 1,
                    therapistName: '田中美香',
                    baseBackRate: 50, // 基本バック率（%）
                    performanceBonus: {
                        repeatCustomers: 5, // リピート客獲得時の追加%
                        highRating: 3, // 高評価時の追加%
                        upselling: 2 // アップセル成功時の追加%
                    },
                    monthlyTarget: 600000, // 月間売上目標
                    achievementBonus: 5, // 目標達成時の追加%
                    status: 'active'
                },
                {
                    therapistId: 2,
                    therapistName: '佐藤恵子',
                    baseBackRate: 45,
                    performanceBonus: {
                        repeatCustomers: 5,
                        highRating: 3,
                        upselling: 2
                    },
                    monthlyTarget: 500000,
                    achievementBonus: 5,
                    status: 'active'
                }
            ],
            // 支払い管理（日払い・週払い）
            paymentSchedules: [
                {
                    id: 1,
                    therapistId: 1,
                    therapistName: '田中美香',
                    paymentType: 'weekly', // daily, weekly
                    paymentDay: 'friday', // monday, tuesday, ..., sunday
                    bankAccount: {
                        bankName: 'みずほ銀行',
                        branchName: '博多支店',
                        accountType: '普通',
                        accountNumber: '1234567',
                        accountHolder: 'タナカ ミカ'
                    },
                    currentBalance: 125000,
                    lastPayment: {
                        date: '2024-06-07',
                        amount: 98000,
                        status: 'completed'
                    }
                },
                {
                    id: 2,
                    therapistId: 2,
                    therapistName: '佐藤恵子',
                    paymentType: 'daily',
                    paymentDay: null,
                    bankAccount: {
                        bankName: '福岡銀行',
                        branchName: '中洲支店',
                        accountType: '普通',
                        accountNumber: '9876543',
                        accountHolder: 'サトウ ケイコ'
                    },
                    currentBalance: 45000,
                    lastPayment: {
                        date: '2024-06-14',
                        amount: 35000,
                        status: 'completed'
                    }
                }
            ],
            // 売上管理（キャスト別）
            therapistSales: [
                {
                    therapistId: 1,
                    therapistName: '田中美香',
                    monthlyData: {
                        '2024-06': {
                            totalSales: 280000,
                            completedBookings: 14,
                            averagePerBooking: 20000,
                            repeatCustomerRate: 65, // %
                            workingDays: 15,
                            dailyAverage: 18667,
                            upsellCount: 3,
                            cancellationRate: 5 // %
                        },
                        '2024-05': {
                            totalSales: 520000,
                            completedBookings: 26,
                            averagePerBooking: 20000,
                            repeatCustomerRate: 70,
                            workingDays: 22,
                            dailyAverage: 23636,
                            upsellCount: 5,
                            cancellationRate: 3
                        }
                    },
                    currentMonthTarget: 600000,
                    lastYearComparison: 15, // % increase
                    bestMonth: {
                        month: '2024-03',
                        sales: 680000
                    }
                },
                {
                    therapistId: 2,
                    therapistName: '佐藤恵子',
                    monthlyData: {
                        '2024-06': {
                            totalSales: 190000,
                            completedBookings: 12,
                            averagePerBooking: 15833,
                            repeatCustomerRate: 50,
                            workingDays: 18,
                            dailyAverage: 10556,
                            upsellCount: 1,
                            cancellationRate: 8
                        },
                        '2024-05': {
                            totalSales: 380000,
                            completedBookings: 24,
                            averagePerBooking: 15833,
                            repeatCustomerRate: 55,
                            workingDays: 20,
                            dailyAverage: 19000,
                            upsellCount: 2,
                            cancellationRate: 6
                        }
                    },
                    currentMonthTarget: 500000,
                    lastYearComparison: 8,
                    bestMonth: {
                        month: '2024-04',
                        sales: 420000
                    }
                }
            ],
            // 誕生日設定・管理
            birthdays: [
                {
                    id: 1,
                    type: 'therapist',
                    personId: 1,
                    name: '田中美香',
                    birthday: '1992-03-15',
                    age: 32,
                    zodiacSign: '魚座',
                    bloodType: 'A型',
                    gifts: [
                        { year: 2024, gift: 'フラワーアレンジメント', cost: 8000 },
                        { year: 2023, gift: 'アロマセット', cost: 12000 }
                    ],
                    preferences: ['花', 'アロマ', 'スイーツ'],
                    notificationDays: 7 // 何日前に通知するか
                },
                {
                    id: 2,
                    type: 'therapist',
                    personId: 2,
                    name: '佐藤恵子',
                    birthday: '1989-07-22',
                    age: 35,
                    zodiacSign: '蟹座',
                    bloodType: 'O型',
                    gifts: [
                        { year: 2024, gift: 'コスメセット', cost: 15000 }
                    ],
                    preferences: ['化粧品', '美容グッズ', 'ワイン'],
                    notificationDays: 7
                },
                {
                    id: 3,
                    type: 'customer',
                    personId: 1,
                    name: '田中太郎',
                    birthday: '1985-11-08',
                    age: 38,
                    zodiacSign: '蠍座',
                    bloodType: 'B型',
                    lastGift: { year: 2023, gift: 'ドリンククーポン', cost: 1000 },
                    preferences: ['ドリンク', '食事券'],
                    notificationDays: 3,
                    isVip: true
                }
            ],
            // 現金決済・売上管理システム
            paypayIntegration: {
                isEnabled: true,
                apiKey: 'pk_test_xxxxxxxxxxxxxxxxx', // テスト用APIキー
                merchantId: 'merchant_ainaru_massage',
                businessAccount: {
                    accountName: '愛なるマッサージ',
                    accountId: 'ainaru.massage.2024',
                    phone: '092-xxx-xxxx'
                },
                settings: {
                    autoCapture: true, // 自動決済
                    notificationUrl: 'https://your-domain.com/webhook/paypay',
                    returnUrl: 'https://your-domain.com/payment/success',
                    cancelUrl: 'https://your-domain.com/payment/cancel'
                }
            },
            // 現金取引履歴
            paypayTransactions: [
                {
                    id: 'pp_tx_20240615_001',
                    orderId: 'order_001',
                    customerName: '田中太郎',
                    customerId: 1,
                    therapistName: '田中美香',
                    therapistId: 1,
                    amount: 20000,
                    fee: 0, // 現金手数料なし
                    netAmount: 19400,
                    status: 'completed',
                    paymentMethod: '現金',
                    transactionDate: '2024-06-15 19:00:00',
                    completedDate: '2024-06-15 20:30:00',
                    serviceType: 'マッサージ90分',
                    location: 'グランドハイアット',
                    paypayData: {
                        transactionId: 'pp_12345678901234567890',
                        userAgent: 'CashPayment/1.0.0',
                        deviceInfo: 'iPhone'
                    }
                },
                {
                    id: 'pp_tx_20240615_002',
                    orderId: 'order_002',
                    customerName: '山田一郎',
                    customerId: 3,
                    therapistName: '佐藤恵子',
                    therapistId: 2,
                    amount: 15000,
                    fee: 450,
                    netAmount: 14550,
                    status: 'completed',
                    paymentMethod: '現金',
                    transactionDate: '2024-06-14 20:00:00',
                    completedDate: '2024-06-14 21:00:00',
                    serviceType: 'アカスリ60分',
                    location: '日航ホテル',
                    paypayData: {
                        transactionId: 'pp_09876543210987654321',
                        userAgent: 'CashPayment/1.0.0',
                        deviceInfo: 'Android'
                    }
                }
            ],
            // 売上サマリー（現金決済）
            salesSummary: {
                daily: {
                    '2024-06-15': {
                        totalRevenue: 35000,
                        totalFees: 1050,
                        netRevenue: 33950,
                        transactionCount: 2,
                        averageTransaction: 17500,
                        therapistPayouts: {
                            1: 17000, // 田中美香
                            2: 7275   // 佐藤恵子
                        }
                    },
                    '2024-06-14': {
                        totalRevenue: 28000,
                        totalFees: 840,
                        netRevenue: 27160,
                        transactionCount: 2,
                        averageTransaction: 14000,
                        therapistPayouts: {
                            1: 14000,
                            2: 13160
                        }
                    }
                },
                monthly: {
                    '2024-06': {
                        totalRevenue: 890000,
                        totalFees: 26700,
                        netRevenue: 863300,
                        transactionCount: 45,
                        averageTransaction: 19778,
                        refunds: 2,
                        refundAmount: 30000,
                        topTherapist: {
                            name: '田中美香',
                            revenue: 480000
                        }
                    }
                }
            }
        };

        // 現在のページ状態
        let currentPage = 'dashboard';

        // サイドバーの管理
        function toggleSidebar() {
            const sidebar = document.getElementById('admin-sidebar');
            sidebar.classList.toggle('open');
        }

        // ページコンテンツの表示
        function showPage(pageId) {
            currentPage = pageId;
            const mainContent = document.querySelector('.admin-main');
            
            switch(pageId) {
                case 'dashboard':
                    showDashboard();
                    break;
                case 'bookings':
                    showBookings();
                    break;
                case 'customers':
                    showCustomers();
                    break;
                case 'therapists':
                    showTherapists();
                    break;
                case 'services':
                    showServices();
                    break;
                case 'analytics':
                    showAnalytics();
                    break;
                case 'cms':
                    showCMS();
                    break;
                case 'schedule-management':
                    showScheduleManagement();
                    break;
                case 'newsletter':
                    showNewsletter();
                    break;
                case 'blog-management':
                    showBlogManagement();
                    break;
                case 'member-management':
                    showMemberManagement();
                    break;
                case 'hotel-management':
                    showHotelManagement();
                    break;
                case 'inventory':
                    showInventory();
                    break;
                case 'safety-management':
                    showSafetyManagement();
                    break;
                case 'reviews':
                    showReviews();
                    break;
                case 'promotions':
                    showPromotions();
                    break;
                case 'settings':
                    showSettings();
                    break;
            }
        }

        // ダッシュボード表示
        function showDashboard() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = getDashboardHTML();
            initializeDashboard();
        }

        // ダッシュボードHTML取得
        function getDashboardHTML() {
            return `
                <header class="admin-header">
                    <h1 class="admin-title">ダッシュボード</h1>
                    <div style="display: flex; gap: var(--space-4); align-items: center;">
                        <span style="color: var(--text-secondary); font-size: 0.9rem;">最終更新: <span id="last-update"></span></span>
                        <button class="btn btn-secondary" onclick="refreshDashboard()">
                            <i class="fas fa-sync-alt"></i> 更新
                        </button>
                    </div>
                </header>

                <!-- 統計カード -->
                <div class="stats-grid">
                    <div class="stat-card bookings fade-in-up" style="animation-delay: 0.1s;">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="total-bookings">0</div>
                                <div class="stat-label">本日の予約数</div>
                            </div>
                            <div class="stat-icon bookings">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                        </div>
                        <div class="stat-change" id="bookings-change">
                            <i class="fas fa-arrow-up"></i>
                            前日比 +2件
                        </div>
                    </div>

                    <div class="stat-card revenue fade-in-up" style="animation-delay: 0.2s;">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="total-revenue">¥0</div>
                                <div class="stat-label">本日の売上</div>
                            </div>
                            <div class="stat-icon revenue">
                                <i class="fas fa-yen-sign"></i>
                            </div>
                        </div>
                        <div class="stat-change" id="revenue-change">
                            <i class="fas fa-arrow-up"></i>
                            前日比 +15%
                        </div>
                    </div>

                    <div class="stat-card customers fade-in-up" style="animation-delay: 0.25s;">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="total-customers">0</div>
                                <div class="stat-label">総顧客数</div>
                            </div>
                            <div class="stat-icon customers">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <div class="stat-change" id="customers-change">
                            <i class="fas fa-arrow-up"></i>
                            新規 +3名
                        </div>
                    </div>

                    <div class="stat-card therapists fade-in-up" style="animation-delay: 0.3s;">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value">3</div>
                                <div class="stat-label">在籍スタッフ数</div>
                            </div>
                            <div class="stat-icon therapists">
                                <i class="fas fa-user-md"></i>
                            </div>
                        </div>
                        <div class="stat-change">
                            <i class="fas fa-check"></i>
                            全員稼働中
                        </div>
                    </div>
                </div>

                <!-- メインコンテンツグリッド -->
                <div class="admin-grid">
                    <!-- 今日の予約 -->
                    <div class="admin-card fade-in-up" style="animation-delay: 0.4s;">
                        <div class="admin-card-header">
                            <h3 class="admin-card-title">今日の予約</h3>
                            <span id="today-date" style="color: var(--text-secondary); font-size: 0.9rem;"></span>
                        </div>
                        <div class="admin-card-content">
                            <ul class="booking-list" id="today-bookings-list">
                                <!-- 今日の予約が動的に表示されます -->
                            </ul>
                            
                            <div style="margin-top: var(--space-6); padding-top: var(--space-4); border-top: 1px solid var(--admin-border);">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-weight: 600; color: var(--admin-primary);">本日の売上予定</span>
                                    <span id="today-revenue" style="font-size: 1.2rem; font-weight: 700; color: var(--admin-success);">¥0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- クイックアクション & 通知 -->
                    <div>
                        <div class="admin-card fade-in-up" style="margin-bottom: var(--space-6); animation-delay: 0.5s;">
                            <div class="admin-card-header">
                                <h3 class="admin-card-title">クイックアクション</h3>
                            </div>
                            <div class="admin-card-content">
                                <div class="quick-actions">
                                    <a href="#" class="quick-action" onclick="showBookings()">
                                        <div class="action-icon">
                                            <i class="fas fa-plus"></i>
                                        </div>
                                        <div class="action-text">新規予約</div>
                                    </a>
                                    <a href="#" class="quick-action" onclick="showCustomers()">
                                        <div class="action-icon">
                                            <i class="fas fa-user-plus"></i>
                                        </div>
                                        <div class="action-text">顧客追加</div>
                                    </a>
                                    <a href="#" class="quick-action" onclick="showTherapists()">
                                        <div class="action-icon">
                                            <i class="fas fa-calendar"></i>
                                        </div>
                                        <div class="action-text">スケジュール</div>
                                    </a>
                                    <a href="#" class="quick-action" onclick="showReports()">
                                        <div class="action-icon">
                                            <i class="fas fa-chart-line"></i>
                                        </div>
                                        <div class="action-text">売上レポート</div>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <div class="admin-card fade-in-up" style="animation-delay: 0.6s;">
                            <div class="admin-card-header">
                                <h3 class="admin-card-title">最新通知</h3>
                            </div>
                            <div class="admin-card-content" id="notifications-list">
                                <!-- 通知が動的に表示されます -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 売上チャート -->
                <div class="admin-card fade-in-up" style="animation-delay: 0.7s;">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">売上推移</h3>
                        <select id="chart-period" onchange="updateSalesChart()" style="padding: var(--space-2) var(--space-3); border: 1px solid var(--admin-border); border-radius: var(--radius-md);">
                            <option value="7">過去7日間</option>
                            <option value="30">過去30日間</option>
                            <option value="90">過去3ヶ月</option>
                        </select>
                    </div>
                    <div class="admin-card-content">
                        <div class="chart-container">
                            <canvas id="salesChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                </div>

                <!-- スタッフスケジュール -->
                <div class="admin-card fade-in-up" style="animation-delay: 0.8s;">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">今週のスタッフスケジュール</h3>
                    </div>
                    <div class="admin-card-content" id="staff-schedule">
                        <!-- スケジュールが動的に表示されます -->
                    </div>
                </div>
            `;
        }

        // ダッシュボード初期化
        function initializeDashboard() {
            updateTodayDate();
            updateDashboardStats();
            renderTodayBookings();
            renderNotifications();
            renderStaffSchedule();
            createSalesChart();
            updateLastUpdate();
        }

        // 今日の日付更新
        function updateTodayDate() {
            const today = new Date();
            const options = { month: 'long', day: 'numeric', weekday: 'short' };
            const dateStr = today.toLocaleDateString('ja-JP', options);
            const todayDateElement = document.getElementById('today-date');
            if (todayDateElement) {
                todayDateElement.textContent = dateStr;
            }
        }

        // ダッシュボード統計更新
        function updateDashboardStats() {
            const today = new Date().toISOString().split('T')[0];
            const todayBookings = adminData.bookings.filter(b => b.date === today);
            
            // 今日の予約数
            const totalBookingsEl = document.getElementById('total-bookings');
            if (totalBookingsEl) totalBookingsEl.textContent = todayBookings.length;
            
            // 今日の売上
            const todayRevenue = todayBookings.reduce((sum, booking) => {
                return sum + (booking.amount || 0);
            }, 0);
            const totalRevenueEl = document.getElementById('total-revenue');
            if (totalRevenueEl) totalRevenueEl.textContent = `¥${todayRevenue.toLocaleString()}`;
            
            // 総顧客数
            const totalCustomersEl = document.getElementById('total-customers');
            if (totalCustomersEl) totalCustomersEl.textContent = Object.keys(memberDatabase).length;
            
            // 今日の売上予定
            const todayRevenueEl = document.getElementById('today-revenue');
            if (todayRevenueEl) todayRevenueEl.textContent = `¥${todayRevenue.toLocaleString()}`;
        }

        // 今日の予約レンダリング
        function renderTodayBookings() {
            const today = new Date().toISOString().split('T')[0];
            const todayBookings = adminData.bookings.filter(b => b.date === today);
            const listElement = document.getElementById('today-bookings-list');
            
            if (!listElement) return;
            
            if (todayBookings.length === 0) {
                listElement.innerHTML = `
                    <li style="text-align: center; padding: var(--space-8); color: var(--text-muted);">
                        <i class="fas fa-calendar-times" style="font-size: 2rem; margin-bottom: var(--space-2);"></i>
                        <p>今日の予約はありません</p>
                    </li>
                `;
                return;
            }
            
            listElement.innerHTML = todayBookings.map(booking => `
                <li class="booking-item">
                    <div class="booking-avatar">${booking.customer.charAt(0)}</div>
                    <div class="booking-info">
                        <div class="booking-customer">${booking.customer}</div>
                        <div class="booking-details">${booking.time} | ${booking.service} ${booking.duration} | ${booking.hotel}</div>
                        <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: var(--space-1);">
                            <i class="fab fa-telegram"></i> ${booking.telegramId} | 担当: ${booking.therapist}
                        </div>
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: flex-end; gap: var(--space-2);">
                        <div class="booking-status ${booking.status}">${getStatusText(booking.status)}</div>
                        <div style="display: flex; gap: var(--space-1); flex-wrap: wrap;">
                            ${booking.status === 'pending' ? `<button class="btn btn-small" onclick="confirmBooking(${booking.id})" style="font-size: 0.7rem; padding: var(--space-1) var(--space-2);"><i class="fas fa-check"></i></button>` : ''}
                            ${booking.status === 'confirmed' && !booking.reminderSent ? `<button class="btn btn-small" onclick="sendBookingReminder(${booking.id})" style="font-size: 0.7rem; padding: var(--space-1) var(--space-2);"><i class="fas fa-bell"></i></button>` : ''}
                            <button class="btn btn-small" onclick="rescheduleBooking(${booking.id})" style="font-size: 0.7rem; padding: var(--space-1) var(--space-2);"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-small btn-danger" onclick="cancelBooking(${booking.id})" style="font-size: 0.7rem; padding: var(--space-1) var(--space-2);"><i class="fas fa-times"></i></button>
                            <button class="btn btn-small" onclick="sendPersonalMessage('${booking.telegramId}', '${booking.customer}')" style="font-size: 0.7rem; padding: var(--space-1) var(--space-2);"><i class="fab fa-telegram"></i></button>
                        </div>
                    </div>
                </li>
            `).join('');
        }

        // 通知レンダリング
        function renderNotifications() {
            const notificationsEl = document.getElementById('notifications-list');
            if (!notificationsEl) return;
            
            const notifications = [
                {
                    type: 'new',
                    title: '新規予約',
                    text: '高橋様からマッサージ90分の予約',
                    time: '5分前'
                },
                {
                    type: 'urgent',
                    title: 'キャンセル',
                    text: '本日21:00の予約がキャンセル',
                    time: '15分前'
                },
                {
                    type: 'info',
                    title: 'スタッフ出勤',
                    text: '田中美香が出勤しました',
                    time: '1時間前'
                }
            ];
            
            notificationsEl.innerHTML = notifications.map(notification => `
                <div class="notification-item">
                    <div class="notification-icon ${notification.type}"></div>
                    <div class="notification-content">
                        <div class="notification-title">${notification.title}</div>
                        <div class="notification-text">${notification.text}</div>
                        <div class="notification-time">${notification.time}</div>
                    </div>
                </div>
            `).join('');
        }

        // スタッフスケジュールレンダリング
        function renderStaffSchedule() {
            const scheduleEl = document.getElementById('staff-schedule');
            if (!scheduleEl) return;
            
            const staff = [
                {
                    name: '田中美香',
                    schedule: ['18-24', '19-翌2', '18-24', '18-24', '19-翌2', '18-24', '18-24']
                },
                {
                    name: '佐藤恵子',
                    schedule: ['18-翌3', '18-翌2', '18-翌3', '18-翌2', '18-翌2', '18-翌2', '19-翌1']
                }
            ];
            
            const weekdays = ['月', '火', '水', '木', '金', '土', '日'];
            
            scheduleEl.innerHTML = staff.map(therapist => `
                <div class="therapist-schedule">
                    <h4 style="margin-bottom: var(--space-4); color: var(--admin-primary);">${therapist.name}</h4>
                    <div class="schedule-grid">
                        ${weekdays.map(day => `<div class="schedule-day header">${day}</div>`).join('')}
                        ${therapist.schedule.map((time, index) => `
                            <div class="schedule-day ${index % 2 === 0 ? 'available' : 'busy'}">${time}</div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        // 売上チャート作成
        function createSalesChart() {
            const canvas = document.getElementById('salesChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // サンプルデータ
            const data = {
                labels: ['月', '火', '水', '木', '金', '土', '日'],
                datasets: [{
                    label: '売上（円）',
                    data: [25000, 30000, 22000, 35000, 45000, 50000, 40000],
                    borderColor: '#6366f1',
                    backgroundColor: 'rgba(99, 102, 241, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            };
            
            // シンプルな線グラフを描画
            drawSimpleChart(ctx, data);
        }

        // シンプルチャート描画関数
        function drawSimpleChart(ctx, data) {
            const canvas = ctx.canvas;
            const width = canvas.width;
            const height = canvas.height;
            const padding = 40;
            
            // 背景をクリア
            ctx.clearRect(0, 0, width, height);
            
            // データの最大値を取得
            const maxValue = Math.max(...data.datasets[0].data);
            const minValue = Math.min(...data.datasets[0].data);
            const range = maxValue - minValue;
            
            // グリッド描画
            ctx.strokeStyle = '#e2e8f0';
            ctx.lineWidth = 1;
            
            // 横線
            for (let i = 0; i <= 5; i++) {
                const y = padding + (height - 2 * padding) * i / 5;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
            }
            
            // 縦線
            for (let i = 0; i < data.labels.length; i++) {
                const x = padding + (width - 2 * padding) * i / (data.labels.length - 1);
                ctx.beginPath();
                ctx.moveTo(x, padding);
                ctx.lineTo(x, height - padding);
                ctx.stroke();
            }
            
            // データ線描画
            ctx.strokeStyle = data.datasets[0].borderColor;
            ctx.fillStyle = data.datasets[0].backgroundColor;
            ctx.lineWidth = data.datasets[0].borderWidth;
            
            ctx.beginPath();
            for (let i = 0; i < data.datasets[0].data.length; i++) {
                const x = padding + (width - 2 * padding) * i / (data.datasets[0].data.length - 1);
                const y = height - padding - (height - 2 * padding) * (data.datasets[0].data[i] - minValue) / range;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // データポイント描画
            ctx.fillStyle = data.datasets[0].borderColor;
            for (let i = 0; i < data.datasets[0].data.length; i++) {
                const x = padding + (width - 2 * padding) * i / (data.datasets[0].data.length - 1);
                const y = height - padding - (height - 2 * padding) * (data.datasets[0].data[i] - minValue) / range;
                
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, 2 * Math.PI);
                ctx.fill();
            }
            
            // ラベル描画
            ctx.fillStyle = '#374151';
            ctx.font = '12px Inter';
            ctx.textAlign = 'center';
            
            for (let i = 0; i < data.labels.length; i++) {
                const x = padding + (width - 2 * padding) * i / (data.labels.length - 1);
                ctx.fillText(data.labels[i], x, height - padding + 20);
            }
        }

        // 売上チャート更新
        function updateSalesChart() {
            const period = document.getElementById('chart-period').value;
            // 期間に応じてデータを更新
            createSalesChart();
        }

        // ダッシュボード更新
        function refreshDashboard() {
            updateDashboardStats();
            renderTodayBookings();
            renderNotifications();
            updateLastUpdate();
        }

        // 最終更新時刻更新
        function updateLastUpdate() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
            const lastUpdateEl = document.getElementById('last-update');
            if (lastUpdateEl) {
                lastUpdateEl.textContent = timeStr;
            }
        }

        // 予約管理表示
        function showBookings() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header">
                    <h1 class="admin-title">予約管理</h1>
                    <button class="btn btn-primary" onclick="addNewBooking()">
                        <i class="fas fa-plus"></i> 新規予約
                    </button>
                </header>

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">予約一覧</h3>
                        <div>
                            <select id="booking-filter" onchange="filterBookings()">
                                <option value="all">すべて</option>
                                <option value="pending">待機中</option>
                                <option value="confirmed">確定</option>
                                <option value="completed">完了</option>
                            </select>
                        </div>
                    </div>
                    <div class="admin-card-content">
                        <div id="bookings-table"></div>
                    </div>
                </div>
            `;
            renderBookingsTable();
        }

        // 顧客管理表示
        function showCustomers() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header">
                    <h1 class="admin-title">顧客管理</h1>
                    <button class="btn btn-primary" onclick="addNewCustomer()">
                        <i class="fas fa-user-plus"></i> 新規顧客
                    </button>
                </header>

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">顧客一覧</h3>
                        <input type="text" placeholder="顧客検索..." id="customer-search" onkeyup="searchCustomers()">
                    </div>
                    <div class="admin-card-content">
                        <div id="customers-table"></div>
                    </div>
                </div>
            `;
            renderCustomersTable();
        }

        // スタッフ管理表示
        function showTherapists() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header">
                    <h1 class="admin-title">
                        <i class="fas fa-user-md"></i>
                        施術者管理
                    </h1>
                    <div style="display: flex; gap: var(--space-3); align-items: center;">
                        <span style="font-size: 0.9rem; color: var(--text-secondary);">
                            ${adminData.therapists.length}/3 名
                        </span>
                        <button class="btn btn-primary" onclick="addNewTherapist()" ${adminData.therapists.length >= 3 ? 'disabled' : ''}>
                            <i class="fas fa-user-plus"></i> 施術者追加
                        </button>
                    </div>
                </header>

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">施術者一覧</h3>
                        <div style="display: flex; gap: var(--space-3);">
                            <button class="btn btn-outline" onclick="bulkScheduleManagement()">
                                <i class="fas fa-calendar-week"></i> 今週スケジュール一括管理
                            </button>
                        </div>
                    </div>
                    <div class="admin-card-content">
                        <div id="therapists-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: var(--space-6);"></div>
                    </div>
                </div>

                <div class="admin-card" id="therapist-editor" style="display: none;">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title" id="therapist-editor-title">新規施術者追加</h3>
                        <button class="btn btn-outline" onclick="closeTherapistEditor()">
                            <i class="fas fa-times"></i> 閉じる
                        </button>
                    </div>
                    <div class="admin-card-content">
                        <form id="therapist-form" style="display: grid; gap: var(--space-6);">
                            <input type="hidden" id="therapist-id" value="">
                            
                            <div style="display: grid; grid-template-columns: 1fr 300px; gap: var(--space-6);">
                                <div style="display: grid; gap: var(--space-4);">
                                    <div>
                                        <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">名前 <span style="color: red;">*</span></label>
                                        <input type="text" id="therapist-name" placeholder="施術者名を入力" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);" required>
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">専門分野</label>
                                        <select id="therapist-specialty" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                                            <option value="アロママッサージ">アロママッサージ</option>
                                            <option value="アカスリ・美容">アカスリ・美容</option>
                                            <option value="リラクゼーション">リラクゼーション</option>
                                            <option value="ホットストーン">ホットストーン</option>
                                            <option value="タイ古式">タイ古式</option>
                                            <option value="オイルマッサージ">オイルマッサージ</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">自己紹介・PR文</label>
                                        <textarea id="therapist-description" rows="4" placeholder="お客様への自己紹介文やPRポイントを入力してください" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);"></textarea>
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">経験年数</label>
                                        <select id="therapist-experience" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                                            <option value="1年未満">1年未満</option>
                                            <option value="1-3年">1-3年</option>
                                            <option value="3-5年">3-5年</option>
                                            <option value="5-10年">5-10年</option>
                                            <option value="10年以上">10年以上</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">指名料金設定</label>
                                        <div style="display: flex; align-items: center; gap: var(--space-3);">
                                            <label style="display: flex; align-items: center; gap: var(--space-2);">
                                                <input type="checkbox" id="therapist-nomination-fee" onchange="toggleNominationFee()">
                                                <span>指名料金を設定する（+1,000円）</span>
                                            </label>
                                        </div>
                                        <div id="nomination-fee-note" style="display: none; margin-top: var(--space-2); padding: var(--space-3); background: rgba(99, 102, 241, 0.1); border-radius: var(--radius-md); font-size: 0.9rem; color: var(--text-secondary);">
                                            この施術者を指名すると通常料金に1,000円が追加されます
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">プロフィール画像</label>
                                    <div style="border: 2px dashed var(--border-gray); border-radius: var(--radius-md); padding: var(--space-4); text-align: center;">
                                        <input type="file" id="therapist-image" accept="image/*" style="display: none;" onchange="handleTherapistImage(this)">
                                        <div id="therapist-image-preview" style="margin-bottom: var(--space-3);">
                                            <div style="width: 200px; height: 200px; margin: 0 auto; border-radius: 50%; background: var(--light-gray); display: flex; align-items: center; justify-content: center; color: var(--text-muted);">
                                                <i class="fas fa-user" style="font-size: 3rem;"></i>
                                            </div>
                                        </div>
                                        <button type="button" class="btn btn-outline" onclick="document.getElementById('therapist-image').click()">
                                            <i class="fas fa-camera"></i> 画像選択
                                        </button>
                                        <div style="margin-top: var(--space-2); font-size: 0.8rem; color: var(--text-muted);">
                                            推奨サイズ: 400x400px以上<br>
                                            形式: JPG, PNG
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div style="border-top: 1px solid var(--border-gray); padding-top: var(--space-6);">
                                <h4 style="margin: 0 0 var(--space-4) 0; color: var(--text-primary);">今週のスケジュール設定</h4>
                                <div id="therapist-schedule-grid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: var(--space-2); margin-bottom: var(--space-4);">
                                    <div style="text-align: center; font-weight: 600; color: var(--text-primary);">月</div>
                                    <div style="text-align: center; font-weight: 600; color: var(--text-primary);">火</div>
                                    <div style="text-align: center; font-weight: 600; color: var(--text-primary);">水</div>
                                    <div style="text-align: center; font-weight: 600; color: var(--text-primary);">木</div>
                                    <div style="text-align: center; font-weight: 600; color: var(--text-primary);">金</div>
                                    <div style="text-align: center; font-weight: 600; color: var(--text-primary);">土</div>
                                    <div style="text-align: center; font-weight: 600; color: var(--text-primary);">日</div>
                                </div>
                                <div id="schedule-time-slots">
                                    <!-- スケジュールの時間スロットが動的に生成される -->
                                </div>
                            </div>

                            <div style="display: flex; gap: var(--space-3); justify-content: flex-end; padding-top: var(--space-4); border-top: 1px solid var(--border-gray);">
                                <button type="button" class="btn btn-secondary" onclick="saveTherapistDraft()">
                                    <i class="fas fa-save"></i> 下書き保存
                                </button>
                                <button type="button" class="btn btn-primary" onclick="saveTherapist()">
                                    <i class="fas fa-check"></i> 保存・公開
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            renderTherapistsGrid();
            generateWeeklyScheduleGrid();
        }

        // サービス管理表示
        function showServices() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header">
                    <h1 class="admin-title">サービス管理</h1>
                    <button class="btn btn-primary" onclick="addNewService()">
                        <i class="fas fa-plus"></i> サービス追加
                    </button>
                </header>

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">サービス一覧</h3>
                    </div>
                    <div class="admin-card-content">
                        <div id="services-table"></div>
                    </div>
                </div>
            `;
            renderServicesTable();
        }

        // 売上分析表示
        function showAnalytics() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header">
                    <h1 class="admin-title">売上分析</h1>
                    <select onchange="updateAnalytics(this.value)">
                        <option value="7">過去7日間</option>
                        <option value="30">過去30日間</option>
                        <option value="90">過去90日間</option>
                    </select>
                </header>

                <div class="stats-grid">
                    <div class="stat-card revenue">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value">¥245,000</div>
                                <div class="stat-label">総売上</div>
                            </div>
                            <div class="stat-icon revenue">
                                <i class="fas fa-yen-sign"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card bookings">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value">68</div>
                                <div class="stat-label">予約数</div>
                            </div>
                            <div class="stat-icon bookings">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">売上チャート</h3>
                    </div>
                    <div class="admin-card-content">
                        <div class="chart-container">
                            <div style="text-align: center;">
                                <i class="fas fa-chart-line" style="font-size: 3rem; color: var(--text-muted); margin-bottom: var(--space-4);"></i>
                                <p>売上データの可視化</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // CMS表示
        function showCMS() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header">
                    <h1 class="admin-title">コンテンツ管理システム (CMS)</h1>
                    <select onchange="switchCMSSection(this.value)">
                        <option value="homepage">ホームページ</option>
                        <option value="features">特徴セクション</option>
                        <option value="therapists">セラピスト紹介</option>
                        <option value="services">サービス内容</option>
                    </select>
                </header>

                <div id="cms-homepage" class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">ホームページコンテンツ</h3>
                    </div>
                    <div class="admin-card-content">
                        <div style="display: grid; gap: var(--space-6);">
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">メインタイトル</label>
                                <input type="text" id="hero-title" value="${adminData.cmsContent.homepage.heroTitle}" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">メイン説明文</label>
                                <textarea id="hero-description" rows="4" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">${adminData.cmsContent.homepage.heroDescription}</textarea>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">電話番号</label>
                                <input type="text" id="phone" value="${adminData.cmsContent.homepage.phone}" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">営業時間</label>
                                <input type="text" id="business-hours" value="${adminData.cmsContent.homepage.businessHours}" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                            </div>
                            <button class="btn btn-primary" onclick="saveCMSContent('homepage')">
                                <i class="fas fa-save"></i> ホームページを更新
                            </button>
                        </div>
                    </div>
                </div>

                <div id="cms-features" class="admin-card" style="display: none;">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">特徴セクション管理</h3>
                        <button class="btn btn-primary" onclick="addFeature()">
                            <i class="fas fa-plus"></i> 特徴を追加
                        </button>
                    </div>
                    <div class="admin-card-content">
                        <div id="features-list">
                            ${renderFeaturesList()}
                        </div>
                    </div>
                </div>

                <div id="cms-therapists" class="admin-card" style="display: none;">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">セラピスト紹介管理</h3>
                        <button class="btn btn-primary" onclick="addTherapist()">
                            <i class="fas fa-plus"></i> セラピストを追加
                        </button>
                    </div>
                    <div class="admin-card-content">
                        <div id="therapists-list">
                            ${renderTherapistsList()}
                        </div>
                    </div>
                </div>
            `;
        }

        // 出勤簿管理表示
        function showScheduleManagement() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header">
                    <h1 class="admin-title">出勤簿管理</h1>
                    <div>
                        <button class="btn btn-primary" onclick="exportSchedules()">
                            <i class="fas fa-download"></i> CSV出力
                        </button>
                    </div>
                </header>

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">提出された出勤簿</h3>
                        <select onchange="filterSchedules(this.value)">
                            <option value="all">すべて</option>
                            <option value="pending">審査待ち</option>
                            <option value="approved">承認済み</option>
                            <option value="rejected">却下</option>
                        </select>
                    </div>
                    <div class="admin-card-content">
                        <div id="schedules-table">${renderSchedulesTable()}</div>
                    </div>
                </div>

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">週次スケジュール概要</h3>
                    </div>
                    <div class="admin-card-content">
                        <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: var(--space-2); margin: var(--space-4) 0;">
                            <div style="text-align: center; font-weight: 600; padding: var(--space-2); background: var(--light-gray); border-radius: var(--radius-md);">月</div>
                            <div style="text-align: center; font-weight: 600; padding: var(--space-2); background: var(--light-gray); border-radius: var(--radius-md);">火</div>
                            <div style="text-align: center; font-weight: 600; padding: var(--space-2); background: var(--light-gray); border-radius: var(--radius-md);">水</div>
                            <div style="text-align: center; font-weight: 600; padding: var(--space-2); background: var(--light-gray); border-radius: var(--radius-md);">木</div>
                            <div style="text-align: center; font-weight: 600; padding: var(--space-2); background: var(--light-gray); border-radius: var(--radius-md);">金</div>
                            <div style="text-align: center; font-weight: 600; padding: var(--space-2); background: var(--light-gray); border-radius: var(--radius-md);">土</div>
                            <div style="text-align: center; font-weight: 600; padding: var(--space-2); background: var(--light-gray); border-radius: var(--radius-md);">日</div>
                            <div style="text-align: center; padding: var(--space-2); background: rgba(16, 185, 129, 0.1); border-radius: var(--radius-md);">田中美香</div>
                            <div style="text-align: center; padding: var(--space-2); background: rgba(16, 185, 129, 0.1); border-radius: var(--radius-md);">田中美香</div>
                            <div style="text-align: center; padding: var(--space-2); background: rgba(42, 171, 238, 0.1); border-radius: var(--radius-md);">佐藤恵子</div>
                            <div style="text-align: center; padding: var(--space-2); background: rgba(16, 185, 129, 0.1); border-radius: var(--radius-md);">田中美香</div>
                            <div style="text-align: center; padding: var(--space-2); background: rgba(42, 171, 238, 0.1); border-radius: var(--radius-md);">佐藤恵子</div>
                            <div style="text-align: center; padding: var(--space-2); background: rgba(42, 171, 238, 0.1); border-radius: var(--radius-md);">佐藤恵子</div>
                            <div style="text-align: center; padding: var(--space-2); background: rgba(42, 171, 238, 0.1); border-radius: var(--radius-md);">佐藤恵子</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ニュースレター管理表示
        function showNewsletter() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header">
                    <h1 class="admin-title">Telegramニュースレター管理</h1>
                    <button class="btn btn-primary" onclick="createNewsletter()">
                        <i class="fab fa-telegram"></i> 新規ニュースレター作成
                    </button>
                </header>

                <div class="grid grid-2" style="gap: var(--space-6);">
                    <div class="admin-card">
                        <div class="admin-card-header">
                            <h3 class="admin-card-title">ニュースレター一覧</h3>
                        </div>
                        <div class="admin-card-content">
                            <div id="newsletter-list">
                                ${renderNewsletterList()}
                            </div>
                        </div>
                    </div>

                    <div class="admin-card">
                        <div class="admin-card-header">
                            <h3 class="admin-card-title">クイック送信</h3>
                        </div>
                        <div class="admin-card-content">
                            <div style="display: grid; gap: var(--space-4);">
                                <div>
                                    <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">件名</label>
                                    <input type="text" id="quick-title" placeholder="件名を入力" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">メッセージ</label>
                                    <textarea id="quick-content" rows="8" placeholder="メッセージ内容を入力" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);"></textarea>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">送信対象</label>
                                    <select id="quick-recipients" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                                        <option value="all">全会員 (${adminData.members.length}名)</option>
                                        <option value="active">アクティブ会員のみ</option>
                                        <option value="vip">VIP会員のみ</option>
                                    </select>
                                </div>
                                <button class="btn btn-primary" onclick="sendQuickNewsletter()" style="width: 100%;">
                                    <i class="fab fa-telegram"></i> 即座にTelegram送信
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">送信統計</h3>
                    </div>
                    <div class="admin-card-content">
                        <div class="grid grid-4" style="gap: var(--space-4);">
                            <div style="text-align: center; padding: var(--space-4); background: var(--light-gray); border-radius: var(--radius-lg);">
                                <div style="font-size: 2rem; font-weight: 800; color: var(--accent-purple);">${adminData.newsletters.filter(n => n.status === 'sent').length}</div>
                                <div style="color: var(--text-secondary);">送信済み</div>
                            </div>
                            <div style="text-align: center; padding: var(--space-4); background: var(--light-gray); border-radius: var(--radius-lg);">
                                <div style="font-size: 2rem; font-weight: 800; color: var(--accent-cyan);">${adminData.newsletters.reduce((sum, n) => sum + (n.recipients || 0), 0)}</div>
                                <div style="color: var(--text-secondary);">総配信数</div>
                            </div>
                            <div style="text-align: center; padding: var(--space-4); background: var(--light-gray); border-radius: var(--radius-lg);">
                                <div style="font-size: 2rem; font-weight: 800; color: var(--accent-pink);">${adminData.members.length}</div>
                                <div style="color: var(--text-secondary);">登録会員数</div>
                            </div>
                            <div style="text-align: center; padding: var(--space-4); background: var(--light-gray); border-radius: var(--radius-lg);">
                                <div style="font-size: 2rem; font-weight: 800; color: var(--admin-success);">95%</div>
                                <div style="color: var(--text-secondary);">開封率</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // コラム管理表示
        function showBlogManagement() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header">
                    <h1 class="admin-title">
                        <i class="fas fa-blog"></i>
                        健康コラム管理
                    </h1>
                    <div style="display: flex; gap: var(--space-3); align-items: center;">
                        <span style="font-size: 0.9rem; color: var(--text-secondary);">
                            ${adminData.blogs.length}/10 記事
                        </span>
                        <button class="btn btn-primary" onclick="createBlog()" ${adminData.blogs.length >= 10 ? 'disabled' : ''}>
                            <i class="fas fa-plus"></i> 新規コラム作成
                        </button>
                    </div>
                </header>

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">コラム一覧</h3>
                        <div style="display: flex; gap: var(--space-3); align-items: center;">
                            <select onchange="filterBlogs(this.value)" style="padding: var(--space-2); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                                <option value="all">すべて (${adminData.blogs.length})</option>
                                <option value="published">公開中 (${adminData.blogs.filter(b => b.status === 'published').length})</option>
                                <option value="draft">下書き (${adminData.blogs.filter(b => b.status === 'draft').length})</option>
                            </select>
                        </div>
                    </div>
                    <div class="admin-card-content">
                        <div id="blog-list" style="display: grid; gap: var(--space-4);">
                            ${renderBlogList()}
                        </div>
                    </div>
                </div>

                <div class="admin-card" id="blog-editor" style="display: none;">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title" id="editor-title">新規コラム作成</h3>
                        <button class="btn btn-outline" onclick="closeBlogEditor()">
                            <i class="fas fa-times"></i> 閉じる
                        </button>
                    </div>
                    <div class="admin-card-content">
                        <form id="blog-form" style="display: grid; gap: var(--space-6);">
                            <input type="hidden" id="blog-id" value="">
                            
                            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--space-6);">
                                <div>
                                    <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">タイトル <span style="color: red;">*</span></label>
                                    <input type="text" id="blog-title" placeholder="コラムタイトルを入力" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);" required>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">ステータス</label>
                                    <select id="blog-status" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                                        <option value="draft">下書き</option>
                                        <option value="published">公開</option>
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">概要</label>
                                <textarea id="blog-excerpt" rows="2" placeholder="記事の概要を入力（SEO・一覧表示用）" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);"></textarea>
                            </div>

                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">タグ</label>
                                <input type="text" id="blog-tags" placeholder="タグをカンマ区切りで入力（例：マッサージ,健康,リラクゼーション）" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-4);">
                                <div>
                                    <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">Markdownファイル</label>
                                    <div style="border: 2px dashed var(--border-gray); border-radius: var(--radius-md); padding: var(--space-4); text-align: center;">
                                        <input type="file" id="markdown-file" accept=".md,.markdown" style="display: none;" onchange="handleMarkdownFile(this)">
                                        <button type="button" class="btn btn-outline" onclick="document.getElementById('markdown-file').click()">
                                            <i class="fas fa-file-text"></i> Markdownファイル選択
                                        </button>
                                        <div id="markdown-file-name" style="margin-top: var(--space-2); font-size: 0.9rem; color: var(--text-secondary);"></div>
                                    </div>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">アイキャッチ画像</label>
                                    <div style="border: 2px dashed var(--border-gray); border-radius: var(--radius-md); padding: var(--space-4); text-align: center;">
                                        <input type="file" id="featured-image" accept="image/*" style="display: none;" onchange="handleFeaturedImage(this)">
                                        <button type="button" class="btn btn-outline" onclick="document.getElementById('featured-image').click()">
                                            <i class="fas fa-image"></i> 画像選択
                                        </button>
                                        <div id="featured-image-preview" style="margin-top: var(--space-2);"></div>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">追加画像</label>
                                <div style="border: 2px dashed var(--border-gray); border-radius: var(--radius-md); padding: var(--space-4);">
                                    <input type="file" id="additional-images" accept="image/*" multiple style="display: none;" onchange="handleAdditionalImages(this)">
                                    <button type="button" class="btn btn-outline" onclick="document.getElementById('additional-images').click()">
                                        <i class="fas fa-images"></i> 複数画像選択
                                    </button>
                                    <div id="additional-images-preview" style="margin-top: var(--space-3); display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: var(--space-2);"></div>
                                </div>
                            </div>

                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">内容 (Markdown)</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-4); height: 500px;">
                                    <div>
                                        <textarea id="blog-content" placeholder="# タイトル&#10;&#10;本文をMarkdown形式で入力してください" style="width: 100%; height: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md); font-family: 'Courier New', monospace; resize: none;"></textarea>
                                    </div>
                                    <div>
                                        <div style="height: 100%; border: 1px solid var(--border-gray); border-radius: var(--radius-md); padding: var(--space-3); overflow-y: auto; background: white;">
                                            <div id="markdown-preview" style="font-family: var(--font-primary); line-height: 1.6;">
                                                <p style="color: var(--text-muted); text-align: center; margin-top: 200px;">プレビューがここに表示されます</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div style="display: flex; gap: var(--space-3); justify-content: flex-end; padding-top: var(--space-4); border-top: 1px solid var(--border-gray);">
                                <button type="button" class="btn btn-secondary" onclick="saveBlogDraft()">
                                    <i class="fas fa-save"></i> 下書き保存
                                </button>
                                <button type="button" class="btn btn-primary" onclick="publishBlog()">
                                    <i class="fas fa-paper-plane"></i> 公開
                                </button>
                                <button type="button" class="btn btn-outline" onclick="previewBlog()">
                                    <i class="fas fa-eye"></i> プレビュー
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // 会員管理表示
        function showMemberManagement() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header">
                    <h1 class="admin-title">会員管理</h1>
                    <button class="btn btn-primary" onclick="exportMembers()">
                        <i class="fas fa-download"></i> 会員データ出力
                    </button>
                </header>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value">${adminData.members.length}</div>
                                <div class="stat-label">総会員数</div>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value">${adminData.members.filter(m => m.status === 'vip').length}</div>
                                <div class="stat-label">VIP会員</div>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-crown"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value">¥${adminData.members.reduce((sum, m) => sum + m.totalSpent, 0).toLocaleString()}</div>
                                <div class="stat-label">累計売上</div>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-yen-sign"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">会員一覧</h3>
                        <div style="display: flex; gap: var(--space-3);">
                            <select onchange="filterMembers(this.value)">
                                <option value="all">すべて</option>
                                <option value="active">アクティブ</option>
                                <option value="vip">VIP</option>
                            </select>
                            <input type="text" placeholder="会員検索..." onkeyup="searchMembers(this.value)" style="padding: var(--space-2); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                        </div>
                    </div>
                    <div class="admin-card-content">
                        <div id="member-table">
                            ${renderMemberTable()}
                        </div>
                    </div>
                </div>
            `;
        }

        // ホテル管理表示
        function showHotelManagement() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header">
                    <h1 class="admin-title">対応可能ホテル管理</h1>
                    <button class="btn btn-primary" onclick="addHotel()">
                        <i class="fas fa-plus"></i> ホテル追加
                    </button>
                </header>

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">ホテル一覧</h3>
                        <select onchange="filterHotels(this.value)">
                            <option value="all">すべて</option>
                            <option value="active">対応中</option>
                            <option value="limited">要相談</option>
                        </select>
                    </div>
                    <div class="admin-card-content">
                        <div id="hotel-table">
                            ${renderHotelTable()}
                        </div>
                    </div>
                </div>

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">エリア別統計</h3>
                    </div>
                    <div class="admin-card-content">
                        <div class="grid grid-3" style="gap: var(--space-4);">
                            ${getAreaStats().map(area => `
                                <div style="text-align: center; padding: var(--space-4); background: var(--light-gray); border-radius: var(--radius-lg);">
                                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-purple);">${area.count}</div>
                                    <div style="margin: var(--space-2) 0; font-weight: 600;">${area.name}</div>
                                    <div style="font-size: 0.9rem; color: var(--text-secondary);">利用回数: ${area.visits}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // 設定表示
        function showSettings() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header">
                    <h1 class="admin-title">システム設定</h1>
                </header>

                <!-- 既存の設定内容は維持されます -->

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">基本設定</h3>
                    </div>
                    <div class="admin-card-content">
                        <div style="display: grid; gap: var(--space-6);">
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">店舗名</label>
                                <input type="text" value="愛なるマッサージ" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">電話番号</label>
                                <input type="text" value="092-XXXX-XXXX" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">営業時間</label>
                                <input type="text" value="17:30 - 翌2:30" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">Telegram Bot名</label>
                                <input type="text" value="@AnalSenseiBot" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">Telegram Bot API Token</label>
                                <input type="text" value="8112391212:AAFL1KvxMv6C8kqVCtFCumWIfR3MxBjGhYM" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md); font-family: monospace;">
                            </div>
                            <button class="btn btn-primary" onclick="saveSettings()">
                                <i class="fas fa-save"></i> 設定を保存
                            </button>
                        </div>
                    </div>
                </div>

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">セラピスト管理</h3>
                        <button class="btn btn-primary" onclick="addTherapistAccount()">
                            <i class="fas fa-user-plus"></i> アカウント追加
                        </button>
                    </div>
                    <div class="admin-card-content">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: var(--light-gray);">
                                    <th style="padding: var(--space-3); text-align: left;">ID</th>
                                    <th style="padding: var(--space-3); text-align: left;">名前</th>
                                    <th style="padding: var(--space-3); text-align: left;">専門分野</th>
                                    <th style="padding: var(--space-3); text-align: left;">ステータス</th>
                                    <th style="padding: var(--space-3); text-align: left;">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: var(--space-3);">TH001</td>
                                    <td style="padding: var(--space-3);">田中美香</td>
                                    <td style="padding: var(--space-3);">アロママッサージ</td>
                                    <td style="padding: var(--space-3);"><span style="color: var(--admin-success);">有効</span></td>
                                    <td style="padding: var(--space-3);">
                                        <button class="btn btn-small">編集</button>
                                        <button class="btn btn-small btn-danger">無効化</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // 在庫管理表示
        function showInventory() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header">
                    <h1 class="admin-title">在庫管理</h1>
                    <button class="btn btn-primary" onclick="addInventoryItem()">
                        <i class="fas fa-plus"></i> 商品追加
                    </button>
                </header>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value">${adminData.inventory.length}</div>
                                <div class="stat-label">商品アイテム数</div>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-boxes"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" style="color: var(--admin-warning);">${adminData.inventory.filter(item => item.stock <= item.minStock).length}</div>
                                <div class="stat-label">在庫不足商品</div>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value">¥${adminData.inventory.reduce((sum, item) => sum + (item.stock * item.price), 0).toLocaleString()}</div>
                                <div class="stat-label">総在庫価値</div>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-yen-sign"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">在庫一覧</h3>
                        <select onchange="filterInventory(this.value)">
                            <option value="all">すべて</option>
                            <option value="oils">オイル類</option>
                            <option value="linens">リネン類</option>
                            <option value="equipment">器具類</option>
                            <option value="low-stock">在庫不足</option>
                        </select>
                    </div>
                    <div class="admin-card-content">
                        <div id="inventory-table">
                            ${renderInventoryTable()}
                        </div>
                    </div>
                </div>

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">発注リスト</h3>
                    </div>
                    <div class="admin-card-content">
                        <div style="margin-bottom: var(--space-4);">
                            <strong style="color: var(--admin-warning);">在庫不足の商品</strong>
                        </div>
                        ${adminData.inventory.filter(item => item.stock <= item.minStock).map(item => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-3); background: rgba(245, 158, 11, 0.1); border-radius: var(--radius-md); margin-bottom: var(--space-2);">
                                <div>
                                    <strong>${item.name}</strong>
                                    <div style="font-size: 0.9rem; color: var(--text-secondary);">現在: ${item.stock}${item.unit} / 最低: ${item.minStock}${item.unit}</div>
                                </div>
                                <button class="btn btn-small btn-primary" onclick="createOrder(${item.id})">発注</button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // 感染対策管理表示
        function showSafetyManagement() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header">
                    <h1 class="admin-title">
                        <i class="fas fa-shield-virus"></i>
                        感染対策管理
                    </h1>
                    <button class="btn btn-primary" onclick="addMedicalEquipment()">
                        <i class="fas fa-plus"></i> 新規機器追加
                    </button>
                </header>

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">医療機器・感染対策用品管理</h3>
                        <div>
                            <select id="equipment-filter" onchange="filterEquipment()">
                                <option value="all">すべて</option>
                                <option value="消毒システム">消毒システム</option>
                                <option value="医療器具">医療器具</option>
                                <option value="防護用品">防護用品</option>
                                <option value="滅菌機器">滅菌機器</option>
                                <option value="その他">その他</option>
                            </select>
                        </div>
                    </div>
                    <div class="admin-card-content">
                        <div id="equipment-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: var(--space-6);"></div>
                    </div>
                </div>
            `;
            renderMedicalEquipmentGrid();
        }

        // 医療機器グリッド表示
        function renderMedicalEquipmentGrid() {
            const grid = document.getElementById('equipment-grid');
            const equipment = adminData.medicalEquipment || [];
            
            grid.innerHTML = equipment.map(item => `
                <div class="equipment-management-card" style="
                    background: white;
                    border-radius: var(--radius-xl);
                    padding: var(--space-6);
                    box-shadow: var(--shadow-md);
                    border: 2px solid transparent;
                    transition: all 0.3s ease;
                    position: relative;
                    overflow: hidden;
                ">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%);"></div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--space-4);">
                        <div style="display: flex; align-items: center; gap: var(--space-3);">
                            <div style="
                                width: 60px;
                                height: 60px;
                                background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%);
                                border-radius: 50%;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: white;
                                font-size: 1.5rem;
                            ">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div>
                                <h4 style="margin: 0; font-size: 1.2rem; font-weight: 700; color: var(--text-primary);">${item.name}</h4>
                                <span style="
                                    background: rgba(14, 165, 233, 0.1);
                                    color: #0ea5e9;
                                    padding: var(--space-1) var(--space-3);
                                    border-radius: var(--radius-full);
                                    font-size: 0.8rem;
                                    font-weight: 600;
                                ">${item.category}</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: var(--space-2);">
                            <button class="btn btn-small" onclick="editMedicalEquipment(${item.id})" style="background: #10b981; color: white;">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-small" onclick="deleteMedicalEquipment(${item.id})" style="background: #ef4444; color: white;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: var(--space-4);">
                        <img src="${item.imageUrl}" alt="${item.name}" style="
                            width: 100%;
                            height: 180px;
                            object-fit: cover;
                            border-radius: var(--radius-lg);
                            background: var(--light-gray);
                        " onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div style="
                            width: 100%;
                            height: 180px;
                            background: var(--light-gray);
                            border-radius: var(--radius-lg);
                            display: none;
                            align-items: center;
                            justify-content: center;
                            color: var(--text-muted);
                        ">
                            <i class="fas fa-image" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                    
                    <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: var(--space-4);">${item.description}</p>
                    
                    <div style="margin-bottom: var(--space-4);">
                        <h5 style="margin: 0 0 var(--space-2) 0; color: var(--text-primary); font-weight: 600;">主な特徴</h5>
                        <ul style="margin: 0; padding-left: var(--space-4); color: var(--text-secondary);">
                            ${item.features.map(feature => `<li style="margin-bottom: var(--space-1);">${feature}</li>`).join('')}
                        </ul>
                    </div>
                    
                    ${item.specifications ? `
                        <div style="background: var(--light-gray); padding: var(--space-3); border-radius: var(--radius-md); margin-bottom: var(--space-4);">
                            <small style="color: var(--text-muted); font-weight: 600;">仕様・認定情報</small>
                            <div style="color: var(--text-secondary); font-size: 0.9rem; margin-top: var(--space-1);">${item.specifications}</div>
                        </div>
                    ` : ''}
                    
                    ${item.medicalGrade ? `
                        <div style="display: flex; align-items: center; gap: var(--space-2); color: #10b981;">
                            <i class="fas fa-certificate"></i>
                            <span style="font-weight: 600; font-size: 0.9rem;">医療グレード認証済み</span>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // 医療機器追加
        function addMedicalEquipment() {
            // モーダルを開いて新規機器追加フォームを表示
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="this.remove()">
                    <div style="background: white; border-radius: var(--radius-xl); padding: var(--space-8); max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;" onclick="event.stopPropagation()">
                        <h3 style="margin: 0 0 var(--space-6) 0; color: var(--text-primary);">新規医療機器追加</h3>
                        <form id="add-equipment-form" style="display: grid; gap: var(--space-4);">
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">機器名</label>
                                <input type="text" id="equipment-name" class="form-input" placeholder="強酸性水生成器" required>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">カテゴリ</label>
                                <select id="equipment-category" class="form-input" required>
                                    <option value="">選択してください</option>
                                    <option value="消毒システム">消毒システム</option>
                                    <option value="医療器具">医療器具</option>
                                    <option value="防護用品">防護用品</option>
                                    <option value="滅菌機器">滅菌機器</option>
                                    <option value="その他">その他</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">説明</label>
                                <textarea id="equipment-description" class="form-input" rows="3" placeholder="機器の詳細説明"></textarea>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">画像URL</label>
                                <input type="url" id="equipment-image" class="form-input" placeholder="/images/safety/equipment.jpg">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">主な特徴（1行ずつ入力）</label>
                                <textarea id="equipment-features" class="form-input" rows="4" placeholder="厚生労働省認定医療機器&#10;99.99%除菌効果&#10;残留性なし・安全性確認済み"></textarea>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">仕様・認定情報</label>
                                <input type="text" id="equipment-specifications" class="form-input" placeholder="機器認定番号: 22500BZX00123000">
                            </div>
                            <div>
                                <label style="display: flex; align-items: center; gap: var(--space-2);">
                                    <input type="checkbox" id="equipment-medical-grade">
                                    <span>医療グレード認証済み</span>
                                </label>
                            </div>
                            <div style="display: flex; gap: var(--space-3); margin-top: var(--space-4);">
                                <button type="submit" class="btn btn-primary" style="flex: 1;">
                                    <i class="fas fa-plus"></i> 追加
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="this.closest('[style*=\"fixed\"]').remove()">キャンセル</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            document.getElementById('add-equipment-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const newEquipment = {
                    id: Math.max(...adminData.medicalEquipment.map(e => e.id), 0) + 1,
                    name: document.getElementById('equipment-name').value,
                    category: document.getElementById('equipment-category').value,
                    description: document.getElementById('equipment-description').value,
                    imageUrl: document.getElementById('equipment-image').value || '/images/safety/default-equipment.jpg',
                    features: document.getElementById('equipment-features').value.split('\n').filter(f => f.trim()),
                    specifications: document.getElementById('equipment-specifications').value,
                    medicalGrade: document.getElementById('equipment-medical-grade').checked
                };
                
                adminData.medicalEquipment.push(newEquipment);
                renderMedicalEquipmentGrid();
                modal.remove();
                alert('医療機器が追加されました');
            });
        }

        // 医療機器編集
        function editMedicalEquipment(id) {
            const equipment = adminData.medicalEquipment.find(e => e.id === id);
            if (!equipment) return;
            
            // 編集モーダルを表示（addMedicalEquipmentと同様の構造で値を事前入力）
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="this.remove()">
                    <div style="background: white; border-radius: var(--radius-xl); padding: var(--space-8); max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;" onclick="event.stopPropagation()">
                        <h3 style="margin: 0 0 var(--space-6) 0; color: var(--text-primary);">医療機器編集</h3>
                        <form id="edit-equipment-form" style="display: grid; gap: var(--space-4);">
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">機器名</label>
                                <input type="text" id="edit-equipment-name" class="form-input" value="${equipment.name}" required>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">カテゴリ</label>
                                <select id="edit-equipment-category" class="form-input" required>
                                    <option value="消毒システム" ${equipment.category === '消毒システム' ? 'selected' : ''}>消毒システム</option>
                                    <option value="医療器具" ${equipment.category === '医療器具' ? 'selected' : ''}>医療器具</option>
                                    <option value="防護用品" ${equipment.category === '防護用品' ? 'selected' : ''}>防護用品</option>
                                    <option value="滅菌機器" ${equipment.category === '滅菌機器' ? 'selected' : ''}>滅菌機器</option>
                                    <option value="その他" ${equipment.category === 'その他' ? 'selected' : ''}>その他</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">説明</label>
                                <textarea id="edit-equipment-description" class="form-input" rows="3">${equipment.description}</textarea>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">画像URL</label>
                                <input type="url" id="edit-equipment-image" class="form-input" value="${equipment.imageUrl}">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">主な特徴（1行ずつ入力）</label>
                                <textarea id="edit-equipment-features" class="form-input" rows="4">${equipment.features.join('\n')}</textarea>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">仕様・認定情報</label>
                                <input type="text" id="edit-equipment-specifications" class="form-input" value="${equipment.specifications || ''}">
                            </div>
                            <div>
                                <label style="display: flex; align-items: center; gap: var(--space-2);">
                                    <input type="checkbox" id="edit-equipment-medical-grade" ${equipment.medicalGrade ? 'checked' : ''}>
                                    <span>医療グレード認証済み</span>
                                </label>
                            </div>
                            <div style="display: flex; gap: var(--space-3); margin-top: var(--space-4);">
                                <button type="submit" class="btn btn-primary" style="flex: 1;">
                                    <i class="fas fa-save"></i> 更新
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="this.closest('[style*=\"fixed\"]').remove()">キャンセル</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            document.getElementById('edit-equipment-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                equipment.name = document.getElementById('edit-equipment-name').value;
                equipment.category = document.getElementById('edit-equipment-category').value;
                equipment.description = document.getElementById('edit-equipment-description').value;
                equipment.imageUrl = document.getElementById('edit-equipment-image').value;
                equipment.features = document.getElementById('edit-equipment-features').value.split('\n').filter(f => f.trim());
                equipment.specifications = document.getElementById('edit-equipment-specifications').value;
                equipment.medicalGrade = document.getElementById('edit-equipment-medical-grade').checked;
                
                renderMedicalEquipmentGrid();
                modal.remove();
                alert('医療機器が更新されました');
            });
        }

        // 医療機器削除
        function deleteMedicalEquipment(id) {
            if (confirm('この医療機器を削除しますか？')) {
                const index = adminData.medicalEquipment.findIndex(e => e.id === id);
                if (index !== -1) {
                    adminData.medicalEquipment.splice(index, 1);
                    renderMedicalEquipmentGrid();
                    alert('医療機器が削除されました');
                }
            }
        }

        // 機器フィルタリング
        function filterEquipment() {
            const filterValue = document.getElementById('equipment-filter').value;
            const cards = document.querySelectorAll('.equipment-management-card');
            
            cards.forEach(card => {
                const category = card.querySelector('span').textContent;
                if (filterValue === 'all' || category === filterValue) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // レビュー管理表示
        function showReviews() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header">
                    <h1 class="admin-title">レビュー管理</h1>
                    <button class="btn btn-primary" onclick="exportReviews()">
                        <i class="fas fa-download"></i> レビュー出力
                    </button>
                </header>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value">${adminData.reviews.length}</div>
                                <div class="stat-label">総レビュー数</div>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-comments"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value">${(adminData.reviews.reduce((sum, r) => sum + r.rating, 0) / adminData.reviews.length).toFixed(1)}</div>
                                <div class="stat-label">平均評価</div>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-star"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value">${adminData.reviews.filter(r => r.status === 'pending').length}</div>
                                <div class="stat-label">承認待ち</div>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">レビュー一覧</h3>
                        <div style="display: flex; gap: var(--space-3);">
                            <select onchange="filterReviews(this.value)">
                                <option value="all">すべて</option>
                                <option value="pending">承認待ち</option>
                                <option value="approved">承認済み</option>
                                <option value="5">★★★★★</option>
                                <option value="4">★★★★☆</option>
                            </select>
                        </div>
                    </div>
                    <div class="admin-card-content">
                        <div id="review-list">
                            ${renderReviewList()}
                        </div>
                    </div>
                </div>

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">評価分析</h3>
                    </div>
                    <div class="admin-card-content">
                        <div style="display: grid; gap: var(--space-4);">
                            ${[5,4,3,2,1].map(rating => {
                                const count = adminData.reviews.filter(r => r.rating === rating).length;
                                const percentage = (count / adminData.reviews.length * 100).toFixed(1);
                                return `
                                    <div style="display: flex; align-items: center; gap: var(--space-3);">
                                        <div style="width: 60px;">★${rating}</div>
                                        <div style="flex: 1; background: var(--light-gray); height: 20px; border-radius: var(--radius-full); overflow: hidden;">
                                            <div style="width: ${percentage}%; height: 100%; background: var(--gradient-primary);"></div>
                                        </div>
                                        <div style="width: 60px; text-align: right;">${count}件 (${percentage}%)</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // プロモーション管理表示
        function showPromotions() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header">
                    <h1 class="admin-title">キャンペーン・プロモーション管理</h1>
                    <button class="btn btn-primary" onclick="createPromotion()">
                        <i class="fas fa-plus"></i> 新規キャンペーン作成
                    </button>
                </header>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value">${adminData.promotions.filter(p => p.status === 'active').length}</div>
                                <div class="stat-label">実施中キャンペーン</div>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-tags"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value">${adminData.promotions.reduce((sum, p) => sum + p.usageCount, 0)}</div>
                                <div class="stat-label">総利用回数</div>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value">¥${adminData.promotions.reduce((sum, p) => sum + (p.discountType === 'fixed' ? p.discount * p.usageCount : 0), 0).toLocaleString()}</div>
                                <div class="stat-label">割引総額</div>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-yen-sign"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">キャンペーン一覧</h3>
                        <select onchange="filterPromotions(this.value)">
                            <option value="all">すべて</option>
                            <option value="active">実施中</option>
                            <option value="scheduled">予定</option>
                            <option value="expired">終了</option>
                        </select>
                    </div>
                    <div class="admin-card-content">
                        <div id="promotion-list">
                            ${renderPromotionList()}
                        </div>
                    </div>
                </div>

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">キャンペーン作成</h3>
                    </div>
                    <div class="admin-card-content">
                        <div style="display: grid; gap: var(--space-4);">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-4);">
                                <div>
                                    <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">キャンペーン名</label>
                                    <input type="text" id="promo-title" placeholder="キャンペーン名" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">割引タイプ</label>
                                    <select id="promo-type" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                                        <option value="percentage">パーセント割引</option>
                                        <option value="fixed">固定額割引</option>
                                    </select>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: var(--space-4);">
                                <div>
                                    <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">割引額</label>
                                    <input type="number" id="promo-discount" placeholder="割引額" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">開始日</label>
                                    <input type="date" id="promo-start" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">終了日</label>
                                    <input type="date" id="promo-end" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                                </div>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">説明</label>
                                <textarea id="promo-description" rows="3" placeholder="キャンペーンの詳細説明" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);"></textarea>
                            </div>
                            
                            <div style="background: var(--light-gray); padding: var(--space-4); border-radius: var(--radius-md); border: 2px dashed #e2e8f0;">
                                <h4 style="margin-bottom: var(--space-4); color: var(--accent-purple);"><i class="fas fa-bullhorn"></i> ホームページバナー設定</h4>
                                <div style="display: grid; grid-template-columns: auto 1fr auto; gap: var(--space-4); align-items: center; margin-bottom: var(--space-4);">
                                    <label style="display: flex; align-items: center; gap: var(--space-2); font-weight: 600;">
                                        <input type="checkbox" id="promo-show-banner" style="transform: scale(1.2);">
                                        ホームページにバナー表示
                                    </label>
                                    <div style="font-size: 0.9rem; color: var(--text-secondary);">
                                        チェックすると、このキャンペーンがホームページの上部にバナーとして表示されます
                                    </div>
                                    <div style="font-size: 0.8rem; background: #fef3c7; color: #92400e; padding: var(--space-2) var(--space-3); border-radius: var(--radius-md);">
                                        <i class="fas fa-exclamation-triangle"></i> 複数選択可能
                                    </div>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-4);">
                                    <div>
                                        <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">バナー表示テキスト</label>
                                        <input type="text" id="promo-banner-text" placeholder="🌟 夏の疲れを癒そう！90分コース20%OFF実施中！" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">バナー背景色</label>
                                        <div style="display: flex; gap: var(--space-2); align-items: center;">
                                            <input type="color" id="promo-banner-color" value="#ff6b6b" style="width: 40px; height: 40px; border: none; border-radius: var(--radius-md); cursor: pointer;">
                                            <input type="text" id="promo-banner-color-text" value="#ff6b6b" style="flex: 1; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);" onchange="document.getElementById('promo-banner-color').value = this.value">
                                        </div>
                                    </div>
                                </div>
                                <div style="margin-top: var(--space-4); padding: var(--space-3); background: white; border-radius: var(--radius-md); border: 1px solid #e2e8f0;">
                                    <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: var(--space-2);">プレビュー:</div>
                                    <div id="banner-preview" style="background: #ff6b6b; color: white; padding: var(--space-3); border-radius: var(--radius-md); text-align: center; font-weight: 600;">
                                        🌟 夏の疲れを癒そう！90分コース20%OFF実施中！
                                    </div>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary" onclick="savePromotion()">
                                <i class="fas fa-save"></i> キャンペーンを保存
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // テーブル描画関数
        function renderBookingsTable() {
            const table = document.getElementById('bookings-table');
            table.innerHTML = `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: var(--light-gray);">
                            <th style="padding: var(--space-3); text-align: left;">顧客名</th>
                            <th style="padding: var(--space-3); text-align: left;">サービス</th>
                            <th style="padding: var(--space-3); text-align: left;">時間</th>
                            <th style="padding: var(--space-3); text-align: left;">料金</th>
                            <th style="padding: var(--space-3); text-align: left;">ステータス</th>
                            <th style="padding: var(--space-3); text-align: left;">操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${adminData.bookings.map(booking => `
                            <tr style="border-bottom: 1px solid var(--border-gray);">
                                <td style="padding: var(--space-3);">${booking.customer}</td>
                                <td style="padding: var(--space-3);">${booking.service} ${booking.duration}</td>
                                <td style="padding: var(--space-3);">${booking.time}</td>
                                <td style="padding: var(--space-3);">¥${booking.price.toLocaleString()}</td>
                                <td style="padding: var(--space-3);">
                                    <span class="booking-status ${booking.status}">${getStatusText(booking.status)}</span>
                                </td>
                                <td style="padding: var(--space-3);">
                                    <button class="btn btn-small" onclick="editBooking(${booking.id})">編集</button>
                                    <button class="btn btn-small btn-danger" onclick="deleteBooking(${booking.id})">削除</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function renderCustomersTable() {
            const table = document.getElementById('customers-table');
            table.innerHTML = `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: var(--light-gray);">
                            <th style="padding: var(--space-3); text-align: left;">名前</th>
                            <th style="padding: var(--space-3); text-align: left;">電話番号</th>
                            <th style="padding: var(--space-3); text-align: left;">来店回数</th>
                            <th style="padding: var(--space-3); text-align: left;">最終来店</th>
                            <th style="padding: var(--space-3); text-align: left;">操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${adminData.customers.map(customer => `
                            <tr style="border-bottom: 1px solid var(--border-gray);">
                                <td style="padding: var(--space-3);">${customer.name}</td>
                                <td style="padding: var(--space-3);">${customer.phone}</td>
                                <td style="padding: var(--space-3);">${customer.visits}回</td>
                                <td style="padding: var(--space-3);">${customer.lastVisit}</td>
                                <td style="padding: var(--space-3);">
                                    <button class="btn btn-small" onclick="editCustomer(${customer.id})">編集</button>
                                    <button class="btn btn-small btn-danger" onclick="deleteCustomer(${customer.id})">削除</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function renderTherapistsTable() {
            const table = document.getElementById('therapists-table');
            table.innerHTML = `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: var(--light-gray);">
                            <th style="padding: var(--space-3); text-align: left;">名前</th>
                            <th style="padding: var(--space-3); text-align: left;">専門分野</th>
                            <th style="padding: var(--space-3); text-align: left;">勤務曜日</th>
                            <th style="padding: var(--space-3); text-align: left;">ステータス</th>
                            <th style="padding: var(--space-3); text-align: left;">操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${adminData.therapists.map(therapist => `
                            <tr style="border-bottom: 1px solid var(--border-gray);">
                                <td style="padding: var(--space-3);">${therapist.name}</td>
                                <td style="padding: var(--space-3);">${therapist.specialty}</td>
                                <td style="padding: var(--space-3);">${therapist.schedule.join('・')}</td>
                                <td style="padding: var(--space-3);">
                                    <span style="color: var(--admin-success);">稼働中</span>
                                </td>
                                <td style="padding: var(--space-3);">
                                    <button class="btn btn-small" onclick="editTherapist(${therapist.id})">編集</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function renderServicesTable() {
            const table = document.getElementById('services-table');
            table.innerHTML = `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: var(--light-gray);">
                            <th style="padding: var(--space-3); text-align: left;">サービス名</th>
                            <th style="padding: var(--space-3); text-align: left;">カテゴリ</th>
                            <th style="padding: var(--space-3); text-align: left;">料金</th>
                            <th style="padding: var(--space-3); text-align: left;">操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${adminData.services.map(service => `
                            <tr style="border-bottom: 1px solid var(--border-gray);">
                                <td style="padding: var(--space-3);">${service.name}</td>
                                <td style="padding: var(--space-3);">${service.category === 'massage' ? 'マッサージ' : 'アカスリ'}</td>
                                <td style="padding: var(--space-3);">¥${service.price.toLocaleString()}</td>
                                <td style="padding: var(--space-3);">
                                    <button class="btn btn-small" onclick="editService(${service.id})">編集</button>
                                    <button class="btn btn-small btn-danger" onclick="deleteService(${service.id})">削除</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // CMS helper functions
        function renderFeaturesList() {
            return adminData.cmsContent.features.map((feature, index) => `
                <div style="border: 1px solid var(--border-gray); border-radius: var(--radius-lg); padding: var(--space-4); margin-bottom: var(--space-4);">
                    <div style="display: grid; gap: var(--space-3);">
                        <div>
                            <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">アイコン (Font Awesome クラス)</label>
                            <input type="text" id="feature-icon-${index}" value="${feature.icon}" style="width: 100%; padding: var(--space-2); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">タイトル</label>
                            <input type="text" id="feature-title-${index}" value="${feature.title}" style="width: 100%; padding: var(--space-2); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">説明</label>
                            <textarea id="feature-description-${index}" rows="3" style="width: 100%; padding: var(--space-2); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">${feature.description}</textarea>
                        </div>
                        <div style="display: flex; gap: var(--space-2);">
                            <button class="btn btn-primary" onclick="updateFeature(${index})">
                                <i class="fas fa-save"></i> 更新
                            </button>
                            <button class="btn btn-danger" onclick="deleteFeature(${index})">
                                <i class="fas fa-trash"></i> 削除
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderTherapistsList() {
            return adminData.cmsContent.therapists.map((therapist, index) => `
                <div style="border: 1px solid var(--border-gray); border-radius: var(--radius-lg); padding: var(--space-4); margin-bottom: var(--space-4);">
                    <div style="display: grid; gap: var(--space-3);">
                        <div>
                            <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">名前</label>
                            <input type="text" id="therapist-name-${index}" value="${therapist.name}" style="width: 100%; padding: var(--space-2); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">専門分野</label>
                            <input type="text" id="therapist-specialty-${index}" value="${therapist.specialty}" style="width: 100%; padding: var(--space-2); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">紹介文</label>
                            <textarea id="therapist-description-${index}" rows="3" style="width: 100%; padding: var(--space-2); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">${therapist.description}</textarea>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">画像</label>
                            <input type="file" id="therapist-image-${index}" accept="image/*" style="width: 100%; padding: var(--space-2); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                            <small style="color: var(--text-muted);">現在: ${therapist.image}</small>
                        </div>
                        <div style="display: flex; gap: var(--space-2);">
                            <button class="btn btn-primary" onclick="updateTherapistCMS(${index})">
                                <i class="fas fa-save"></i> 更新
                            </button>
                            <button class="btn btn-danger" onclick="deleteTherapistCMS(${index})">
                                <i class="fas fa-trash"></i> 削除
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderSchedulesTable() {
            return `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: var(--light-gray);">
                            <th style="padding: var(--space-3); text-align: left;">セラピスト</th>
                            <th style="padding: var(--space-3); text-align: left;">対象週</th>
                            <th style="padding: var(--space-3); text-align: left;">提出日</th>
                            <th style="padding: var(--space-3); text-align: left;">出勤予定日</th>
                            <th style="padding: var(--space-3); text-align: left;">ステータス</th>
                            <th style="padding: var(--space-3); text-align: left;">操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${adminData.scheduleSubmissions.map(schedule => `
                            <tr style="border-bottom: 1px solid var(--border-gray);">
                                <td style="padding: var(--space-3);">${schedule.therapistName}</td>
                                <td style="padding: var(--space-3);">${schedule.targetWeek}</td>
                                <td style="padding: var(--space-3);">${schedule.submittedAt}</td>
                                <td style="padding: var(--space-3);">${schedule.days.join(', ')}</td>
                                <td style="padding: var(--space-3);">
                                    <span class="status-badge status-${schedule.status}">
                                        ${schedule.status === 'pending' ? '審査中' : schedule.status === 'approved' ? '承認済み' : '却下'}
                                    </span>
                                </td>
                                <td style="padding: var(--space-3);">
                                    ${schedule.status === 'pending' ? `
                                        <button class="btn btn-small btn-success" onclick="approveSchedule(${schedule.id})">承認</button>
                                        <button class="btn btn-small btn-danger" onclick="rejectSchedule(${schedule.id})">却下</button>
                                    ` : `
                                        <button class="btn btn-small" onclick="viewScheduleDetails(${schedule.id})">詳細</button>
                                    `}
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // CMS functions
        function switchCMSSection(section) {
            // すべてのCMSセクションを非表示
            document.querySelectorAll('[id^="cms-"]').forEach(el => {
                el.style.display = 'none';
            });
            
            // 選択されたセクションを表示
            const sectionEl = document.getElementById(`cms-${section}`);
            if (sectionEl) {
                sectionEl.style.display = 'block';
            }
        }

        function saveCMSContent(section) {
            switch(section) {
                case 'homepage':
                    adminData.cmsContent.homepage.heroTitle = document.getElementById('hero-title').value;
                    adminData.cmsContent.homepage.heroDescription = document.getElementById('hero-description').value;
                    adminData.cmsContent.homepage.phone = document.getElementById('phone').value;
                    adminData.cmsContent.homepage.businessHours = document.getElementById('business-hours').value;
                    break;
            }
            
            alert('CMSコンテンツを更新しました');
            console.log('CMS Updated:', adminData.cmsContent);
        }

        function addFeature() {
            adminData.cmsContent.features.push({
                icon: 'fas fa-star',
                title: '新しい特徴',
                description: '特徴の説明を入力してください。'
            });
            
            // 特徴リストを再描画
            document.getElementById('features-list').innerHTML = renderFeaturesList();
        }

        function updateFeature(index) {
            const feature = adminData.cmsContent.features[index];
            feature.icon = document.getElementById(`feature-icon-${index}`).value;
            feature.title = document.getElementById(`feature-title-${index}`).value;
            feature.description = document.getElementById(`feature-description-${index}`).value;
            
            alert('特徴を更新しました');
        }

        function deleteFeature(index) {
            if (confirm('この特徴を削除しますか？')) {
                adminData.cmsContent.features.splice(index, 1);
                document.getElementById('features-list').innerHTML = renderFeaturesList();
            }
        }

        function addTherapist() {
            adminData.cmsContent.therapists.push({
                id: Date.now(),
                name: '新しいセラピスト',
                specialty: '専門分野',
                description: 'セラピストの紹介文を入力してください。',
                image: 'placeholder'
            });
            
            // セラピストリストを再描画
            document.getElementById('therapists-list').innerHTML = renderTherapistsList();
        }

        function updateTherapistCMS(index) {
            const therapist = adminData.cmsContent.therapists[index];
            therapist.name = document.getElementById(`therapist-name-${index}`).value;
            therapist.specialty = document.getElementById(`therapist-specialty-${index}`).value;
            therapist.description = document.getElementById(`therapist-description-${index}`).value;
            
            const imageFile = document.getElementById(`therapist-image-${index}`).files[0];
            if (imageFile) {
                therapist.image = imageFile.name;
            }
            
            alert('セラピスト情報を更新しました');
        }

        function deleteTherapistCMS(index) {
            if (confirm('このセラピストを削除しますか？')) {
                adminData.cmsContent.therapists.splice(index, 1);
                document.getElementById('therapists-list').innerHTML = renderTherapistsList();
            }
        }

        // スケジュール管理関数
        function approveSchedule(scheduleId) {
            const schedule = adminData.scheduleSubmissions.find(s => s.id === scheduleId);
            if (schedule) {
                schedule.status = 'approved';
                document.getElementById('schedules-table').innerHTML = renderSchedulesTable();
                alert('スケジュールを承認しました');
            }
        }

        function rejectSchedule(scheduleId) {
            const reason = prompt('却下理由を入力してください:');
            if (reason) {
                const schedule = adminData.scheduleSubmissions.find(s => s.id === scheduleId);
                if (schedule) {
                    schedule.status = 'rejected';
                    schedule.rejectReason = reason;
                    document.getElementById('schedules-table').innerHTML = renderSchedulesTable();
                    alert('スケジュールを却下しました');
                }
            }
        }

        function viewScheduleDetails(scheduleId) {
            const schedule = adminData.scheduleSubmissions.find(s => s.id === scheduleId);
            if (schedule) {
                alert(`スケジュール詳細:\n\nセラピスト: ${schedule.therapistName}\n対象週: ${schedule.targetWeek}\n出勤予定: ${schedule.days.join(', ')}\nステータス: ${schedule.status}`);
            }
        }

        function filterSchedules(status) {
            // フィルタリング機能（実装可能）
            console.log('フィルター:', status);
        }

        function exportSchedules() {
            alert('CSV出力機能（実装予定）');
        }

        // 新機能のヘルパー関数
        function renderNewsletterList() {
            return adminData.newsletters.map(newsletter => `
                <div style="border: 1px solid var(--border-gray); border-radius: var(--radius-lg); padding: var(--space-4); margin-bottom: var(--space-3);">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--space-2);">
                        <div>
                            <h4 style="margin: 0 0 var(--space-1); font-weight: 600;">${newsletter.title}</h4>
                            <div style="font-size: 0.9rem; color: var(--text-secondary);">${newsletter.content.substring(0, 100)}...</div>
                        </div>
                        <span class="status-badge status-${newsletter.status}">${newsletter.status === 'sent' ? '送信済み' : '下書き'}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: var(--space-3);">
                        <div style="font-size: 0.8rem; color: var(--text-muted);">
                            ${newsletter.status === 'sent' ? `${newsletter.sentAt} | ${newsletter.recipients}名に送信` : `${newsletter.createdAt}作成`}
                        </div>
                        <div style="display: flex; gap: var(--space-2);">
                            <button class="btn btn-small" onclick="editNewsletter(${newsletter.id})">編集</button>
                            ${newsletter.status === 'draft' ? `<button class="btn btn-small btn-primary" onclick="sendNewsletter(${newsletter.id})">送信</button>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderBlogList() {
            return adminData.blogs.map(blog => `
                <div style="border: 1px solid var(--border-gray); border-radius: var(--radius-lg); padding: var(--space-4); margin-bottom: var(--space-3);">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 var(--space-2); font-weight: 600;">${blog.title}</h4>
                            <div style="display: flex; gap: var(--space-4); font-size: 0.9rem; color: var(--text-secondary);">
                                <span>${blog.status === 'published' ? `公開日: ${blog.publishedAt}` : `作成日: ${blog.createdAt}`}</span>
                                ${blog.views ? `<span>閲覧数: ${blog.views}</span>` : ''}
                                <span>作成者: ${blog.author}</span>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: var(--space-2);">
                            <span class="status-badge status-${blog.status}">${blog.status === 'published' ? '公開中' : '下書き'}</span>
                            <button class="btn btn-small" onclick="editBlog(${blog.id})">編集</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderMemberTable() {
            return `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: var(--light-gray);">
                            <th style="padding: var(--space-3); text-align: left;">会員名</th>
                            <th style="padding: var(--space-3); text-align: left;">Telegram ID</th>
                            <th style="padding: var(--space-3); text-align: left;">本人確認</th>
                            <th style="padding: var(--space-3); text-align: left;">ログイン状況</th>
                            <th style="padding: var(--space-3); text-align: left;">利用回数</th>
                            <th style="padding: var(--space-3); text-align: left;">累計支払</th>
                            <th style="padding: var(--space-3); text-align: left;">ステータス</th>
                            <th style="padding: var(--space-3); text-align: left;">操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${adminData.members.map(member => `
                            <tr style="border-bottom: 1px solid var(--border-gray);">
                                <td style="padding: var(--space-3);">
                                    <div style="display: flex; align-items: center; gap: var(--space-2);">
                                        <div style="width: 8px; height: 8px; border-radius: 50%; background: ${member.isOnline ? '#10b981' : '#6b7280'};"></div>
                                        <div>
                                            <div style="font-weight: 600;">${member.name}</div>
                                            <div style="font-size: 0.8rem; color: var(--text-muted);">${member.phone}</div>
                                            ${member.identityVerification.isFirstVisit ? '<div style="font-size: 0.7rem; color: var(--admin-warning); font-weight: 600;"><i class="fas fa-exclamation-triangle"></i> 初回施術</div>' : ''}
                                        </div>
                                    </div>
                                </td>
                                <td style="padding: var(--space-3);">${member.telegramId}</td>
                                <td style="padding: var(--space-3);">
                                    <div style="font-size: 0.85rem;">
                                        <div style="display: flex; align-items: center; gap: var(--space-1); margin-bottom: var(--space-1);">
                                            <i class="fas fa-id-card" style="color: ${member.identityVerification.mynumberPhoto === 'verified' ? '#10b981' : '#f59e0b'};"></i>
                                            <span class="status-badge ${member.identityVerification.mynumberPhoto === 'verified' ? 'status-approved' : 'status-pending'}" style="font-size: 0.7rem;">
                                                ${member.identityVerification.mynumberPhoto === 'verified' ? 'ID確認済' : 'ID未確認'}
                                            </span>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: var(--space-1);">
                                            <i class="fas fa-file-signature" style="color: ${member.identityVerification.consentForm === 'signed' ? '#10b981' : '#f59e0b'};"></i>
                                            <span class="status-badge ${member.identityVerification.consentForm === 'signed' ? 'status-approved' : 'status-pending'}" style="font-size: 0.7rem;">
                                                ${member.identityVerification.consentForm === 'signed' ? '同意書済' : '同意書未'}
                                            </span>
                                        </div>
                                    </div>
                                </td>
                                <td style="padding: var(--space-3);">
                                    <div style="font-size: 0.85rem;">
                                        <div style="color: ${member.isOnline ? '#10b981' : '#6b7280'}; font-weight: 600;">
                                            ${member.isOnline ? 'オンライン' : 'オフライン'}
                                        </div>
                                        <div style="color: var(--text-muted);">
                                            最終: ${member.lastSeen}
                                        </div>
                                    </div>
                                </td>
                                <td style="padding: var(--space-3);">${member.visits}回</td>
                                <td style="padding: var(--space-3);">¥${member.totalSpent.toLocaleString()}</td>
                                <td style="padding: var(--space-3);">
                                    <span class="status-badge ${member.status === 'vip' ? 'status-approved' : 'status-pending'}">${member.status === 'vip' ? 'VIP' : '一般'}</span>
                                </td>
                                <td style="padding: var(--space-3);">
                                    <div style="display: flex; gap: var(--space-1); flex-wrap: wrap;">
                                        <button class="btn btn-small" onclick="viewMemberDetail(${member.id})" title="詳細表示">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        ${member.identityVerification.mynumberPhoto === 'pending' || member.identityVerification.consentForm === 'pending' ? 
                                            `<button class="btn btn-small" onclick="openIdentityVerification(${member.id})" style="background: var(--admin-warning); color: white;" title="本人確認登録">
                                                <i class="fas fa-id-card"></i>
                                            </button>` : 
                                            `<button class="btn btn-small" onclick="viewIdentityDocuments(${member.id})" style="background: var(--admin-success); color: white;" title="書類確認">
                                                <i class="fas fa-file-check"></i>
                                            </button>`
                                        }
                                        <button class="btn btn-small" onclick="sendPersonalMessage('${member.telegramId}', '${member.name}')" title="Telegram送信">
                                            <i class="fab fa-telegram"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function renderHotelTable() {
            return `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: var(--light-gray);">
                            <th style="padding: var(--space-3); text-align: left;">ホテル名</th>
                            <th style="padding: var(--space-3); text-align: left;">エリア</th>
                            <th style="padding: var(--space-3); text-align: left;">住所</th>
                            <th style="padding: var(--space-3); text-align: left;">出張料</th>
                            <th style="padding: var(--space-3); text-align: left;">利用回数</th>
                            <th style="padding: var(--space-3); text-align: left;">ステータス</th>
                            <th style="padding: var(--space-3); text-align: left;">操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${adminData.hotels.map(hotel => `
                            <tr style="border-bottom: 1px solid var(--border-gray);">
                                <td style="padding: var(--space-3); font-weight: 600;">${hotel.name}</td>
                                <td style="padding: var(--space-3);">${hotel.area}</td>
                                <td style="padding: var(--space-3); font-size: 0.9rem;">${hotel.address}</td>
                                <td style="padding: var(--space-3);">${hotel.price}</td>
                                <td style="padding: var(--space-3);">${hotel.visits}回</td>
                                <td style="padding: var(--space-3);">
                                    <span class="status-badge ${hotel.status === 'active' ? 'status-approved' : 'status-pending'}">${hotel.status === 'active' ? '対応中' : '要相談'}</span>
                                </td>
                                <td style="padding: var(--space-3);">
                                    <button class="btn btn-small" onclick="editHotel(${hotel.id})">編集</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function renderInventoryTable() {
            return `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: var(--light-gray);">
                            <th style="padding: var(--space-3); text-align: left;">商品名</th>
                            <th style="padding: var(--space-3); text-align: left;">カテゴリ</th>
                            <th style="padding: var(--space-3); text-align: left;">現在庫</th>
                            <th style="padding: var(--space-3); text-align: left;">最低在庫</th>
                            <th style="padding: var(--space-3); text-align: left;">単価</th>
                            <th style="padding: var(--space-3); text-align: left;">仕入先</th>
                            <th style="padding: var(--space-3); text-align: left;">操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${adminData.inventory.map(item => `
                            <tr style="border-bottom: 1px solid var(--border-gray); ${item.stock <= item.minStock ? 'background: rgba(245, 158, 11, 0.1);' : ''}">
                                <td style="padding: var(--space-3); font-weight: 600;">${item.name}</td>
                                <td style="padding: var(--space-3);">${getCategoryName(item.category)}</td>
                                <td style="padding: var(--space-3); ${item.stock <= item.minStock ? 'color: var(--admin-warning); font-weight: 600;' : ''}">${item.stock}${item.unit}</td>
                                <td style="padding: var(--space-3);">${item.minStock}${item.unit}</td>
                                <td style="padding: var(--space-3);">¥${item.price.toLocaleString()}</td>
                                <td style="padding: var(--space-3); font-size: 0.9rem;">${item.supplier}</td>
                                <td style="padding: var(--space-3);">
                                    <button class="btn btn-small" onclick="editInventoryItem(${item.id})">編集</button>
                                    <button class="btn btn-small btn-primary" onclick="addStock(${item.id})">入庫</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function renderReviewList() {
            return adminData.reviews.map(review => `
                <div style="border: 1px solid var(--border-gray); border-radius: var(--radius-lg); padding: var(--space-4); margin-bottom: var(--space-3);">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--space-3);">
                        <div>
                            <div style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-2);">
                                <strong>${review.customerName}</strong>
                                <div style="color: #fbbf24;">${'★'.repeat(review.rating)}${'☆'.repeat(5-review.rating)}</div>
                                <span style="font-size: 0.8rem; color: var(--text-muted);">${review.date}</span>
                            </div>
                            <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: var(--space-2);">
                                ${review.service} | セラピスト: ${review.therapist}
                            </div>
                        </div>
                        <span class="status-badge status-${review.status}">${review.status === 'approved' ? '承認済み' : '審査待ち'}</span>
                    </div>
                    <div style="background: var(--light-gray); padding: var(--space-3); border-radius: var(--radius-md); margin-bottom: var(--space-3);">
                        "${review.comment}"
                    </div>
                    ${review.status === 'pending' ? `
                        <div style="display: flex; gap: var(--space-2);">
                            <button class="btn btn-small btn-success" onclick="approveReview(${review.id})">承認</button>
                            <button class="btn btn-small btn-danger" onclick="rejectReview(${review.id})">却下</button>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function renderPromotionList() {
            return adminData.promotions.map(promo => `
                <div style="border: 1px solid var(--border-gray); border-radius: var(--radius-lg); padding: var(--space-4); margin-bottom: var(--space-3); ${promo.showOnHomeBanner ? 'border-left: 4px solid #ff6b6b;' : ''}">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--space-3);">
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-1);">
                                <h4 style="margin: 0; font-weight: 600;">${promo.title}</h4>
                                ${promo.showOnHomeBanner ? '<span style="background: linear-gradient(135deg, #ff6b6b, #ff8e8e); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: 600;"><i class="fas fa-bullhorn"></i> バナー表示中</span>' : ''}
                            </div>
                            <div style="font-size: 0.9rem; color: var(--text-secondary);">${promo.description}</div>
                            ${promo.showOnHomeBanner ? `<div style="margin-top: var(--space-2); padding: var(--space-2); background: ${promo.bannerColor}; color: white; border-radius: var(--radius-md); font-size: 0.85rem; font-weight: 600;">${promo.bannerText}</div>` : ''}
                        </div>
                        <span class="status-badge status-${promo.status === 'active' ? 'approved' : promo.status === 'scheduled' ? 'pending' : 'rejected'}">
                            ${promo.status === 'active' ? '実施中' : promo.status === 'scheduled' ? '予定' : '終了'}
                        </span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: var(--space-3); margin-bottom: var(--space-3);">
                        <div>
                            <div style="font-size: 0.8rem; color: var(--text-muted);">割引</div>
                            <div style="font-weight: 600;">${promo.discountType === 'percentage' ? promo.discount + '%' : '¥' + promo.discount.toLocaleString()}</div>
                        </div>
                        <div>
                            <div style="font-size: 0.8rem; color: var(--text-muted);">期間</div>
                            <div style="font-size: 0.9rem;">${promo.startDate} - ${promo.endDate}</div>
                        </div>
                        <div>
                            <div style="font-size: 0.8rem; color: var(--text-muted);">利用回数</div>
                            <div style="font-weight: 600;">${promo.usageCount}回</div>
                        </div>
                        <div style="text-align: right;">
                            <button class="btn btn-small" onclick="editPromotion(${promo.id})">編集</button>
                            <button class="btn btn-small ${promo.showOnHomeBanner ? 'btn-danger' : 'btn-primary'}" onclick="togglePromotionBanner(${promo.id})">
                                <i class="fas fa-${promo.showOnHomeBanner ? 'eye-slash' : 'bullhorn'}"></i>
                                ${promo.showOnHomeBanner ? 'バナー非表示' : 'バナー表示'}
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ヘルパー関数
        function getCategoryName(category) {
            const categories = {
                'oils': 'オイル類',
                'linens': 'リネン類',
                'equipment': '器具類'
            };
            return categories[category] || category;
        }

        function getAreaStats() {
            const areas = {};
            adminData.hotels.forEach(hotel => {
                if (!areas[hotel.area]) {
                    areas[hotel.area] = { name: hotel.area, count: 0, visits: 0 };
                }
                areas[hotel.area].count++;
                areas[hotel.area].visits += hotel.visits;
            });
            return Object.values(areas);
        }

        // 新機能のイベントハンドラー
        function createNewsletter() {
            alert('新規ニュースレター作成機能（実装予定）');
        }

        async function sendQuickNewsletter() {
            const title = document.getElementById('quick-title').value;
            const content = document.getElementById('quick-content').value;
            const recipients = document.getElementById('quick-recipients').value;
            
            if (!title || !content) {
                alert('件名とメッセージを入力してください');
                return;
            }
            
            // メッセージを構築
            const message = `【愛なるマッサージ】${title}\n\n${content}\n\n━━━━━━━━━━━━━━━━━━━━\n💆‍♀️ 愛なるマッサージ\n📞 092-XXXX-XXXX\n🌐 出張マッサージサービス`;
            
            // 送信対象の会員を取得
            let targetMembers = [];
            switch(recipients) {
                case 'all':
                    targetMembers = adminData.members;
                    break;
                case 'active':
                    targetMembers = adminData.members.filter(m => m.status === 'active');
                    break;
                case 'vip':
                    targetMembers = adminData.members.filter(m => m.status === 'vip');
                    break;
            }
            
            console.log(`Telegram一斉送信開始:`);
            console.log(`件名: ${title}`);
            console.log(`対象者数: ${targetMembers.length}名`);
            console.log(`メッセージ内容:\n${message}`);
            
            // 送信処理（実際の本番環境では以下を有効化）
            /*
            try {
                let successCount = 0;
                let errorCount = 0;
                
                for (const member of targetMembers) {
                    try {
                        const response = await fetch(`${TELEGRAM_API_URL}/sendMessage`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                chat_id: member.telegramId,
                                text: message,
                                parse_mode: 'HTML'
                            })
                        });
                        
                        if (response.ok) {
                            successCount++;
                            console.log(`送信成功: ${member.name} (${member.telegramId})`);
                        } else {
                            errorCount++;
                            console.error(`送信失敗: ${member.name} (${member.telegramId})`);
                        }
                        
                        // API制限を考慮して少し待機
                        await new Promise(resolve => setTimeout(resolve, 100));
                        
                    } catch (error) {
                        errorCount++;
                        console.error(`送信エラー: ${member.name}`, error);
                    }
                }
                
                alert(`Telegram送信完了\n成功: ${successCount}件\nエラー: ${errorCount}件`);
                
            } catch (error) {
                console.error('一斉送信エラー:', error);
                alert('送信中にエラーが発生しました');
            }
            */
            
            // 開発環境での表示
            alert(`Telegram送信完了（シミュレーション）\n件名: ${title}\n対象: ${targetMembers.length}名\n\nコンソールログで詳細を確認してください`);
            
            // 送信履歴に追加
            const newNewsletter = {
                id: adminData.newsletters.length + 1,
                title: title,
                content: content,
                status: 'sent',
                sentAt: new Date().toISOString().split('T')[0],
                recipients: targetMembers.length
            };
            adminData.newsletters.unshift(newNewsletter);
            
            // 送信後にフォームをクリア
            document.getElementById('quick-title').value = '';
            document.getElementById('quick-content').value = '';
        }

        function createBlog() {
            alert('新規コラム作成機能（実装予定）');
        }

        function saveBlogDraft() {
            const title = document.getElementById('blog-title').value;
            const content = document.getElementById('blog-content').value;
            
            if (!title || !content) {
                alert('タイトルと内容を入力してください');
                return;
            }
            
            alert('下書きを保存しました');
        }

        function publishBlog() {
            const title = document.getElementById('blog-title').value;
            const content = document.getElementById('blog-content').value;
            
            if (!title || !content) {
                alert('タイトルと内容を入力してください');
                return;
            }
            
            alert('コラムを公開しました');
        }

        function previewBlog() {
            const title = document.getElementById('blog-title').value;
            const content = document.getElementById('blog-content').value;
            
            if (!title || !content) {
                alert('タイトルと内容を入力してください');
                return;
            }
            
            // 新しいウィンドウでプレビューを表示
            const previewWindow = window.open('', '_blank');
            previewWindow.document.write(`
                <html>
                <head><title>プレビュー: ${title}</title></head>
                <body style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px;">
                    <h1>${title}</h1>
                    <pre style="white-space: pre-wrap;">${content}</pre>
                </body>
                </html>
            `);
        }

        function exportMembers() {
            alert('会員データCSV出力機能（実装予定）');
        }

        function addHotel() {
            alert('ホテル追加機能（実装予定）');
        }

        function addInventoryItem() {
            alert('商品追加機能（実装予定）');
        }

        function createOrder(itemId) {
            const item = adminData.inventory.find(i => i.id === itemId);
            if (item) {
                const orderQuantity = prompt(`${item.name}の発注数量を入力してください:`, item.minStock);
                if (orderQuantity) {
                    alert(`${item.supplier}に${orderQuantity}${item.unit}の発注を送信しました`);
                }
            }
        }

        function approveReview(reviewId) {
            const review = adminData.reviews.find(r => r.id === reviewId);
            if (review) {
                review.status = 'approved';
                document.getElementById('review-list').innerHTML = renderReviewList();
                alert('レビューを承認しました');
            }
        }

        function rejectReview(reviewId) {
            if (confirm('このレビューを却下しますか？')) {
                adminData.reviews = adminData.reviews.filter(r => r.id !== reviewId);
                document.getElementById('review-list').innerHTML = renderReviewList();
                alert('レビューを却下しました');
            }
        }

        function savePromotion() {
            const title = document.getElementById('promo-title').value;
            const type = document.getElementById('promo-type').value;
            const discount = document.getElementById('promo-discount').value;
            const startDate = document.getElementById('promo-start').value;
            const endDate = document.getElementById('promo-end').value;
            const description = document.getElementById('promo-description').value;
            
            if (!title || !discount || !startDate || !endDate) {
                alert('必須項目を入力してください');
                return;
            }
            
            adminData.promotions.push({
                id: Date.now(),
                title,
                description,
                discount: parseInt(discount),
                discountType: type,
                startDate,
                endDate,
                status: 'scheduled',
                usageCount: 0
            });
            
            alert('キャンペーンを保存しました');
            document.getElementById('promotion-list').innerHTML = renderPromotionList();
        }

        // ユーティリティ関数
        function getStatusText(status) {
            const statusMap = {
                'pending': '待機中',
                'confirmed': '確定',
                'completed': '完了'
            };
            return statusMap[status] || status;
        }

        // イベントハンドラー
        function addNewBooking() {
            alert('新規予約機能（実装予定）');
        }

        function addNewCustomer() {
            alert('新規顧客機能（実装予定）');
        }

        function addNewTherapist() {
            alert('スタッフ追加機能（実装予定）');
        }

        function addNewService() {
            alert('サービス追加機能（実装予定）');
        }

        // Telegramメッセージ送信機能
        async function sendPersonalMessage(telegramId, customerName) {
            const message = prompt(`${customerName}様にメッセージを送信します：`, 
                `こんにちは、${customerName}様。\n愛なるマッサージです。\n\nいつもご利用ありがとうございます。\n何かご不明な点がございましたら、お気軽にお声かけください。`);
            
            if (!message) return;
            
            const fullMessage = `【愛なるマッサージ】\n\n${message}\n\n━━━━━━━━━━━━━━━━━━━━\n💆‍♀️ 愛なるマッサージ\n📞 092-XXXX-XXXX\n🌐 出張マッサージサービス`;
            
            try {
                console.log(`Telegram個別メッセージ送信:`, {
                    telegramId: telegramId,
                    customer: customerName,
                    message: fullMessage
                });

                // 実際のAPI送信（本番環境では有効化）
                /*
                const response = await fetch(`${TELEGRAM_API_URL}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: telegramId,
                        text: fullMessage,
                        parse_mode: 'HTML'
                    })
                });
                
                if (response.ok) {
                    alert('メッセージを送信しました！');
                } else {
                    throw new Error('送信に失敗しました');
                }
                */
                
                alert(`メッセージを送信しました（シミュレーション）\n\n宛先: ${customerName} (${telegramId})\n\nコンソールログで詳細を確認してください。`);
                
            } catch (error) {
                console.error('Telegram送信エラー:', error);
                alert('メッセージ送信に失敗しました。');
            }
        }

        // 予約リマインダー送信機能
        async function sendBookingReminder(bookingId) {
            const booking = adminData.bookings.find(b => b.id === bookingId);
            if (!booking) {
                alert('予約が見つかりません');
                return;
            }

            const reminderMessage = `【愛なるマッサージ】予約リマインダー

📅 明日のご予約確認
👤 ${booking.customer}
🎯 ${booking.service} ${booking.duration}
⏰ ${booking.time}
🏨 ${booking.hotel}
👩‍⚕️ 担当: ${booking.therapist}
💰 料金: ¥${booking.price.toLocaleString()}

━━━━━━━━━━━━━━━━━━━━
📝 ご確認とお願い
• ホテルのお部屋番号をお教えください
• 体調に変化がある場合はお知らせください
• キャンセルは2時間前までにご連絡ください

💆‍♀️ 愛なるマッサージ
📞 092-XXXX-XXXX

心よりお待ちしております。`;

            try {
                console.log('予約リマインダー送信:', {
                    bookingId: bookingId,
                    telegramId: booking.telegramId,
                    customer: booking.customer,
                    message: reminderMessage
                });

                // 実際のAPI送信（本番環境では有効化）
                /*
                const response = await fetch(`${TELEGRAM_API_URL}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: booking.telegramId,
                        text: reminderMessage,
                        parse_mode: 'HTML'
                    })
                });
                
                if (response.ok) {
                    booking.reminderSent = true;
                    alert('リマインダーを送信しました！');
                } else {
                    throw new Error('送信に失敗しました');
                }
                */
                
                // シミュレーション
                booking.reminderSent = true;
                alert(`予約リマインダーを送信しました（シミュレーション）\n\n${booking.customer}様 (${booking.telegramId})\n予約時刻の1時間前: ${booking.date} ${booking.time}\n\nコンソールログで詳細を確認してください。`);
                
                // 画面を更新
                if (document.querySelector('.admin-main').innerHTML.includes('今日の予約')) {
                    showDashboard();
                }
                
            } catch (error) {
                console.error('リマインダー送信エラー:', error);
                alert('リマインダー送信に失敗しました。');
            }
        }

        // 自動リマインダーチェック機能
        function checkAndSendReminders() {
            const now = new Date();
            const oneHourLater = new Date(now.getTime() + 60 * 60 * 1000);
            
            adminData.bookings.forEach(booking => {
                if (booking.status === 'confirmed' && !booking.reminderSent) {
                    const bookingDateTime = new Date(`${booking.date} ${booking.time.split('-')[0]}`);
                    
                    // 1時間前になったらリマインダー送信
                    if (bookingDateTime.getTime() - now.getTime() <= 60 * 60 * 1000 && 
                        bookingDateTime.getTime() > now.getTime()) {
                        console.log(`自動リマインダー対象: ${booking.customer}様の予約`);
                        sendBookingReminder(booking.id);
                    }
                }
            });
        }

        // 1分毎にリマインダーをチェック
        setInterval(checkAndSendReminders, 60000);

        // 初期化時にもチェック
        window.addEventListener('load', function() {
            console.log('管理画面初期化: 自動リマインダーシステム開始');
            checkAndSendReminders();
        });

        // 予約操作機能
        async function cancelBooking(bookingId) {
            const booking = adminData.bookings.find(b => b.id === bookingId);
            if (!booking) {
                alert('予約が見つかりません');
                return;
            }

            const reason = prompt('キャンセル理由を入力してください:', '店舗都合によりキャンセルさせていただきます。申し訳ございません。');
            if (!reason) return;

            const cancelMessage = `【愛なるマッサージ】予約キャンセルのお知らせ

申し訳ございません。
以下の予約をキャンセルさせていただきます。

📅 ${booking.date}
⏰ ${booking.time}
🎯 ${booking.service} ${booking.duration}
🏨 ${booking.hotel}

━━━━━━━━━━━━━━━━━━━━
📝 キャンセル理由
${reason}

━━━━━━━━━━━━━━━━━━━━
🙏 改めてのご予約をお待ちしております

💆‍♀️ 愛なるマッサージ
📞 092-XXXX-XXXX`;

            try {
                console.log('予約キャンセル通知送信:', {
                    bookingId: bookingId,
                    telegramId: booking.telegramId,
                    customer: booking.customer,
                    reason: reason,
                    message: cancelMessage
                });

                // 実際のAPI送信（本番環境では有効化）
                /*
                const response = await fetch(`${TELEGRAM_API_URL}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: booking.telegramId,
                        text: cancelMessage,
                        parse_mode: 'HTML'
                    })
                });
                
                if (response.ok) {
                    booking.status = 'cancelled';
                    alert('キャンセル通知を送信しました');
                } else {
                    throw new Error('送信に失敗しました');
                }
                */
                
                // シミュレーション
                booking.status = 'cancelled';
                alert(`予約キャンセル通知を送信しました（シミュレーション）\n\n${booking.customer}様に自動でTelegramメッセージを送信\n\nコンソールログで詳細を確認してください。`);
                
                // 画面を更新
                showDashboard();
                
            } catch (error) {
                console.error('キャンセル通知送信エラー:', error);
                alert('キャンセル通知送信に失敗しました。');
            }
        }

        async function rescheduleBooking(bookingId) {
            const booking = adminData.bookings.find(b => b.id === bookingId);
            if (!booking) {
                alert('予約が見つかりません');
                return;
            }

            const newDate = prompt('新しい日付を入力してください (YYYY-MM-DD):', booking.date);
            if (!newDate) return;

            const newTime = prompt('新しい時間を入力してください (例: 19:00-20:30):', booking.time);
            if (!newTime) return;

            const reason = prompt('変更理由を入力してください:', 'スケジュール調整のため');
            if (!reason) return;

            const rescheduleMessage = `【愛なるマッサージ】予約時間変更のお知らせ

以下の予約時間を変更させていただきます。

━━━━━━━━━━━━━━━━━━━━
📅 変更前
日時: ${booking.date} ${booking.time}

📅 変更後
日時: ${newDate} ${newTime}

━━━━━━━━━━━━━━━━━━━━
🎯 ${booking.service} ${booking.duration}
🏨 ${booking.hotel}
👩‍⚕️ 担当: ${booking.therapist}
💰 料金: ¥${booking.price.toLocaleString()}

━━━━━━━━━━━━━━━━━━━━
📝 変更理由
${reason}

━━━━━━━━━━━━━━━━━━━━
ご都合が悪い場合はお知らせください。
引き続きよろしくお願いいたします。

💆‍♀️ 愛なるマッサージ
📞 092-XXXX-XXXX`;

            try {
                console.log('予約変更通知送信:', {
                    bookingId: bookingId,
                    telegramId: booking.telegramId,
                    customer: booking.customer,
                    oldDate: booking.date,
                    oldTime: booking.time,
                    newDate: newDate,
                    newTime: newTime,
                    reason: reason,
                    message: rescheduleMessage
                });

                // 実際のAPI送信（本番環境では有効化）
                /*
                const response = await fetch(`${TELEGRAM_API_URL}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: booking.telegramId,
                        text: rescheduleMessage,
                        parse_mode: 'HTML'
                    })
                });
                
                if (response.ok) {
                    booking.date = newDate;
                    booking.time = newTime;
                    booking.reminderSent = false; // リマインダーを再設定
                    alert('時間変更通知を送信しました');
                } else {
                    throw new Error('送信に失敗しました');
                }
                */
                
                // シミュレーション
                booking.date = newDate;
                booking.time = newTime;
                booking.reminderSent = false;
                alert(`予約変更通知を送信しました（シミュレーション）\n\n${booking.customer}様に自動でTelegramメッセージを送信\n変更: ${booking.date} ${booking.time} → ${newDate} ${newTime}\n\nコンソールログで詳細を確認してください。`);
                
                // 画面を更新
                showDashboard();
                
            } catch (error) {
                console.error('変更通知送信エラー:', error);
                alert('変更通知送信に失敗しました。');
            }
        }

        // 予約確認メッセージ送信
        async function confirmBooking(bookingId) {
            const booking = adminData.bookings.find(b => b.id === bookingId);
            if (!booking) {
                alert('予約が見つかりません');
                return;
            }

            const confirmMessage = `【愛なるマッサージ】予約確定のお知らせ

ご予約が確定いたしました！

📅 ${booking.date}
⏰ ${booking.time}
🎯 ${booking.service} ${booking.duration}
🏨 ${booking.hotel}
👩‍⚕️ 担当: ${booking.therapist}
💰 料金: ¥${booking.price.toLocaleString()}

━━━━━━━━━━━━━━━━━━━━
📝 当日のご案内
• ホテルに到着しましたらお部屋番号をお教えください
• 体調に変化がある場合は事前にお知らせください
• キャンセルは2時間前までにご連絡ください

━━━━━━━━━━━━━━━━━━━━
ご予約の1時間前にリマインダーをお送りします。
心よりお待ちしております。

💆‍♀️ 愛なるマッサージ
📞 092-XXXX-XXXX`;

            try {
                console.log('予約確認通知送信:', {
                    bookingId: bookingId,
                    telegramId: booking.telegramId,
                    customer: booking.customer,
                    message: confirmMessage
                });

                // 実際のAPI送信（本番環境では有効化）
                /*
                const response = await fetch(`${TELEGRAM_API_URL}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: booking.telegramId,
                        text: confirmMessage,
                        parse_mode: 'HTML'
                    })
                });
                
                if (response.ok) {
                    booking.status = 'confirmed';
                    alert('予約確認通知を送信しました');
                } else {
                    throw new Error('送信に失敗しました');
                }
                */
                
                // シミュレーション
                booking.status = 'confirmed';
                alert(`予約確認通知を送信しました（シミュレーション）\n\n${booking.customer}様に自動でTelegramメッセージを送信\n\nコンソールログで詳細を確認してください。`);
                
                // 画面を更新
                showDashboard();
                
            } catch (error) {
                console.error('確認通知送信エラー:', error);
                alert('確認通知送信に失敗しました。');
            }
        }

        // 自動返信システム
        const autoReplyMessages = {
            welcome: `【愛なるマッサージ】へようこそ！

🌟 ご利用ありがとうございます
📱 このTelegramアカウントで以下のことができます：

✅ 予約のリクエスト
✅ 予約の確認・変更
✅ お問い合わせ
✅ キャンペーン情報の受信

━━━━━━━━━━━━━━━━━━━━
🕐 営業時間
月〜木: 18:00 - 翌3:00
金・土: 18:00 - 翌5:00
日・祝: 18:00 - 翌1:00

💆‍♀️ 愛なるマッサージ
📞 092-XXXX-XXXX`,

            afterHours: `【愛なるマッサージ】営業時間外です

現在営業時間外のため、自動応答でお答えしています。

🕐 営業時間
月〜木: 18:00 - 翌3:00
金・土: 18:00 - 翌5:00
日・祝: 18:00 - 翌1:00

━━━━━━━━━━━━━━━━━━━━
営業時間内に改めてご連絡いたします。
緊急の場合は下記までお電話ください。

📞 092-XXXX-XXXX`,

            thankYou: `【愛なるマッサージ】

ご利用ありがとうございました！

⭐ よろしければサービスの感想をお聞かせください
🔄 次回のご予約もお待ちしております

💆‍♀️ 愛なるマッサージ
📞 092-XXXX-XXXX`
        };

        // 営業時間チェック機能
        function isBusinessHours() {
            const now = new Date();
            const hour = now.getHours();
            const day = now.getDay(); // 0=日曜, 1=月曜, ..., 6=土曜

            if (day >= 1 && day <= 4) { // 月〜木
                return hour >= 18 || hour < 3;
            } else if (day === 5 || day === 6) { // 金・土
                return hour >= 18 || hour < 5;
            } else { // 日・祝
                return hour >= 18 || hour < 1;
            }
        }

        // 本人確認書類登録モーダルを開く
        function openIdentityVerification(memberId) {
            const member = adminData.members.find(m => m.id === memberId);
            if (!member) {
                alert('会員が見つかりません');
                return;
            }

            const modal = document.createElement('div');
            modal.id = 'identity-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;

            modal.innerHTML = `
                <div style="background: white; border-radius: var(--radius-xl); padding: var(--space-8); max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: var(--space-6);">
                        <h2 style="margin: 0; color: var(--text-primary);">
                            <i class="fas fa-id-card"></i> 本人確認書類登録
                        </h2>
                        <button onclick="closeIdentityModal()" style="background: none; border: none; font-size: 1.5rem; color: var(--text-muted); cursor: pointer;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div style="background: var(--light-gray); padding: var(--space-4); border-radius: var(--radius-lg); margin-bottom: var(--space-6);">
                        <div style="display: flex; align-items: center; gap: var(--space-3);">
                            <div style="width: 50px; height: 50px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem; font-weight: bold;">
                                ${member.name.charAt(0)}
                            </div>
                            <div>
                                <div style="font-weight: 600; font-size: 1.1rem;">${member.name}</div>
                                <div style="color: var(--text-muted); font-size: 0.9rem;">${member.phone} | ${member.telegramId}</div>
                                ${member.identityVerification.isFirstVisit ? '<div style="color: var(--admin-warning); font-weight: 600; font-size: 0.85rem;"><i class="fas fa-exclamation-triangle"></i> 初回施術時の本人確認</div>' : ''}
                            </div>
                        </div>
                    </div>

                    <form id="identity-verification-form">
                        <!-- マイナンバーカード写真セクション -->
                        <div style="margin-bottom: var(--space-6); padding: var(--space-4); border: 2px solid var(--border-gray); border-radius: var(--radius-lg);">
                            <h3 style="margin: 0 0 var(--space-4) 0; color: var(--text-primary); display: flex; align-items: center; gap: var(--space-2);">
                                <i class="fas fa-id-card" style="color: var(--admin-accent);"></i>
                                マイナンバーカード写真
                            </h3>
                            <div style="margin-bottom: var(--space-4);">
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">写真アップロード</label>
                                <input type="file" id="mynumber-photo" accept="image/*" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                                <small style="color: var(--text-muted); font-size: 0.85rem;">対応形式: JPG, PNG, GIF（最大5MB）</small>
                            </div>
                            <div style="margin-bottom: var(--space-4);">
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">確認メモ</label>
                                <textarea id="mynumber-memo" rows="3" placeholder="本人確認時の注意事項やメモを記入..." style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);"></textarea>
                            </div>
                            <div style="background: rgba(16, 185, 129, 0.1); padding: var(--space-3); border-radius: var(--radius-md); border-left: 4px solid var(--admin-success);">
                                <div style="font-weight: 600; color: var(--admin-success); margin-bottom: var(--space-1);">
                                    <i class="fas fa-shield-check"></i> 確認事項
                                </div>
                                <ul style="margin: 0; padding-left: var(--space-4); color: var(--text-secondary); font-size: 0.9rem;">
                                    <li>マイナンバーカードの写真が鮮明に写っている</li>
                                    <li>顔写真と本人が一致している</li>
                                    <li>カードに記載の氏名と登録情報が一致している</li>
                                    <li>有効期限内である</li>
                                </ul>
                            </div>
                        </div>

                        <!-- 同意書サインセクション -->
                        <div style="margin-bottom: var(--space-6); padding: var(--space-4); border: 2px solid var(--border-gray); border-radius: var(--radius-lg);">
                            <h3 style="margin: 0 0 var(--space-4) 0; color: var(--text-primary); display: flex; align-items: center; gap: var(--space-2);">
                                <i class="fas fa-file-signature" style="color: var(--admin-accent);"></i>
                                同意書サイン
                            </h3>
                            <div style="margin-bottom: var(--space-4);">
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">同意書ファイル</label>
                                <input type="file" id="consent-form" accept=".pdf,.jpg,.png" style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                                <small style="color: var(--text-muted); font-size: 0.85rem;">対応形式: PDF, JPG, PNG（最大10MB）</small>
                            </div>
                            <div style="margin-bottom: var(--space-4);">
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">サイン確認</label>
                                <div style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-2);">
                                    <input type="checkbox" id="consent-confirmed" style="transform: scale(1.2);">
                                    <label for="consent-confirmed" style="font-weight: 500;">お客様の直筆サインを確認しました</label>
                                </div>
                                <div style="display: flex; align-items: center; gap: var(--space-2);">
                                    <input type="checkbox" id="consent-explained" style="transform: scale(1.2);">
                                    <label for="consent-explained" style="font-weight: 500;">サービス内容と料金について説明済み</label>
                                </div>
                            </div>
                            <div style="background: rgba(99, 102, 241, 0.1); padding: var(--space-3); border-radius: var(--radius-md); border-left: 4px solid var(--admin-accent);">
                                <div style="font-weight: 600; color: var(--admin-accent); margin-bottom: var(--space-1);">
                                    <i class="fas fa-info-circle"></i> 同意書の内容
                                </div>
                                <ul style="margin: 0; padding-left: var(--space-4); color: var(--text-secondary); font-size: 0.9rem;">
                                    <li>サービス内容の理解と同意</li>
                                    <li>料金体系の確認</li>
                                    <li>プライバシーポリシーへの同意</li>
                                    <li>キャンセルポリシーの理解</li>
                                </ul>
                            </div>
                        </div>

                        <!-- 確認者情報 -->
                        <div style="margin-bottom: var(--space-6); padding: var(--space-4); background: var(--light-gray); border-radius: var(--radius-lg);">
                            <h4 style="margin: 0 0 var(--space-3) 0; color: var(--text-primary);">確認者情報</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-3);">
                                <div>
                                    <label style="display: block; margin-bottom: var(--space-1); font-weight: 600;">確認者</label>
                                    <input type="text" id="verified-by" value="admin" readonly style="width: 100%; padding: var(--space-2); border: 1px solid var(--border-gray); border-radius: var(--radius-md); background: #f9f9f9;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: var(--space-1); font-weight: 600;">確認日時</label>
                                    <input type="text" id="verified-at" value="${new Date().toLocaleString('ja-JP')}" readonly style="width: 100%; padding: var(--space-2); border: 1px solid var(--border-gray); border-radius: var(--radius-md); background: #f9f9f9;">
                                </div>
                            </div>
                        </div>

                        <!-- アクションボタン -->
                        <div style="display: flex; gap: var(--space-3); justify-content: flex-end;">
                            <button type="button" onclick="closeIdentityModal()" style="padding: var(--space-3) var(--space-6); border: 1px solid var(--border-gray); border-radius: var(--radius-md); background: white; color: var(--text-primary); cursor: pointer;">
                                キャンセル
                            </button>
                            <button type="submit" style="padding: var(--space-3) var(--space-6); border: none; border-radius: var(--radius-md); background: var(--gradient-primary); color: white; cursor: pointer; font-weight: 600;">
                                <i class="fas fa-save"></i> 本人確認完了
                            </button>
                        </div>
                    </form>
                </div>
            `;

            document.body.appendChild(modal);

            // フォーム送信処理
            document.getElementById('identity-verification-form').addEventListener('submit', function(e) {
                e.preventDefault();
                submitIdentityVerification(memberId);
            });
        }

        // 本人確認モーダルを閉じる
        function closeIdentityModal() {
            const modal = document.getElementById('identity-modal');
            if (modal) {
                modal.remove();
            }
        }

        // 本人確認情報を送信
        function submitIdentityVerification(memberId) {
            const member = adminData.members.find(m => m.id === memberId);
            if (!member) {
                alert('会員が見つかりません');
                return;
            }

            const mynumberPhoto = document.getElementById('mynumber-photo').files[0];
            const consentForm = document.getElementById('consent-form').files[0];
            const mynumberMemo = document.getElementById('mynumber-memo').value;
            const consentConfirmed = document.getElementById('consent-confirmed').checked;
            const consentExplained = document.getElementById('consent-explained').checked;

            // バリデーション
            if (!mynumberPhoto) {
                alert('マイナンバーカードの写真をアップロードしてください');
                return;
            }

            if (!consentForm) {
                alert('同意書ファイルをアップロードしてください');
                return;
            }

            if (!consentConfirmed || !consentExplained) {
                alert('同意書の確認項目をすべてチェックしてください');
                return;
            }

            // ファイルサイズチェック
            if (mynumberPhoto.size > 5 * 1024 * 1024) {
                alert('マイナンバーカード写真のファイルサイズが大きすぎます（最大5MB）');
                return;
            }

            if (consentForm.size > 10 * 1024 * 1024) {
                alert('同意書ファイルのサイズが大きすぎます（最大10MB）');
                return;
            }

            // 実際の実装では、ここでファイルをサーバーにアップロード
            console.log('本人確認書類アップロード:', {
                memberId: memberId,
                memberName: member.name,
                mynumberPhoto: mynumberPhoto.name,
                consentForm: consentForm.name,
                mynumberMemo: mynumberMemo,
                verifiedBy: 'admin',
                verifiedAt: new Date().toISOString()
            });

            // シミュレーション：会員データを更新
            member.identityVerification = {
                mynumberPhoto: 'verified',
                mynumberPhotoUrl: `/uploads/mynumber_${member.name.toLowerCase()}_${Date.now()}.jpg`,
                consentForm: 'signed',
                consentFormUrl: `/uploads/consent_${member.name.toLowerCase()}_${Date.now()}.pdf`,
                verifiedAt: new Date().toLocaleString('ja-JP'),
                verifiedBy: 'admin',
                isFirstVisit: false,
                memo: mynumberMemo
            };

            alert(`${member.name}様の本人確認が完了しました！\n\n✅ マイナンバーカード写真: 確認済み\n✅ 同意書サイン: 確認済み\n\n書類は安全に保管され、会員情報が更新されました。`);
            
            closeIdentityModal();
            showMemberManagement(); // 画面を更新
        }

        // 本人確認書類を表示
        function viewIdentityDocuments(memberId) {
            const member = adminData.members.find(m => m.id === memberId);
            if (!member) {
                alert('会員が見つかりません');
                return;
            }

            const modal = document.createElement('div');
            modal.id = 'documents-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;

            modal.innerHTML = `
                <div style="background: white; border-radius: var(--radius-xl); padding: var(--space-8); max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: var(--space-6);">
                        <h2 style="margin: 0; color: var(--text-primary);">
                            <i class="fas fa-file-check"></i> 本人確認書類
                        </h2>
                        <button onclick="closeDocumentsModal()" style="background: none; border: none; font-size: 1.5rem; color: var(--text-muted); cursor: pointer;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div style="background: var(--light-gray); padding: var(--space-4); border-radius: var(--radius-lg); margin-bottom: var(--space-6);">
                        <div style="display: flex; align-items: center; gap: var(--space-3);">
                            <div style="width: 50px; height: 50px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem; font-weight: bold;">
                                ${member.name.charAt(0)}
                            </div>
                            <div>
                                <div style="font-weight: 600; font-size: 1.1rem;">${member.name}</div>
                                <div style="color: var(--text-muted); font-size: 0.9rem;">${member.phone} | ${member.telegramId}</div>
                                <div style="color: var(--admin-success); font-weight: 600; font-size: 0.85rem;">
                                    <i class="fas fa-check-circle"></i> 本人確認済み（${member.identityVerification.verifiedAt}）
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-6);">
                        <!-- マイナンバーカード -->
                        <div style="border: 2px solid var(--admin-success); border-radius: var(--radius-lg); padding: var(--space-4);">
                            <h3 style="margin: 0 0 var(--space-3) 0; color: var(--admin-success); display: flex; align-items: center; gap: var(--space-2);">
                                <i class="fas fa-id-card"></i>
                                マイナンバーカード
                            </h3>
                            <div style="background: #f9f9f9; border-radius: var(--radius-md); padding: var(--space-4); text-align: center; margin-bottom: var(--space-3);">
                                <i class="fas fa-image" style="font-size: 3rem; color: var(--text-muted); margin-bottom: var(--space-2);"></i>
                                <div style="font-size: 0.9rem; color: var(--text-muted);">
                                    ${member.identityVerification.mynumberPhotoUrl}
                                </div>
                                <button onclick="window.open('${member.identityVerification.mynumberPhotoUrl}', '_blank')" style="margin-top: var(--space-2); padding: var(--space-2) var(--space-4); border: 1px solid var(--border-gray); border-radius: var(--radius-md); background: white; cursor: pointer;">
                                    <i class="fas fa-external-link-alt"></i> 表示
                                </button>
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">
                                <div><strong>ステータス:</strong> <span style="color: var(--admin-success);">✅ 確認済み</span></div>
                                <div><strong>確認者:</strong> ${member.identityVerification.verifiedBy}</div>
                                <div><strong>確認日時:</strong> ${member.identityVerification.verifiedAt}</div>
                            </div>
                        </div>

                        <!-- 同意書 -->
                        <div style="border: 2px solid var(--admin-success); border-radius: var(--radius-lg); padding: var(--space-4);">
                            <h3 style="margin: 0 0 var(--space-3) 0; color: var(--admin-success); display: flex; align-items: center; gap: var(--space-2);">
                                <i class="fas fa-file-signature"></i>
                                同意書
                            </h3>
                            <div style="background: #f9f9f9; border-radius: var(--radius-md); padding: var(--space-4); text-align: center; margin-bottom: var(--space-3);">
                                <i class="fas fa-file-pdf" style="font-size: 3rem; color: #dc2626; margin-bottom: var(--space-2);"></i>
                                <div style="font-size: 0.9rem; color: var(--text-muted);">
                                    ${member.identityVerification.consentFormUrl}
                                </div>
                                <button onclick="window.open('${member.identityVerification.consentFormUrl}', '_blank')" style="margin-top: var(--space-2); padding: var(--space-2) var(--space-4); border: 1px solid var(--border-gray); border-radius: var(--radius-md); background: white; cursor: pointer;">
                                    <i class="fas fa-external-link-alt"></i> 表示
                                </button>
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">
                                <div><strong>ステータス:</strong> <span style="color: var(--admin-success);">✅ サイン済み</span></div>
                                <div><strong>確認者:</strong> ${member.identityVerification.verifiedBy}</div>
                                <div><strong>確認日時:</strong> ${member.identityVerification.verifiedAt}</div>
                            </div>
                        </div>
                    </div>

                    ${member.identityVerification.memo ? `
                        <div style="margin-top: var(--space-6); padding: var(--space-4); background: rgba(99, 102, 241, 0.1); border-radius: var(--radius-lg); border-left: 4px solid var(--admin-accent);">
                            <h4 style="margin: 0 0 var(--space-2) 0; color: var(--admin-accent);">
                                <i class="fas fa-sticky-note"></i> 確認メモ
                            </h4>
                            <p style="margin: 0; color: var(--text-secondary);">${member.identityVerification.memo}</p>
                        </div>
                    ` : ''}

                    <div style="margin-top: var(--space-6); text-align: center;">
                        <button onclick="closeDocumentsModal()" style="padding: var(--space-3) var(--space-6); border: 1px solid var(--border-gray); border-radius: var(--radius-md); background: white; color: var(--text-primary); cursor: pointer;">
                            閉じる
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        // 書類確認モーダルを閉じる
        function closeDocumentsModal() {
            const modal = document.getElementById('documents-modal');
            if (modal) {
                modal.remove();
            }
        }

        // 会員詳細表示の更新
        function viewMemberDetail(memberId) {
            const member = adminData.members.find(m => m.id === memberId);
            if (!member) {
                alert('会員が見つかりません');
                return;
            }

            alert(`会員詳細情報\n\n📝 基本情報\n氏名: ${member.name}\n電話: ${member.phone}\nTelegram: ${member.telegramId}\n\n📊 利用状況\n利用回数: ${member.visits}回\n累計支払: ¥${member.totalSpent.toLocaleString()}\nステータス: ${member.status === 'vip' ? 'VIP' : '一般'}\n\n🛡️ 本人確認\nマイナンバーカード: ${member.identityVerification.mynumberPhoto === 'verified' ? '✅ 確認済み' : '⚠️ 未確認'}\n同意書: ${member.identityVerification.consentForm === 'signed' ? '✅ サイン済み' : '⚠️ 未署名'}\n${member.identityVerification.verifiedAt ? `確認日時: ${member.identityVerification.verifiedAt}` : ''}`);
        }

        function editBooking(id) {
            alert('予約編集機能（実装予定）');
        }

        function deleteBooking(id) {
            if (confirm('この予約を削除しますか？')) {
                adminData.bookings = adminData.bookings.filter(b => b.id !== id);
                renderBookingsTable();
            }
        }

        function editCustomer(id) {
            alert('顧客編集機能（実装予定）');
        }

        function deleteCustomer(id) {
            if (confirm('この顧客を削除しますか？')) {
                adminData.customers = adminData.customers.filter(c => c.id !== id);
                renderCustomersTable();
            }
        }

        function editTherapist(id) {
            alert('スタッフ編集機能（実装予定）');
        }

        function editService(id) {
            alert('サービス編集機能（実装予定）');
        }

        function deleteService(id) {
            if (confirm('このサービスを削除しますか？')) {
                adminData.services = adminData.services.filter(s => s.id !== id);
                renderServicesTable();
            }
        }

        function saveSettings() {
            alert('設定を保存しました');
        }

        // ナビゲーション管理
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.admin-nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // 既存のアクティブ状態を削除
                    document.querySelectorAll('.admin-nav-link').forEach(l => l.classList.remove('active'));
                    
                    // 新しいアクティブ状態を設定
                    this.classList.add('active');
                    
                    // ページを表示
                    const href = this.getAttribute('href').substring(1);
                    showPage(href);
                });
            });
        });

        // モバイルレスポンシブ対応
        if (window.innerWidth <= 1024) {
            document.addEventListener('click', function(e) {
                const sidebar = document.getElementById('admin-sidebar');
                if (!sidebar.contains(e.target) && sidebar.classList.contains('open')) {
                    sidebar.classList.remove('open');
                }
            });
        }

        // 施術者管理の新機能
        
        // 施術者グリッド表示
        function renderTherapistsGrid() {
            const grid = document.getElementById('therapists-grid');
            const therapists = adminData.therapists || [];
            
            grid.innerHTML = therapists.map(therapist => `
                <div class="therapist-card" style="
                    background: white;
                    border-radius: var(--radius-xl);
                    padding: var(--space-6);
                    box-shadow: var(--shadow-md);
                    border: 2px solid transparent;
                    transition: all 0.3s ease;
                    position: relative;
                    overflow: hidden;
                ">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--gradient-primary);"></div>
                    
                    <div style="display: flex; gap: var(--space-4); margin-bottom: var(--space-4);">
                        <div style="flex-shrink: 0;">
                            <img src="${therapist.profileImage}" alt="${therapist.name}" style="
                                width: 100px;
                                height: 100px;
                                border-radius: 50%;
                                object-fit: cover;
                                border: 3px solid var(--accent-purple);
                            " onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div style="
                                width: 100px;
                                height: 100px;
                                border-radius: 50%;
                                background: var(--light-gray);
                                display: none;
                                align-items: center;
                                justify-content: center;
                                color: var(--text-muted);
                                border: 3px solid var(--accent-purple);
                            ">
                                <i class="fas fa-user" style="font-size: 2rem;"></i>
                            </div>
                        </div>
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-2);">
                                <h3 style="margin: 0; color: var(--text-primary);">${therapist.name}</h3>
                                ${therapist.nominationFee ? `
                                    <span style="
                                        background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
                                        color: white;
                                        padding: var(--space-1) var(--space-2);
                                        border-radius: var(--radius-full);
                                        font-size: 0.7rem;
                                        font-weight: 600;
                                    ">指名料+1,000円</span>
                                ` : ''}
                            </div>
                            <div style="margin-bottom: var(--space-2);">
                                <span style="
                                    background: rgba(99, 102, 241, 0.1);
                                    color: var(--accent-purple);
                                    padding: var(--space-1) var(--space-3);
                                    border-radius: var(--radius-full);
                                    font-size: 0.8rem;
                                    font-weight: 600;
                                ">${therapist.specialty}</span>
                                <span style="
                                    background: rgba(16, 185, 129, 0.1);
                                    color: var(--admin-success);
                                    padding: var(--space-1) var(--space-3);
                                    border-radius: var(--radius-full);
                                    font-size: 0.8rem;
                                    font-weight: 600;
                                    margin-left: var(--space-2);
                                ">経験: ${therapist.experience}</span>
                            </div>
                            <p style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.5; margin: 0;">
                                ${therapist.description.length > 80 ? therapist.description.substring(0, 80) + '...' : therapist.description}
                            </p>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: var(--space-4);">
                        <h5 style="margin: 0 0 var(--space-2) 0; color: var(--text-primary); font-size: 0.9rem;">今週のスケジュール</h5>
                        <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: var(--space-1); font-size: 0.7rem;">
                            ${renderTherapistWeeklySchedule(therapist)}
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: var(--space-2); justify-content: flex-end;">
                        <button class="btn btn-small" onclick="editTherapist(${therapist.id})" style="background: #10b981; color: white;">
                            <i class="fas fa-edit"></i> 編集
                        </button>
                        <button class="btn btn-small" onclick="manageTherapistSchedule(${therapist.id})" style="background: #3b82f6; color: white;">
                            <i class="fas fa-calendar"></i> スケジュール
                        </button>
                        <button class="btn btn-small" onclick="deleteTherapist(${therapist.id})" style="background: #ef4444; color: white;">
                            <i class="fas fa-trash"></i> 削除
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // 施術者の今週スケジュール表示
        function renderTherapistWeeklySchedule(therapist) {
            const days = ['月', '火', '水', '木', '金', '土', '日'];
            const today = new Date();
            const currentWeekDates = [];
            
            // 今週の日付を計算（月曜日から開始）
            const currentDay = today.getDay();
            const mondayOffset = currentDay === 0 ? -6 : 1 - currentDay;
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + mondayOffset + i);
                currentWeekDates.push(date.toISOString().split('T')[0]);
            }
            
            return currentWeekDates.map((date, index) => {
                const daySchedule = therapist.weeklySchedule[date];
                const isAvailable = daySchedule && daySchedule.available;
                
                return `
                    <div style="
                        text-align: center;
                        padding: var(--space-1);
                        border-radius: var(--radius-sm);
                        background: ${isAvailable ? '#10b981' : '#ef4444'};
                        color: white;
                        font-weight: 600;
                    ">
                        ${days[index]}
                    </div>
                `;
            }).join('');
        }

        // 新規施術者追加
        function addNewTherapist() {
            if (adminData.therapists.length >= 3) {
                alert('施術者は最大3名まで登録可能です');
                return;
            }
            
            document.getElementById('therapist-editor').style.display = 'block';
            document.getElementById('therapist-editor-title').textContent = '新規施術者追加';
            document.getElementById('therapist-form').reset();
            document.getElementById('therapist-id').value = '';
            
            // 画像プレビューをリセット
            document.getElementById('therapist-image-preview').innerHTML = `
                <div style="width: 200px; height: 200px; margin: 0 auto; border-radius: 50%; background: var(--light-gray); display: flex; align-items: center; justify-content: center; color: var(--text-muted);">
                    <i class="fas fa-user" style="font-size: 3rem;"></i>
                </div>
            `;
            
            generateWeeklyScheduleGrid();
        }

        // 施術者編集
        function editTherapist(id) {
            const therapist = adminData.therapists.find(t => t.id === id);
            if (!therapist) return;
            
            document.getElementById('therapist-editor').style.display = 'block';
            document.getElementById('therapist-editor-title').textContent = '施術者編集';
            
            // フォームに値を設定
            document.getElementById('therapist-id').value = therapist.id;
            document.getElementById('therapist-name').value = therapist.name;
            document.getElementById('therapist-specialty').value = therapist.specialty;
            document.getElementById('therapist-description').value = therapist.description;
            document.getElementById('therapist-experience').value = therapist.experience;
            document.getElementById('therapist-nomination-fee').checked = therapist.nominationFee;
            
            // 指名料金の表示を更新
            toggleNominationFee();
            
            // 画像プレビューを設定
            if (therapist.profileImage) {
                document.getElementById('therapist-image-preview').innerHTML = `
                    <img src="${therapist.profileImage}" alt="${therapist.name}" style="
                        width: 200px;
                        height: 200px;
                        border-radius: 50%;
                        object-fit: cover;
                        margin: 0 auto;
                        display: block;
                    ">
                `;
            }
            
            generateWeeklyScheduleGrid(therapist.weeklySchedule);
        }

        // 施術者削除
        function deleteTherapist(id) {
            const therapist = adminData.therapists.find(t => t.id === id);
            if (!therapist) return;
            
            if (confirm(`${therapist.name}さんを削除しますか？この操作は取り消せません。`)) {
                const index = adminData.therapists.findIndex(t => t.id === id);
                if (index !== -1) {
                    adminData.therapists.splice(index, 1);
                    renderTherapistsGrid();
                    alert('施術者が削除されました');
                }
            }
        }

        // 施術者エディター閉じる
        function closeTherapistEditor() {
            document.getElementById('therapist-editor').style.display = 'none';
        }

        // 指名料金トグル
        function toggleNominationFee() {
            const checkbox = document.getElementById('therapist-nomination-fee');
            const note = document.getElementById('nomination-fee-note');
            note.style.display = checkbox.checked ? 'block' : 'none';
        }

        // 施術者画像ハンドリング
        function handleTherapistImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('therapist-image-preview').innerHTML = `
                        <img src="${e.target.result}" alt="プロフィール画像" style="
                            width: 200px;
                            height: 200px;
                            border-radius: 50%;
                            object-fit: cover;
                            margin: 0 auto;
                            display: block;
                        ">
                    `;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // 今週のスケジュールグリッド生成
        function generateWeeklyScheduleGrid(existingSchedule = null) {
            const today = new Date();
            const timeSlots = [
                '18:00-21:00', '19:00-22:00', '20:00-23:00', 
                '21:00-24:00', '22:00-01:00', '23:00-02:00', '24:00-03:00'
            ];
            
            // 今週の日付を計算
            const currentWeekDates = [];
            const currentDay = today.getDay();
            const mondayOffset = currentDay === 0 ? -6 : 1 - currentDay;
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + mondayOffset + i);
                currentWeekDates.push(date.toISOString().split('T')[0]);
            }
            
            const container = document.getElementById('schedule-time-slots');
            container.innerHTML = `
                <div style="margin-bottom: var(--space-4);">
                    <label style="font-weight: 600; color: var(--text-primary);">利用可能時間帯を選択</label>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: var(--space-2); margin-top: var(--space-2);">
                        ${timeSlots.map(slot => `
                            <div class="time-slot-selector" data-time="${slot}" style="
                                padding: var(--space-2);
                                border: 2px solid var(--border-gray);
                                border-radius: var(--radius-md);
                                text-align: center;
                                cursor: pointer;
                                transition: all 0.3s ease;
                                font-size: 0.8rem;
                                font-weight: 600;
                            " onclick="toggleTimeSlot(this)">
                                ${slot}
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div>
                    <label style="font-weight: 600; color: var(--text-primary);">各曜日の設定</label>
                    <div id="daily-schedule-grid" style="display: grid; gap: var(--space-3); margin-top: var(--space-3);">
                        ${currentWeekDates.map((date, index) => {
                            const dayName = ['月', '火', '水', '木', '金', '土', '日'][index];
                            const existingDay = existingSchedule && existingSchedule[date];
                            
                            return `
                                <div class="daily-schedule-row" data-date="${date}" style="
                                    display: grid;
                                    grid-template-columns: 60px 120px 1fr;
                                    gap: var(--space-3);
                                    align-items: center;
                                    padding: var(--space-3);
                                    background: var(--light-gray);
                                    border-radius: var(--radius-md);
                                ">
                                    <div style="font-weight: 600; text-align: center;">${dayName}</div>
                                    <label style="display: flex; align-items: center; gap: var(--space-2);">
                                        <input type="checkbox" class="day-available" data-date="${date}" ${existingDay && existingDay.available ? 'checked' : ''} onchange="toggleDayAvailability('${date}')">
                                        <span>出勤可能</span>
                                    </label>
                                    <div class="day-time-slots" data-date="${date}" style="display: ${existingDay && existingDay.available ? 'block' : 'none'};">
                                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: var(--space-1);">
                                            ${timeSlots.map(slot => `
                                                <div class="day-time-slot" data-date="${date}" data-time="${slot}" style="
                                                    padding: var(--space-1);
                                                    border: 1px solid var(--border-gray);
                                                    border-radius: var(--radius-sm);
                                                    text-align: center;
                                                    cursor: pointer;
                                                    font-size: 0.7rem;
                                                    background: ${existingDay && existingDay.timeSlots && existingDay.timeSlots.includes(slot) ? 'var(--accent-purple)' : 'white'};
                                                    color: ${existingDay && existingDay.timeSlots && existingDay.timeSlots.includes(slot) ? 'white' : 'var(--text-primary)'};
                                                " onclick="toggleDayTimeSlot('${date}', '${slot}', this)">
                                                    ${slot}
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        // 時間スロット選択トグル
        function toggleTimeSlot(element) {
            element.classList.toggle('selected');
            if (element.classList.contains('selected')) {
                element.style.background = 'var(--accent-purple)';
                element.style.color = 'white';
                element.style.borderColor = 'var(--accent-purple)';
            } else {
                element.style.background = 'white';
                element.style.color = 'var(--text-primary)';
                element.style.borderColor = 'var(--border-gray)';
            }
        }

        // 曜日出勤可能性トグル
        function toggleDayAvailability(date) {
            const checkbox = document.querySelector(`input[data-date="${date}"]`);
            const timeSlotsContainer = document.querySelector(`.day-time-slots[data-date="${date}"]`);
            
            if (checkbox.checked) {
                timeSlotsContainer.style.display = 'block';
            } else {
                timeSlotsContainer.style.display = 'none';
                // 時間スロットをリセット
                const timeSlots = timeSlotsContainer.querySelectorAll('.day-time-slot');
                timeSlots.forEach(slot => {
                    slot.style.background = 'white';
                    slot.style.color = 'var(--text-primary)';
                });
            }
        }

        // 曜日時間スロットトグル
        function toggleDayTimeSlot(date, time, element) {
            const isSelected = element.style.background === 'var(--accent-purple)' || element.style.background.includes('99, 102, 241');
            
            if (isSelected) {
                element.style.background = 'white';
                element.style.color = 'var(--text-primary)';
            } else {
                element.style.background = 'var(--accent-purple)';
                element.style.color = 'white';
            }
        }

        // 施術者保存
        function saveTherapist() {
            const form = document.getElementById('therapist-form');
            const formData = new FormData(form);
            
            const name = document.getElementById('therapist-name').value;
            const specialty = document.getElementById('therapist-specialty').value;
            const description = document.getElementById('therapist-description').value;
            const experience = document.getElementById('therapist-experience').value;
            const nominationFee = document.getElementById('therapist-nomination-fee').checked;
            const id = document.getElementById('therapist-id').value;
            
            if (!name.trim()) {
                alert('施術者名を入力してください');
                return;
            }
            
            // スケジュールデータを収集
            const weeklySchedule = {};
            const dayRows = document.querySelectorAll('.daily-schedule-row');
            
            dayRows.forEach(row => {
                const date = row.dataset.date;
                const availableCheckbox = row.querySelector('.day-available');
                const timeSlotElements = row.querySelectorAll('.day-time-slot');
                
                if (availableCheckbox.checked) {
                    const selectedTimeSlots = [];
                    timeSlotElements.forEach(slotElement => {
                        const isSelected = slotElement.style.background === 'var(--accent-purple)' || 
                                         slotElement.style.background.includes('99, 102, 241');
                        if (isSelected) {
                            selectedTimeSlots.push(slotElement.dataset.time);
                        }
                    });
                    
                    weeklySchedule[date] = {
                        available: true,
                        timeSlots: selectedTimeSlots
                    };
                } else {
                    weeklySchedule[date] = {
                        available: false,
                        timeSlots: []
                    };
                }
            });
            
            // 画像URLを取得
            const imagePreview = document.querySelector('#therapist-image-preview img');
            const profileImage = imagePreview ? imagePreview.src : '/images/therapists/default-avatar.jpg';
            
            const therapistData = {
                name: name,
                specialty: specialty,
                description: description,
                experience: experience,
                profileImage: profileImage,
                nominationFee: nominationFee,
                status: 'active',
                schedule: [], // 従来のスケジュール形式も保持
                weeklySchedule: weeklySchedule
            };
            
            if (id) {
                // 編集
                const therapist = adminData.therapists.find(t => t.id === parseInt(id));
                if (therapist) {
                    Object.assign(therapist, therapistData);
                    alert('施術者情報が更新されました');
                }
            } else {
                // 新規追加
                const newId = Math.max(...adminData.therapists.map(t => t.id), 0) + 1;
                adminData.therapists.push({
                    id: newId,
                    ...therapistData
                });
                alert('新しい施術者が追加されました');
            }
            
            closeTherapistEditor();
            renderTherapistsGrid();
        }

        // 施術者下書き保存
        function saveTherapistDraft() {
            alert('下書きとして保存されました（実装予定）');
        }

        // 施術者スケジュール管理
        function manageTherapistSchedule(id) {
            const therapist = adminData.therapists.find(t => t.id === id);
            if (!therapist) return;
            
            // 専用のスケジュール管理モーダルを開く
            alert(`${therapist.name}さんのスケジュール管理（詳細実装予定）`);
        }

        // 一括スケジュール管理
        function bulkScheduleManagement() {
            alert('全施術者の今週スケジュール一括管理（実装予定）');
        }

        // レビュー管理データ
        let reviewsData = [
            {
                id: 1,
                customer: '田中太郎',
                rating: 5,
                service: 'マッサージ 90分',
                therapist: '田中美香',
                date: '2024-06-10',
                comment: 'いつも仕事の疲れを癒してもらっています。ホテルの部屋でリラックスできるし、施術者の方の技術も素晴らしいです。出張でホテル宿泊時によく利用させていただいてます。',
                status: 'published',
                isPublic: true
            },
            {
                id: 2,
                customer: '佐藤花子',
                rating: 5,
                service: 'アカスリ 60分',
                therapist: '佐藤恵子',
                date: '2024-06-08',
                comment: 'アカスリを初めて体験しましたが、お肌がこんなにツルツルになるとは驚きでした！ホテルまで来ていただけるので移動も楽で、女性でも安心して利用できるサービスです。',
                status: 'published',
                isPublic: true
            },
            {
                id: 3,
                customer: '山田一郎',
                rating: 5,
                service: 'マッサージ 120分',
                therapist: '田中美香',
                date: '2024-06-12',
                comment: '深夜まで営業していて本当に助かります。仕事が終わった後にホテルでゆっくりできる貴重なサービスです。コンビネーションコースは最高で、心身ともにリフレッシュできます。',
                status: 'published',
                isPublic: true
            }
        ];

        // 営業時間データ
        let businessHoursData = {
            weekdays: {
                monday: { open: '18:00', close: '03:00' },
                tuesday: { open: '18:00', close: '03:00' },
                wednesday: { open: '18:00', close: '03:00' },
                thursday: { open: '18:00', close: '03:00' }
            },
            weekend: {
                friday: { open: '18:00', close: '05:00' },
                saturday: { open: '18:00', close: '05:00' }
            },
            sunday: { open: '18:00', close: '01:00' },
            holidays: { open: '18:00', close: '01:00' },
            lastOrder: '1時間前',
            notes: '完全予約制'
        };

        // サービス料金データ（改良版）
        let pricingData = {
            individual: {
                title: '1名様コース',
                icon: 'fas fa-user',
                color: '#6366f1',
                services: [
                    {
                        duration: 60,
                        price: 15000,
                        name: 'スタンダード',
                        description: 'リラクゼーションマッサージ + ハンドマッサージ',
                        popular: false
                    },
                    {
                        duration: 90,
                        price: 20000,
                        name: 'プレミアム',
                        description: 'フルボディマッサージ + ハンドマッサージ',
                        popular: true
                    },
                    {
                        duration: 120,
                        price: 30000,
                        name: 'ラグジュアリー',
                        description: 'プレミアムコース + 特別ケア',
                        popular: false
                    }
                ]
            },
            couple: {
                title: '2名様コース',
                icon: 'fas fa-user-friends',
                color: '#f59e0b',
                services: [
                    {
                        duration: 90,
                        price: 35000,
                        name: 'カップルスタンダード',
                        description: '2名同時施術 + ハンドマッサージ',
                        note: 'ホテル料金1.5倍',
                        popular: true
                    },
                    {
                        duration: 120,
                        price: 50000,
                        name: 'カップルプレミアム',
                        description: '2名同時施術 + 特別ケア',
                        note: 'ホテル料金1.5倍',
                        popular: false
                    }
                ]
            },
            extension: {
                title: '延長サービス',
                icon: 'fas fa-clock',
                color: '#10b981',
                services: [
                    {
                        duration: 30,
                        price: 8000,
                        name: '1名様延長',
                        description: '30分延長サービス',
                        note: '事前予約制'
                    },
                    {
                        duration: 30,
                        price: 12000,
                        name: '2名様延長',
                        description: '30分延長サービス（2名）',
                        note: '事前予約制'
                    }
                ]
            },
            nomination: {
                title: '指名料',
                icon: 'fas fa-star',
                color: '#ef4444',
                fee: 1000,
                description: '特定の施術者をご指名いただく場合の追加料金です',
                note: '施術者により異なります'
            }
        };

        // レビュー管理表示
        function showReviews() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header">
                    <h1 class="admin-title">
                        <i class="fas fa-star"></i> レビュー管理
                    </h1>
                    <div style="display: flex; gap: var(--space-4);">
                        <button class="btn btn-primary" onclick="addNewReview()">
                            <i class="fas fa-plus"></i> 新規レビュー追加
                        </button>
                        <button class="btn btn-secondary" onclick="exportReviews()">
                            <i class="fas fa-download"></i> エクスポート
                        </button>
                    </div>
                </header>

                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">レビュー一覧</h3>
                        <div style="display: flex; gap: var(--space-3);">
                            <select id="review-status-filter" onchange="filterReviews()">
                                <option value="all">すべて</option>
                                <option value="published">公開中</option>
                                <option value="pending">承認待ち</option>
                                <option value="hidden">非表示</option>
                            </select>
                            <select id="review-rating-filter" onchange="filterReviews()">
                                <option value="all">すべての評価</option>
                                <option value="5">★★★★★</option>
                                <option value="4">★★★★☆</option>
                                <option value="3">★★★☆☆</option>
                                <option value="2">★★☆☆☆</option>
                                <option value="1">★☆☆☆☆</option>
                            </select>
                        </div>
                    </div>
                    <div class="admin-card-content">
                        <div id="reviews-list"></div>
                    </div>
                </div>

                <div class="admin-card" style="margin-top: var(--space-8);">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">レビュー統計</h3>
                    </div>
                    <div class="admin-card-content">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-6);">
                            <div style="text-align: center; padding: var(--space-4);">
                                <div style="font-size: 2.5rem; font-weight: bold; color: var(--admin-success);" id="average-rating">4.9</div>
                                <div>平均評価</div>
                            </div>
                            <div style="text-align: center; padding: var(--space-4);">
                                <div style="font-size: 2.5rem; font-weight: bold; color: var(--admin-accent);" id="total-reviews">3</div>
                                <div>総レビュー数</div>
                            </div>
                            <div style="text-align: center; padding: var(--space-4);">
                                <div style="font-size: 2.5rem; font-weight: bold; color: var(--admin-warning);" id="pending-reviews">0</div>
                                <div>承認待ち</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            renderReviewsList();
            updateReviewStats();
        }

        // レビューリスト表示
        function renderReviewsList() {
            const listElement = document.getElementById('reviews-list');
            if (!listElement) return;

            const statusFilter = document.getElementById('review-status-filter')?.value || 'all';
            const ratingFilter = document.getElementById('review-rating-filter')?.value || 'all';

            let filteredReviews = reviewsData;
            if (statusFilter !== 'all') {
                filteredReviews = filteredReviews.filter(r => r.status === statusFilter);
            }
            if (ratingFilter !== 'all') {
                filteredReviews = filteredReviews.filter(r => r.rating === parseInt(ratingFilter));
            }

            listElement.innerHTML = filteredReviews.map(review => `
                <div class="review-item" style="border: 1px solid var(--admin-border); border-radius: var(--radius-lg); padding: var(--space-6); margin-bottom: var(--space-4);">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--space-4);">
                        <div>
                            <div style="display: flex; align-items: center; gap: var(--space-3); margin-bottom: var(--space-2);">
                                <div style="font-weight: bold; color: var(--text-primary);">${review.customer}</div>
                                <div style="color: #fbbf24;">${'★'.repeat(review.rating)}${'☆'.repeat(5 - review.rating)}</div>
                                <span class="review-status ${review.status}" style="padding: var(--space-1) var(--space-2); border-radius: var(--radius-md); font-size: 0.8rem; font-weight: 600;">
                                    ${review.status === 'published' ? '公開中' : review.status === 'pending' ? '承認待ち' : '非表示'}
                                </span>
                            </div>
                            <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: var(--space-2);">
                                ${review.service} | 担当: ${review.therapist} | ${review.date}
                            </div>
                        </div>
                        <div style="display: flex; gap: var(--space-2);">
                            <button class="btn btn-small" onclick="editReview(${review.id})" style="padding: var(--space-1) var(--space-2);">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-small ${review.status === 'published' ? 'btn-warning' : 'btn-success'}" onclick="toggleReviewStatus(${review.id})" style="padding: var(--space-1) var(--space-2);">
                                <i class="fas ${review.status === 'published' ? 'fa-eye-slash' : 'fa-eye'}"></i>
                            </button>
                            <button class="btn btn-small btn-danger" onclick="deleteReview(${review.id})" style="padding: var(--space-1) var(--space-2);">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div style="background: var(--light-gray); padding: var(--space-4); border-radius: var(--radius-md);">
                        "${review.comment}"
                    </div>
                </div>
            `).join('');
        }

        // 営業時間管理表示（設定画面内に統合）
        function showSettings() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header">
                    <h1 class="admin-title">
                        <i class="fas fa-cog"></i> 設定管理
                    </h1>
                </header>

                <!-- 営業時間設定 -->
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">
                            <i class="fas fa-clock"></i> 営業時間設定
                        </h3>
                    </div>
                    <div class="admin-card-content">
                        <div id="business-hours-form"></div>
                    </div>
                </div>

                <!-- 料金設定 -->
                <div class="admin-card" style="margin-top: var(--space-8);">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">
                            <i class="fas fa-yen-sign"></i> 料金設定
                        </h3>
                        <button class="btn btn-primary" onclick="addNewPriceCategory()">
                            <i class="fas fa-plus"></i> カテゴリ追加
                        </button>
                    </div>
                    <div class="admin-card-content">
                        <div id="pricing-form"></div>
                    </div>
                </div>

                <!-- その他設定 -->
                <div class="admin-card" style="margin-top: var(--space-8);">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">
                            <i class="fas fa-tools"></i> その他設定
                        </h3>
                    </div>
                    <div class="admin-card-content">
                        <div style="display: grid; gap: var(--space-6);">
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">
                                    最終受付時間（営業終了前）
                                </label>
                                <select style="width: 200px; padding: var(--space-2); border: 1px solid var(--admin-border); border-radius: var(--radius-md);">
                                    <option value="60">1時間前</option>
                                    <option value="90">1.5時間前</option>
                                    <option value="120">2時間前</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">
                                    予約システム
                                </label>
                                <div style="display: flex; gap: var(--space-4);">
                                    <label>
                                        <input type="checkbox" checked> 完全予約制
                                    </label>
                                    <label>
                                        <input type="checkbox" checked> 当日予約可
                                    </label>
                                    <label>
                                        <input type="checkbox"> 当日キャンセル可
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            renderBusinessHoursForm();
            renderPricingForm();
        }

        // 営業時間フォーム表示
        function renderBusinessHoursForm() {
            const formElement = document.getElementById('business-hours-form');
            if (!formElement) return;

            const dayNames = {
                monday: '月曜日',
                tuesday: '火曜日', 
                wednesday: '水曜日',
                thursday: '木曜日',
                friday: '金曜日',
                saturday: '土曜日'
            };

            formElement.innerHTML = `
                <div style="display: grid; gap: var(--space-6);">
                    <div style="background: rgba(99, 102, 241, 0.1); padding: var(--space-4); border-radius: var(--radius-lg); border-left: 4px solid #6366f1;">
                        <h4 style="margin: 0 0 var(--space-2) 0; color: #6366f1;">
                            <i class="fas fa-info-circle"></i> 営業時間について
                        </h4>
                        <p style="margin: 0; font-size: 0.9rem; color: var(--text-secondary);">
                            営業時間は施術者の都合により変更される場合があります。お客様向けの表示に自動反映されます。
                        </p>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--space-6);">
                        <div class="time-group">
                            <h4 style="margin-bottom: var(--space-4); color: var(--admin-primary);">
                                <i class="fas fa-calendar-week"></i> 平日（月〜木）
                            </h4>
                            ${Object.entries(dayNames).filter(([key]) => ['monday', 'tuesday', 'wednesday', 'thursday'].includes(key)).map(([key, name]) => `
                                <div style="display: flex; align-items: center; gap: var(--space-3); margin-bottom: var(--space-3);">
                                    <span style="width: 60px; font-size: 0.9rem;">${name}</span>
                                    <input type="time" value="${businessHoursData.weekdays[key].open}" 
                                           onchange="updateBusinessHours('weekdays', '${key}', 'open', this.value)"
                                           style="padding: var(--space-2); border: 1px solid var(--admin-border); border-radius: var(--radius-md);">
                                    <span>〜</span>
                                    <input type="time" value="${businessHoursData.weekdays[key].close}" 
                                           onchange="updateBusinessHours('weekdays', '${key}', 'close', this.value)"
                                           style="padding: var(--space-2); border: 1px solid var(--admin-border); border-radius: var(--radius-md);">
                                </div>
                            `).join('')}
                        </div>

                        <div class="time-group">
                            <h4 style="margin-bottom: var(--space-4); color: var(--admin-primary);">
                                <i class="fas fa-calendar"></i> 週末（金・土）
                            </h4>
                            ${Object.entries(dayNames).filter(([key]) => ['friday', 'saturday'].includes(key)).map(([key, name]) => `
                                <div style="display: flex; align-items: center; gap: var(--space-3); margin-bottom: var(--space-3);">
                                    <span style="width: 60px; font-size: 0.9rem;">${name}</span>
                                    <input type="time" value="${businessHoursData.weekend[key].open}" 
                                           onchange="updateBusinessHours('weekend', '${key}', 'open', this.value)"
                                           style="padding: var(--space-2); border: 1px solid var(--admin-border); border-radius: var(--radius-md);">
                                    <span>〜</span>
                                    <input type="time" value="${businessHoursData.weekend[key].close}" 
                                           onchange="updateBusinessHours('weekend', '${key}', 'close', this.value)"
                                           style="padding: var(--space-2); border: 1px solid var(--admin-border); border-radius: var(--radius-md);">
                                </div>
                            `).join('')}
                        </div>

                        <div class="time-group">
                            <h4 style="margin-bottom: var(--space-4); color: var(--admin-primary);">
                                <i class="fas fa-calendar-day"></i> 日曜・祝日
                            </h4>
                            <div style="display: flex; align-items: center; gap: var(--space-3); margin-bottom: var(--space-3);">
                                <span style="width: 60px; font-size: 0.9rem;">日・祝</span>
                                <input type="time" value="${businessHoursData.sunday.open}" 
                                       onchange="updateBusinessHours('sunday', null, 'open', this.value)"
                                       style="padding: var(--space-2); border: 1px solid var(--admin-border); border-radius: var(--radius-md);">
                                <span>〜</span>
                                <input type="time" value="${businessHoursData.sunday.close}" 
                                       onchange="updateBusinessHours('sunday', null, 'close', this.value)"
                                       style="padding: var(--space-2); border: 1px solid var(--admin-border); border-radius: var(--radius-md);">
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; justify-content: flex-end; gap: var(--space-3); padding-top: var(--space-4); border-top: 1px solid var(--admin-border);">
                        <button class="btn btn-secondary" onclick="resetBusinessHours()">
                            <i class="fas fa-undo"></i> リセット
                        </button>
                        <button class="btn btn-primary" onclick="saveBusinessHours()">
                            <i class="fas fa-save"></i> 保存
                        </button>
                    </div>
                </div>
            `;
        }

        // 料金設定フォーム表示（改良版）
        function renderPricingForm() {
            const formElement = document.getElementById('pricing-form');
            if (!formElement) return;

            formElement.innerHTML = `
                <div style="display: grid; gap: var(--space-8);">
                    ${Object.entries(pricingData).map(([categoryKey, category]) => {
                        if (categoryKey === 'nomination') {
                            return `
                                <div class="pricing-category" style="border: 2px solid ${category.color}; border-radius: var(--radius-xl); padding: var(--space-6);">
                                    <div style="display: flex; align-items: center; gap: var(--space-3); margin-bottom: var(--space-4);">
                                        <div style="width: 50px; height: 50px; background: ${category.color}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                                            <i class="${category.icon}"></i>
                                        </div>
                                        <div>
                                            <h4 style="margin: 0; color: ${category.color};">${category.title}</h4>
                                            <p style="margin: 0; font-size: 0.9rem; color: var(--text-secondary);">${category.description}</p>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: var(--space-4);">
                                        <span style="font-weight: 600;">指名料:</span>
                                        <div style="display: flex; align-items: center; gap: var(--space-2);">
                                            <span>¥</span>
                                            <input type="number" value="${category.fee}" 
                                                   onchange="updateNominationFee(this.value)"
                                                   style="width: 100px; padding: var(--space-2); border: 1px solid var(--admin-border); border-radius: var(--radius-md);">
                                        </div>
                                        <span style="font-size: 0.9rem; color: var(--text-muted);">${category.note}</span>
                                    </div>
                                </div>
                            `;
                        }
                        
                        return `
                            <div class="pricing-category" style="border: 2px solid ${category.color}; border-radius: var(--radius-xl); padding: var(--space-6);">
                                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-6);">
                                    <div style="display: flex; align-items: center; gap: var(--space-3);">
                                        <div style="width: 50px; height: 50px; background: ${category.color}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                                            <i class="${category.icon}"></i>
                                        </div>
                                        <h4 style="margin: 0; color: ${category.color};">${category.title}</h4>
                                    </div>
                                    <button class="btn btn-small" onclick="addNewService('${categoryKey}')" style="background: ${category.color}; color: white;">
                                        <i class="fas fa-plus"></i> サービス追加
                                    </button>
                                </div>
                                
                                <div style="display: grid; gap: var(--space-4);">
                                    ${category.services.map((service, index) => `
                                        <div class="service-item" style="background: rgba(255,255,255,0.8); padding: var(--space-4); border-radius: var(--radius-lg); border: 1px solid ${category.color}; position: relative;">
                                            ${service.popular ? '<div style="position: absolute; top: -10px; right: 20px; background: #ef4444; color: white; padding: var(--space-1) var(--space-2); border-radius: var(--radius-md); font-size: 0.8rem; font-weight: 600;">人気</div>' : ''}
                                            
                                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: var(--space-4); align-items: center;">
                                                <div>
                                                    <label style="display: block; font-size: 0.8rem; color: var(--text-muted); margin-bottom: var(--space-1);">コース名</label>
                                                    <input type="text" value="${service.name}" 
                                                           onchange="updateServiceField('${categoryKey}', ${index}, 'name', this.value)"
                                                           style="width: 100%; padding: var(--space-2); border: 1px solid var(--admin-border); border-radius: var(--radius-md);">
                                                </div>
                                                
                                                <div>
                                                    <label style="display: block; font-size: 0.8rem; color: var(--text-muted); margin-bottom: var(--space-1);">時間（分）</label>
                                                    <input type="number" value="${service.duration}" 
                                                           onchange="updateServiceField('${categoryKey}', ${index}, 'duration', this.value)"
                                                           style="width: 100%; padding: var(--space-2); border: 1px solid var(--admin-border); border-radius: var(--radius-md);">
                                                </div>
                                                
                                                <div>
                                                    <label style="display: block; font-size: 0.8rem; color: var(--text-muted); margin-bottom: var(--space-1);">料金（円）</label>
                                                    <input type="number" value="${service.price}" 
                                                           onchange="updateServiceField('${categoryKey}', ${index}, 'price', this.value)"
                                                           style="width: 100%; padding: var(--space-2); border: 1px solid var(--admin-border); border-radius: var(--radius-md);">
                                                </div>
                                                
                                                <div style="display: flex; flex-direction: column; gap: var(--space-1);">
                                                    <button class="btn btn-small" onclick="toggleServicePopular('${categoryKey}', ${index})" 
                                                            style="background: ${service.popular ? '#ef4444' : 'var(--text-muted)'}; color: white; font-size: 0.7rem;">
                                                        <i class="fas fa-star"></i>
                                                    </button>
                                                    <button class="btn btn-small btn-danger" onclick="removeService('${categoryKey}', ${index})" style="font-size: 0.7rem;">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div style="margin-top: var(--space-3);">
                                                <label style="display: block; font-size: 0.8rem; color: var(--text-muted); margin-bottom: var(--space-1);">説明</label>
                                                <input type="text" value="${service.description || ''}" 
                                                       onchange="updateServiceField('${categoryKey}', ${index}, 'description', this.value)"
                                                       style="width: 100%; padding: var(--space-2); border: 1px solid var(--admin-border); border-radius: var(--radius-md);">
                                            </div>
                                            
                                            ${service.note ? `
                                                <div style="margin-top: var(--space-2);">
                                                    <label style="display: block; font-size: 0.8rem; color: var(--text-muted); margin-bottom: var(--space-1);">注意事項</label>
                                                    <input type="text" value="${service.note}" 
                                                           onchange="updateServiceField('${categoryKey}', ${index}, 'note', this.value)"
                                                           style="width: 100%; padding: var(--space-2); border: 1px solid var(--admin-border); border-radius: var(--radius-md);">
                                                </div>
                                            ` : ''}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    }).join('')}
                    
                    <div style="display: flex; justify-content: flex-end; gap: var(--space-3); padding-top: var(--space-4); border-top: 1px solid var(--admin-border);">
                        <button class="btn btn-secondary" onclick="previewPricing()">
                            <i class="fas fa-eye"></i> プレビュー
                        </button>
                        <button class="btn btn-primary" onclick="savePricingData()">
                            <i class="fas fa-save"></i> 保存
                        </button>
                    </div>
                </div>
            `;
        }

        // レビュー関連の関数
        function addNewReview() {
            // 新規レビュー追加モーダル（実装省略）
            alert('新規レビュー追加機能（実装予定）');
        }

        function editReview(id) {
            alert(`レビューID ${id} の編集（実装予定）`);
        }

        function toggleReviewStatus(id) {
            const review = reviewsData.find(r => r.id === id);
            if (review) {
                review.status = review.status === 'published' ? 'hidden' : 'published';
                renderReviewsList();
                updateReviewStats();
            }
        }

        function deleteReview(id) {
            if (confirm('このレビューを削除しますか？')) {
                reviewsData = reviewsData.filter(r => r.id !== id);
                renderReviewsList();
                updateReviewStats();
            }
        }

        function filterReviews() {
            renderReviewsList();
        }

        function updateReviewStats() {
            const totalReviews = reviewsData.length;
            const averageRating = totalReviews > 0 ? 
                (reviewsData.reduce((sum, r) => sum + r.rating, 0) / totalReviews).toFixed(1) : 0;
            const pendingReviews = reviewsData.filter(r => r.status === 'pending').length;

            document.getElementById('total-reviews').textContent = totalReviews;
            document.getElementById('average-rating').textContent = averageRating;
            document.getElementById('pending-reviews').textContent = pendingReviews;
        }

        // 営業時間関連の関数
        function updateBusinessHours(category, day, field, value) {
            if (category === 'sunday') {
                businessHoursData.sunday[field] = value;
            } else if (day) {
                businessHoursData[category][day][field] = value;
            }
        }

        function saveBusinessHours() {
            alert('営業時間が保存されました');
            console.log('Business Hours Saved:', businessHoursData);
        }

        function resetBusinessHours() {
            if (confirm('営業時間をデフォルトに戻しますか？')) {
                // デフォルト値にリセット
                renderBusinessHoursForm();
            }
        }

        // 料金設定関連の関数
        function updateServiceField(categoryKey, serviceIndex, field, value) {
            if (field === 'price' || field === 'duration') {
                value = parseInt(value) || 0;
            }
            pricingData[categoryKey].services[serviceIndex][field] = value;
        }

        function updateNominationFee(value) {
            pricingData.nomination.fee = parseInt(value) || 0;
        }

        function toggleServicePopular(categoryKey, serviceIndex) {
            pricingData[categoryKey].services[serviceIndex].popular = !pricingData[categoryKey].services[serviceIndex].popular;
            renderPricingForm();
        }

        function addNewService(categoryKey) {
            const newService = {
                duration: 60,
                price: 10000,
                name: '新しいサービス',
                description: 'サービスの説明',
                popular: false
            };
            pricingData[categoryKey].services.push(newService);
            renderPricingForm();
        }

        function removeService(categoryKey, serviceIndex) {
            if (confirm('このサービスを削除しますか？')) {
                pricingData[categoryKey].services.splice(serviceIndex, 1);
                renderPricingForm();
            }
        }

        function savePricingData() {
            alert('料金設定が保存されました');
            console.log('Pricing Data Saved:', pricingData);
        }

        function previewPricing() {
            // 料金表プレビュー（実装省略）
            alert('料金表プレビュー（実装予定）');
        }

        function exportReviews() {
            alert('レビューエクスポート機能（実装予定）');
        }

        // 顧客管理機能
        let customersData = [
            {
                id: 1,
                name: '田中太郎',
                email: 'tanaka@example.com',
                phone: '090-1234-5678',
                telegramId: '@tanaka_taro',
                registrationDate: '2024-01-15',
                lastVisit: '2024-03-10',
                totalVisits: 5,
                totalSpent: 125000,
                membershipStatus: 'premium',
                preferences: 'Aタイプ 90分',
                notes: '肩こりが酷い、強めの圧希望'
            },
            {
                id: 2,
                name: '佐藤花子',
                email: 'sato@example.com',
                phone: '080-9876-5432',
                telegramId: '@sato_hanako',
                registrationDate: '2024-02-01',
                lastVisit: '2024-03-08',
                totalVisits: 3,
                totalSpent: 75000,
                membershipStatus: 'regular',
                preferences: 'Mタイプ 120分',
                notes: 'アレルギー: ラベンダー'
            },
            {
                id: 3,
                name: '山田一郎',
                email: 'yamada@example.com',
                phone: '070-1111-2222',
                telegramId: '@yamada_ichiro',
                registrationDate: '2024-02-15',
                lastVisit: '2024-03-12',
                totalVisits: 8,
                totalSpent: 200000,
                membershipStatus: 'vip',
                preferences: 'ストレッチコース 60分',
                notes: '定期利用、月2回ペース'
            }
        ];

        function showCustomers() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = getCustomersHTML();
            renderCustomersList();
        }

        // 会員ランクシステム統合表示
        function showMembershipSystem() {
            showCustomers(); // 顧客管理と統合
        }

        function getCustomersHTML() {
            const membershipCounts = {
                regular: adminData.customers.filter(c => c.membershipRank === 'regular').length,
                bronze: adminData.customers.filter(c => c.membershipRank === 'bronze').length,
                silver: adminData.customers.filter(c => c.membershipRank === 'silver').length,
                gold: adminData.customers.filter(c => c.membershipRank === 'gold').length
            };

            return `
                <div class="admin-header">
                    <h1 class="admin-title">
                        <i class="fas fa-medal"></i>
                        顧客・会員ランク管理
                    </h1>
                    <p class="admin-subtitle">顧客情報と会員ランクシステムの統合管理</p>
                </div>

                <!-- 会員ランク統計 -->
                <div class="stats-grid" style="grid-template-columns: repeat(4, 1fr);">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value">${membershipCounts.regular}</div>
                                <div class="stat-label">通常会員</div>
                            </div>
                            <div class="stat-icon" style="color: #6b7280;">
                                <i class="fas fa-user"></i>
                            </div>
                        </div>
                        <div class="stat-description">0-4回利用 / 当日予約不可</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value">${membershipCounts.bronze}</div>
                                <div class="stat-label">ブロンズ会員</div>
                            </div>
                            <div class="stat-icon" style="color: #cd7f32;">
                                <i class="fas fa-medal"></i>
                            </div>
                        </div>
                        <div class="stat-description">5-14回利用 / 当日予約可能</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value">${membershipCounts.silver}</div>
                                <div class="stat-label">シルバー会員</div>
                            </div>
                            <div class="stat-icon" style="color: #c0c0c0;">
                                <i class="fas fa-medal"></i>
                            </div>
                        </div>
                        <div class="stat-description">15-49回利用 / 優先予約</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value">${membershipCounts.gold}</div>
                                <div class="stat-label">ゴールド会員</div>
                            </div>
                            <div class="stat-icon" style="color: #ffd700;">
                                <i class="fas fa-crown"></i>
                            </div>
                        </div>
                        <div class="stat-description">50回以上利用 / 最優先予約</div>
                    </div>
                </div>

                <!-- タブナビゲーション -->
                <div style="margin-bottom: var(--space-6);">
                    <div class="tab-navigation" style="display: flex; gap: var(--space-2); margin-bottom: var(--space-6);">
                        <button class="tab-button active" onclick="switchCustomerTab('normal')" id="normal-tab">
                            <i class="fas fa-users"></i>
                            通常顧客管理
                        </button>
                        <button class="tab-button" onclick="switchCustomerTab('ng')" id="ng-tab">
                            <i class="fas fa-user-slash"></i>
                            NG客管理
                        </button>
                    </div>
                </div>

                <!-- 通常顧客管理タブ -->
                <div id="normal-customers-tab" class="tab-content">
                    <!-- CSV機能とフィルター -->
                    <div class="admin-card">
                        <div class="admin-card-header">
                        <h3 class="admin-card-title">
                            <i class="fas fa-tools"></i>
                            顧客データ管理
                        </h3>
                    </div>
                    <div class="admin-card-content">
                        <div style="display: flex; gap: var(--space-4); flex-wrap: wrap; align-items: center; margin-bottom: var(--space-6);">
                            <!-- CSV エクスポート -->
                            <button onclick="exportCustomersCSV()" class="btn btn-success">
                                <i class="fas fa-download"></i>
                                CSVエクスポート
                            </button>
                            
                            <!-- CSV インポート -->
                            <div style="position: relative;">
                                <input type="file" id="csvImportFile" accept=".csv" style="display: none;" onchange="importCustomersCSV(event)">
                                <button onclick="document.getElementById('csvImportFile').click()" class="btn btn-secondary">
                                    <i class="fas fa-upload"></i>
                                    CSVインポート
                                </button>
                            </div>

                            <!-- 新規顧客追加 -->
                            <button onclick="showAddCustomerModal()" class="btn btn-primary">
                                <i class="fas fa-plus"></i>
                                新規顧客追加
                            </button>

                            <!-- フィルター -->
                            <select id="membershipFilter" onchange="filterCustomers()" style="padding: var(--space-3); border: 1px solid var(--admin-border); border-radius: var(--border-radius-small);">
                                <option value="">全ての会員ステータス</option>
                                <option value="regular">一般</option>
                                <option value="premium">プレミアム</option>
                                <option value="vip">VIP</option>
                            </select>

                            <!-- 検索 -->
                            <input type="text" id="customerSearch" placeholder="顧客名・メール・電話番号で検索" onkeyup="filterCustomers()" style="padding: var(--space-3); border: 1px solid var(--admin-border); border-radius: var(--border-radius-small); min-width: 200px;">
                        </div>

                        <!-- CSVテンプレートダウンロード -->
                        <div style="background: rgba(99, 102, 241, 0.05); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: var(--border-radius); padding: var(--space-4); margin-bottom: var(--space-6);">
                            <p style="margin: 0 0 var(--space-2); font-weight: 600; color: var(--admin-accent);">
                                <i class="fas fa-info-circle"></i>
                                CSVインポート用テンプレート
                            </p>
                            <p style="margin: 0 0 var(--space-3); font-size: 0.9rem; color: var(--text-secondary);">
                                CSVファイルの形式は以下の通りです。ヘッダー行を含めてください。
                            </p>
                            <button onclick="downloadCSVTemplate()" class="btn btn-outline btn-small">
                                <i class="fas fa-download"></i>
                                テンプレートダウンロード
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 顧客一覧 -->
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">
                            <i class="fas fa-list"></i>
                            顧客一覧
                        </h3>
                    </div>
                    <div class="admin-card-content">
                        <div class="table-container">
                            <table id="customers-table" style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: var(--admin-light-bg); border-bottom: 2px solid var(--admin-border);">
                                        <th style="padding: var(--space-4); text-align: left; font-weight: 600;">顧客名</th>
                                        <th style="padding: var(--space-4); text-align: left; font-weight: 600;">連絡先</th>
                                        <th style="padding: var(--space-4); text-align: left; font-weight: 600;">会員ステータス</th>
                                        <th style="padding: var(--space-4); text-align: left; font-weight: 600;">最終利用日</th>
                                        <th style="padding: var(--space-4); text-align: left; font-weight: 600;">利用回数</th>
                                        <th style="padding: var(--space-4); text-align: left; font-weight: 600;">総支払額</th>
                                        <th style="padding: var(--space-4); text-align: center; font-weight: 600;">操作</th>
                                    </tr>
                                </thead>
                                <tbody id="customers-tbody">
                                    <!-- 顧客データが動的に表示されます -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCustomersList() {
            updateCustomerStats();
            
            const tbody = document.getElementById('customers-tbody');
            const membershipFilter = document.getElementById('membershipFilter')?.value || '';
            const searchTerm = document.getElementById('customerSearch')?.value.toLowerCase() || '';
            
            let filteredCustomers = customersData;
            
            // フィルター適用
            if (membershipFilter) {
                filteredCustomers = filteredCustomers.filter(c => c.membershipStatus === membershipFilter);
            }
            
            if (searchTerm) {
                filteredCustomers = filteredCustomers.filter(c => 
                    c.name.toLowerCase().includes(searchTerm) ||
                    c.email.toLowerCase().includes(searchTerm) ||
                    c.phone.includes(searchTerm)
                );
            }
            
            tbody.innerHTML = filteredCustomers.map(customer => `
                <tr style="border-bottom: 1px solid var(--admin-border);">
                    <td style="padding: var(--space-4);">
                        <div style="font-weight: 600; color: var(--admin-primary);">${customer.name}</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">ID: ${customer.id}</div>
                    </td>
                    <td style="padding: var(--space-4);">
                        <div style="font-size: 0.9rem;">${customer.email}</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">${customer.phone}</div>
                        <div style="font-size: 0.85rem; color: var(--admin-accent);">${customer.telegramId}</div>
                    </td>
                    <td style="padding: var(--space-4);">
                        <span class="membership-badge ${customer.membershipStatus}">${getMembershipLabel(customer.membershipStatus)}</span>
                    </td>
                    <td style="padding: var(--space-4); font-size: 0.9rem;">${customer.lastVisit}</td>
                    <td style="padding: var(--space-4); text-align: center;">${customer.totalVisits}回</td>
                    <td style="padding: var(--space-4); font-weight: 600;">¥${customer.totalSpent.toLocaleString()}</td>
                    <td style="padding: var(--space-4); text-align: center;">
                        <button onclick="editCustomer(${customer.id})" class="btn btn-outline btn-small" style="margin-right: var(--space-2);">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteCustomer(${customer.id})" class="btn btn-danger btn-small">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function updateCustomerStats() {
            const totalCustomers = customersData.length;
            const activeCustomers = customersData.filter(c => {
                const lastVisit = new Date(c.lastVisit);
                const monthsAgo = new Date();
                monthsAgo.setMonth(monthsAgo.getMonth() - 3);
                return lastVisit > monthsAgo;
            }).length;
            const vipCustomers = customersData.filter(c => c.membershipStatus === 'vip').length;

            document.getElementById('total-customers').textContent = totalCustomers;
            document.getElementById('active-customers').textContent = activeCustomers;
            document.getElementById('vip-customers').textContent = vipCustomers;
        }

        function getMembershipLabel(status) {
            const labels = {
                'regular': '一般',
                'premium': 'プレミアム',
                'vip': 'VIP'
            };
            return labels[status] || status;
        }

        function filterCustomers() {
            renderCustomersList();
        }

        // CSVエクスポート機能
        function exportCustomersCSV() {
            const headers = [
                'ID', '顧客名', 'メールアドレス', '電話番号', 'Telegram ID', 
                '登録日', '最終利用日', '利用回数', '総支払額', '会員ステータス', 
                '希望コース', '備考'
            ];
            
            const csvContent = [
                headers.join(','),
                ...customersData.map(customer => [
                    customer.id,
                    `"${customer.name}"`,
                    `"${customer.email}"`,
                    `"${customer.phone}"`,
                    `"${customer.telegramId}"`,
                    customer.registrationDate,
                    customer.lastVisit,
                    customer.totalVisits,
                    customer.totalSpent,
                    customer.membershipStatus,
                    `"${customer.preferences}"`,
                    `"${customer.notes}"`
                ].join(','))
            ].join('\\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `customers_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // CSVインポート機能
        function importCustomersCSV(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csv = e.target.result;
                    const lines = csv.split('\\n');
                    const headers = lines[0].split(',');
                    
                    if (lines.length < 2) {
                        alert('CSVファイルにデータが含まれていません。');
                        return;
                    }

                    const importedData = [];
                    for (let i = 1; i < lines.length; i++) {
                        const line = lines[i].trim();
                        if (!line) continue;
                        
                        const values = parseCSVLine(line);
                        if (values.length >= 11) {
                            const customer = {
                                id: parseInt(values[0]) || customersData.length + i,
                                name: values[1].replace(/"/g, ''),
                                email: values[2].replace(/"/g, ''),
                                phone: values[3].replace(/"/g, ''),
                                telegramId: values[4].replace(/"/g, ''),
                                registrationDate: values[5],
                                lastVisit: values[6],
                                totalVisits: parseInt(values[7]) || 0,
                                totalSpent: parseInt(values[8]) || 0,
                                membershipStatus: values[9],
                                preferences: values[10].replace(/"/g, ''),
                                notes: values[11] ? values[11].replace(/"/g, '') : ''
                            };
                            importedData.push(customer);
                        }
                    }

                    if (importedData.length > 0) {
                        const confirmImport = confirm(`${importedData.length}件の顧客データをインポートします。既存のデータは追加されます。よろしいですか？`);
                        if (confirmImport) {
                            customersData = [...customersData, ...importedData];
                            renderCustomersList();
                            alert(`${importedData.length}件の顧客データをインポートしました。`);
                        }
                    } else {
                        alert('有効なデータが見つかりませんでした。CSVファイルの形式を確認してください。');
                    }
                } catch (error) {
                    alert('CSVファイルの読み込みに失敗しました。ファイル形式を確認してください。');
                    console.error('CSV Import Error:', error);
                }
            };
            reader.readAsText(file, 'UTF-8');
        }

        // CSVテンプレートダウンロード
        function downloadCSVTemplate() {
            const headers = [
                'ID', '顧客名', 'メールアドレス', '電話番号', 'Telegram ID', 
                '登録日', '最終利用日', '利用回数', '総支払額', '会員ステータス', 
                '希望コース', '備考'
            ];
            
            const sampleData = [
                '1', '田中太郎', 'tanaka@example.com', '090-1234-5678', '@tanaka_taro',
                '2024-01-15', '2024-03-10', '5', '125000', 'premium',
                'Aタイプ 90分', '肩こりが酷い、強めの圧希望'
            ];
            
            const csvContent = [
                headers.join(','),
                sampleData.join(',')
            ].join('\\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'customers_template.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // CSV行解析ヘルパー関数
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current);
            
            return result;
        }

        function editCustomer(id) {
            alert(`顧客ID ${id} の編集機能（実装予定）`);
        }

        function deleteCustomer(id) {
            if (confirm('この顧客を削除しますか？')) {
                customersData = customersData.filter(c => c.id !== id);
                renderCustomersList();
            }
        }

        function showAddCustomerModal() {
            alert('新規顧客追加機能（実装予定）');
        }

        // NG客管理表示
        function showNgCustomers() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header fade-in-up">
                    <h1 class="admin-title">
                        <i class="fas fa-user-slash"></i>
                        NG客管理
                    </h1>
                    <button class="btn btn-primary" onclick="showAddNgCustomerModal()">
                        <i class="fas fa-plus"></i>
                        NG客を追加
                    </button>
                </header>

                <div class="admin-content">
                    <div class="admin-card">
                        <div class="admin-card-header">
                            <h3>NG客一覧</h3>
                            <div class="admin-card-actions">
                                <input type="search" placeholder="名前・電話番号で検索..." style="padding: var(--space-2) var(--space-4); border: 1px solid var(--border-gray); border-radius: var(--radius-md); width: 300px;">
                            </div>
                        </div>
                        <div class="admin-card-content">
                            <div class="table-container">
                                <table class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>顧客名</th>
                                            <th>連絡先</th>
                                            <th>登録理由</th>
                                            <th>重要度</th>
                                            <th>登録日</th>
                                            <th>登録者</th>
                                            <th>アクション</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ng-customers-list">
                                        ${adminData.ngCustomers.map(customer => `
                                            <tr>
                                                <td><strong>${customer.name}</strong></td>
                                                <td>
                                                    <div>${customer.phone}</div>
                                                    <div style="color: var(--text-secondary); font-size: 0.9rem;">${customer.telegramId}</div>
                                                </td>
                                                <td>${customer.reason}</td>
                                                <td>
                                                    <span class="status-badge ${customer.severity === 'high' ? 'status-rejected' : customer.severity === 'medium' ? 'status-pending' : 'status-approved'}">
                                                        ${customer.severity === 'high' ? '高' : customer.severity === 'medium' ? '中' : '低'}
                                                    </span>
                                                </td>
                                                <td>${customer.dateAdded}</td>
                                                <td>${customer.addedBy}</td>
                                                <td>
                                                    <button class="btn btn-outline btn-small" onclick="viewNgCustomerDetails(${customer.id})">
                                                        詳細
                                                    </button>
                                                    <button class="btn btn-danger btn-small" onclick="removeNgCustomer(${customer.id})">
                                                        解除
                                                    </button>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // バック率設定表示
        function showBackRates() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header fade-in-up">
                    <h1 class="admin-title">
                        <i class="fas fa-percentage"></i>
                        バック率設定
                    </h1>
                    <button class="btn btn-primary" onclick="showBackRateModal()">
                        <i class="fas fa-edit"></i>
                        設定を変更
                    </button>
                </header>

                <div class="admin-content">
                    ${adminData.therapistBackRates.map(rate => `
                        <div class="admin-card" style="margin-bottom: var(--space-6);">
                            <div class="admin-card-header">
                                <h3>${rate.therapistName}</h3>
                                <div class="admin-card-actions">
                                    <span class="status-badge status-approved">基本 ${rate.baseBackRate}%</span>
                                </div>
                            </div>
                            <div class="admin-card-content">
                                <div class="grid grid-4" style="gap: var(--space-6);">
                                    <div class="metric-card">
                                        <div class="metric-header">
                                            <h4>基本バック率</h4>
                                            <i class="fas fa-percentage" style="color: var(--admin-accent);"></i>
                                        </div>
                                        <div class="metric-value">${rate.baseBackRate}%</div>
                                    </div>
                                    
                                    <div class="metric-card">
                                        <div class="metric-header">
                                            <h4>リピート客ボーナス</h4>
                                            <i class="fas fa-users" style="color: var(--admin-success);"></i>
                                        </div>
                                        <div class="metric-value">+${rate.performanceBonus.repeatCustomers}%</div>
                                    </div>
                                    
                                    <div class="metric-card">
                                        <div class="metric-header">
                                            <h4>高評価ボーナス</h4>
                                            <i class="fas fa-star" style="color: var(--admin-warning);"></i>
                                        </div>
                                        <div class="metric-value">+${rate.performanceBonus.highRating}%</div>
                                    </div>
                                    
                                    <div class="metric-card">
                                        <div class="metric-header">
                                            <h4>アップセルボーナス</h4>
                                            <i class="fas fa-arrow-up" style="color: var(--admin-primary);"></i>
                                        </div>
                                        <div class="metric-value">+${rate.performanceBonus.upselling}%</div>
                                    </div>
                                </div>
                                
                                <div style="margin-top: var(--space-6); padding: var(--space-4); background: var(--admin-light-bg); border-radius: var(--border-radius);">
                                    <h4 style="margin-bottom: var(--space-3);">月間目標・達成ボーナス</h4>
                                    <div class="grid grid-2" style="gap: var(--space-4);">
                                        <div>
                                            <strong>月間売上目標:</strong> ¥${rate.monthlyTarget.toLocaleString()}
                                        </div>
                                        <div>
                                            <strong>達成ボーナス:</strong> +${rate.achievementBonus}%
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // 支払管理表示
        function showPaymentManagement() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header fade-in-up">
                    <h1 class="admin-title">
                        <i class="fas fa-money-check-alt"></i>
                        支払管理
                    </h1>
                    <button class="btn btn-success" onclick="processPayments()">
                        <i class="fas fa-paper-plane"></i>
                        一括支払処理
                    </button>
                </header>

                <div class="admin-content">
                    ${adminData.paymentSchedules.map(schedule => `
                        <div class="admin-card" style="margin-bottom: var(--space-6);">
                            <div class="admin-card-header">
                                <h3>${schedule.therapistName}</h3>
                                <div class="admin-card-actions">
                                    <span class="status-badge ${schedule.paymentType === 'daily' ? 'status-approved' : 'status-pending'}">
                                        ${schedule.paymentType === 'daily' ? '日払い' : '週払い'}
                                    </span>
                                </div>
                            </div>
                            <div class="admin-card-content">
                                <div class="grid grid-3" style="gap: var(--space-6);">
                                    <div class="metric-card">
                                        <div class="metric-header">
                                            <h4>現在残高</h4>
                                            <i class="fas fa-wallet" style="color: var(--admin-success);"></i>
                                        </div>
                                        <div class="metric-value">¥${schedule.currentBalance.toLocaleString()}</div>
                                    </div>
                                    
                                    <div class="metric-card">
                                        <div class="metric-header">
                                            <h4>最終支払日</h4>
                                            <i class="fas fa-calendar" style="color: var(--admin-accent);"></i>
                                        </div>
                                        <div class="metric-value" style="font-size: 1rem;">${schedule.lastPayment.date}</div>
                                    </div>
                                    
                                    <div class="metric-card">
                                        <div class="metric-header">
                                            <h4>最終支払額</h4>
                                            <i class="fas fa-yen-sign" style="color: var(--admin-warning);"></i>
                                        </div>
                                        <div class="metric-value">¥${schedule.lastPayment.amount.toLocaleString()}</div>
                                    </div>
                                </div>
                                
                                <div style="margin-top: var(--space-6); padding: var(--space-4); background: var(--admin-light-bg); border-radius: var(--border-radius);">
                                    <h4 style="margin-bottom: var(--space-3);">口座情報</h4>
                                    <div class="grid grid-2" style="gap: var(--space-4); font-size: 0.9rem;">
                                        <div><strong>銀行:</strong> ${schedule.bankAccount.bankName}</div>
                                        <div><strong>支店:</strong> ${schedule.bankAccount.branchName}</div>
                                        <div><strong>口座番号:</strong> ${schedule.bankAccount.accountNumber}</div>
                                        <div><strong>口座名義:</strong> ${schedule.bankAccount.accountHolder}</div>
                                    </div>
                                </div>
                                
                                <div style="margin-top: var(--space-4); display: flex; gap: var(--space-3);">
                                    <button class="btn btn-success btn-small" onclick="payNow(${schedule.id})">
                                        今すぐ支払
                                    </button>
                                    <button class="btn btn-outline btn-small" onclick="viewPaymentHistory(${schedule.id})">
                                        支払履歴
                                    </button>
                                    <button class="btn btn-outline btn-small" onclick="editBankAccount(${schedule.id})">
                                        口座変更
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // キャスト売上表示
        function showTherapistSales() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header fade-in-up">
                    <h1 class="admin-title">
                        <i class="fas fa-chart-pie"></i>
                        キャスト売上管理
                    </h1>
                    <div class="admin-header-actions">
                        <select style="padding: var(--space-2) var(--space-4); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                            <option value="2024-06">2024年6月</option>
                            <option value="2024-05">2024年5月</option>
                            <option value="2024-04">2024年4月</option>
                        </select>
                    </div>
                </header>

                <div class="admin-content">
                    ${adminData.therapistSales.map(sales => {
                        const currentMonth = sales.monthlyData['2024-06'];
                        const lastMonth = sales.monthlyData['2024-05'];
                        const targetProgress = (currentMonth.totalSales / sales.currentMonthTarget * 100).toFixed(1);
                        
                        return `
                            <div class="admin-card" style="margin-bottom: var(--space-6);">
                                <div class="admin-card-header">
                                    <h3>${sales.therapistName}</h3>
                                    <div class="admin-card-actions">
                                        <span class="status-badge ${targetProgress >= 100 ? 'status-approved' : targetProgress >= 75 ? 'status-pending' : 'status-rejected'}">
                                            目標達成率 ${targetProgress}%
                                        </span>
                                    </div>
                                </div>
                                <div class="admin-card-content">
                                    <div class="grid grid-4" style="gap: var(--space-6); margin-bottom: var(--space-6);">
                                        <div class="metric-card">
                                            <div class="metric-header">
                                                <h4>今月売上</h4>
                                                <i class="fas fa-yen-sign" style="color: var(--admin-success);"></i>
                                            </div>
                                            <div class="metric-value">¥${currentMonth.totalSales.toLocaleString()}</div>
                                            <div class="metric-change" style="color: var(--admin-success);">
                                                目標: ¥${sales.currentMonthTarget.toLocaleString()}
                                            </div>
                                        </div>
                                        
                                        <div class="metric-card">
                                            <div class="metric-header">
                                                <h4>完了予約数</h4>
                                                <i class="fas fa-check-circle" style="color: var(--admin-accent);"></i>
                                            </div>
                                            <div class="metric-value">${currentMonth.completedBookings}件</div>
                                            <div class="metric-change">
                                                平均単価: ¥${currentMonth.averagePerBooking.toLocaleString()}
                                            </div>
                                        </div>
                                        
                                        <div class="metric-card">
                                            <div class="metric-header">
                                                <h4>リピート率</h4>
                                                <i class="fas fa-user-check" style="color: var(--admin-warning);"></i>
                                            </div>
                                            <div class="metric-value">${currentMonth.repeatCustomerRate}%</div>
                                            <div class="metric-change" style="color: ${currentMonth.repeatCustomerRate > lastMonth.repeatCustomerRate ? 'var(--admin-success)' : 'var(--admin-danger)'};">
                                                前月: ${lastMonth.repeatCustomerRate}%
                                            </div>
                                        </div>
                                        
                                        <div class="metric-card">
                                            <div class="metric-header">
                                                <h4>稼働率</h4>
                                                <i class="fas fa-calendar-check" style="color: var(--admin-primary);"></i>
                                            </div>
                                            <div class="metric-value">${currentMonth.workingDays}日</div>
                                            <div class="metric-change">
                                                日平均: ¥${currentMonth.dailyAverage.toLocaleString()}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div style="padding: var(--space-4); background: var(--admin-light-bg); border-radius: var(--border-radius);">
                                        <h4 style="margin-bottom: var(--space-3);">パフォーマンス詳細</h4>
                                        <div class="grid grid-3" style="gap: var(--space-4); font-size: 0.9rem;">
                                            <div><strong>アップセル成功:</strong> ${currentMonth.upsellCount}回</div>
                                            <div><strong>キャンセル率:</strong> ${currentMonth.cancellationRate}%</div>
                                            <div><strong>昨年同月比:</strong> +${sales.lastYearComparison}%</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        // 誕生日管理表示
        function showBirthdayManagement() {
            const content = document.querySelector('.admin-main');
            const today = new Date();
            const upcomingBirthdays = adminData.birthdays.filter(birthday => {
                const birthdayDate = new Date(birthday.birthday);
                birthdayDate.setFullYear(today.getFullYear());
                const daysUntil = Math.ceil((birthdayDate - today) / (1000 * 60 * 60 * 24));
                return daysUntil >= 0 && daysUntil <= birthday.notificationDays;
            });

            content.innerHTML = `
                <header class="admin-header fade-in-up">
                    <h1 class="admin-title">
                        <i class="fas fa-birthday-cake"></i>
                        誕生日管理
                    </h1>
                    <button class="btn btn-primary" onclick="showAddBirthdayModal()">
                        <i class="fas fa-plus"></i>
                        誕生日を追加
                    </button>
                </header>

                <div class="admin-content">
                    ${upcomingBirthdays.length > 0 ? `
                        <div class="admin-card" style="margin-bottom: var(--space-6); border-left: 4px solid var(--admin-warning);">
                            <div class="admin-card-header">
                                <h3>
                                    <i class="fas fa-bell" style="color: var(--admin-warning);"></i>
                                    近日中の誕生日
                                </h3>
                            </div>
                            <div class="admin-card-content">
                                ${upcomingBirthdays.map(birthday => {
                                    const birthdayDate = new Date(birthday.birthday);
                                    birthdayDate.setFullYear(today.getFullYear());
                                    const daysUntil = Math.ceil((birthdayDate - today) / (1000 * 60 * 60 * 24));
                                    
                                    return `
                                        <div style="padding: var(--space-4); background: rgba(245, 158, 11, 0.1); border-radius: var(--border-radius); margin-bottom: var(--space-3);">
                                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                                <div>
                                                    <strong>${birthday.name}</strong> (${birthday.type === 'therapist' ? 'スタッフ' : '顧客'})
                                                    <div style="font-size: 0.9rem; color: var(--text-secondary);">
                                                        ${birthday.birthday} (${birthday.age}歳) - あと${daysUntil}日
                                                    </div>
                                                </div>
                                                <button class="btn btn-warning btn-small" onclick="prepareBirthdayGift(${birthday.id})">
                                                    ギフト準備
                                                </button>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="admin-card">
                        <div class="admin-card-header">
                            <h3>誕生日一覧</h3>
                            <div class="admin-card-actions">
                                <select style="padding: var(--space-2) var(--space-4); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                                    <option value="all">全員</option>
                                    <option value="therapist">スタッフのみ</option>
                                    <option value="customer">顧客のみ</option>
                                </select>
                            </div>
                        </div>
                        <div class="admin-card-content">
                            <div class="table-container">
                                <table class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>名前</th>
                                            <th>タイプ</th>
                                            <th>誕生日</th>
                                            <th>年齢</th>
                                            <th>星座・血液型</th>
                                            <th>好み</th>
                                            <th>昨年のギフト</th>
                                            <th>アクション</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${adminData.birthdays.map(birthday => `
                                            <tr>
                                                <td><strong>${birthday.name}</strong></td>
                                                <td>
                                                    <span class="status-badge ${birthday.type === 'therapist' ? 'status-approved' : 'status-pending'}">
                                                        ${birthday.type === 'therapist' ? 'スタッフ' : '顧客'}
                                                    </span>
                                                </td>
                                                <td>${birthday.birthday}</td>
                                                <td>${birthday.age}歳</td>
                                                <td>
                                                    <div>${birthday.zodiacSign}</div>
                                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">${birthday.bloodType}</div>
                                                </td>
                                                <td>
                                                    ${birthday.preferences.map(pref => 
                                                        `<span style="background: rgba(99, 102, 241, 0.1); color: var(--admin-accent); padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; margin-right: 4px;">${pref}</span>`
                                                    ).join('')}
                                                </td>
                                                <td>
                                                    ${birthday.gifts && birthday.gifts.length > 0 ? 
                                                        `${birthday.gifts[birthday.gifts.length - 1].gift} (¥${birthday.gifts[birthday.gifts.length - 1].cost.toLocaleString()})` :
                                                        birthday.lastGift ? `${birthday.lastGift.gift} (¥${birthday.lastGift.cost.toLocaleString()})` : 
                                                        'なし'
                                                    }
                                                </td>
                                                <td>
                                                    <button class="btn btn-outline btn-small" onclick="editBirthday(${birthday.id})">
                                                        編集
                                                    </button>
                                                    <button class="btn btn-success btn-small" onclick="prepareBirthdayGift(${birthday.id})">
                                                        ギフト
                                                    </button>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // プレースホルダー関数群
        function showAddNgCustomerModal() { alert('NG客追加機能（実装予定）'); }
        function viewNgCustomerDetails(id) { alert(`NG客ID ${id} の詳細表示機能（実装予定）`); }
        function removeNgCustomer(id) { 
            if (confirm('このNG客を解除しますか？')) {
                alert('NG客解除機能（実装予定）'); 
            }
        }
        function showBackRateModal() { alert('バック率設定変更機能（実装予定）'); }
        function processPayments() { alert('一括支払処理機能（実装予定）'); }
        function payNow(id) { alert(`支払ID ${id} の即時支払機能（実装予定）`); }
        function viewPaymentHistory(id) { alert(`支払ID ${id} の履歴表示機能（実装予定）`); }
        function editBankAccount(id) { alert(`支払ID ${id} の口座編集機能（実装予定）`); }
        function showAddBirthdayModal() { alert('誕生日追加機能（実装予定）'); }
        function editBirthday(id) { alert(`誕生日ID ${id} の編集機能（実装予定）`); }
        function prepareBirthdayGift(id) { alert(`誕生日ID ${id} のギフト準備機能（実装予定）`); }

        // 現金売上管理表示
        function showCashManagement() {
            const content = document.querySelector('.admin-main');
            const todaySummary = adminData.salesSummary.daily['2024-06-15'];
            const monthlySummary = adminData.salesSummary.monthly['2024-06'];
            
            content.innerHTML = `
                <header class="admin-header fade-in-up">
                    <h1 class="admin-title">
                        <i class="fab fa-paypal"></i>
                        現金売上管理
                    </h1>
                    <div class="admin-header-actions">
                        <button class="btn btn-success" onclick="syncCashTransactions()">
                            <i class="fas fa-sync"></i>
                            同期更新
                        </button>
                        <button class="btn btn-outline" onclick="exportCashReport()">
                            <i class="fas fa-download"></i>
                            レポート出力
                        </button>
                    </div>
                </header>

                <div class="admin-content">
                    <!-- 現金決済設定状況 -->
                    <div class="admin-card" style="margin-bottom: var(--space-6); ${adminData.paypayIntegration.isEnabled ? 'border-left: 4px solid var(--admin-success)' : 'border-left: 4px solid var(--admin-danger)'};">
                        <div class="admin-card-header">
                            <h3>
                                <i class="fab fa-paypal" style="color: ${adminData.paypayIntegration.isEnabled ? 'var(--admin-success)' : 'var(--admin-danger)'};"></i>
                                現金決済状況
                            </h3>
                            <span class="status-badge ${adminData.paypayIntegration.isEnabled ? 'status-approved' : 'status-rejected'}">
                                ${adminData.paypayIntegration.isEnabled ? '連携中' : '未連携'}
                            </span>
                        </div>
                        <div class="admin-card-content">
                            <div class="grid grid-3" style="gap: var(--space-4);">
                                <div><strong>マーチャントID:</strong> ${adminData.paypayIntegration.merchantId}</div>
                                <div><strong>事業者名:</strong> ${adminData.paypayIntegration.businessAccount.accountName}</div>
                                <div><strong>アカウントID:</strong> ${adminData.paypayIntegration.businessAccount.accountId}</div>
                            </div>
                        </div>
                    </div>

                    <!-- 売上サマリー -->
                    <div class="grid grid-4" style="gap: var(--space-6); margin-bottom: var(--space-8);">
                        <div class="metric-card">
                            <div class="metric-header">
                                <h4>今日の売上</h4>
                                <i class="fas fa-yen-sign" style="color: var(--admin-success);"></i>
                            </div>
                            <div class="metric-value">¥${todaySummary.totalRevenue.toLocaleString()}</div>
                            <div class="metric-change">
                                手数料: ¥${todaySummary.totalFees.toLocaleString()}
                            </div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-header">
                                <h4>今日の純売上</h4>
                                <i class="fas fa-wallet" style="color: var(--admin-accent);"></i>
                            </div>
                            <div class="metric-value">¥${todaySummary.netRevenue.toLocaleString()}</div>
                            <div class="metric-change">
                                取引数: ${todaySummary.transactionCount}件
                            </div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-header">
                                <h4>今月売上</h4>
                                <i class="fas fa-chart-line" style="color: var(--admin-warning);"></i>
                            </div>
                            <div class="metric-value">¥${monthlySummary.totalRevenue.toLocaleString()}</div>
                            <div class="metric-change">
                                平均単価: ¥${monthlySummary.averageTransaction.toLocaleString()}
                            </div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-header">
                                <h4>現金手数料率</h4>
                                <i class="fas fa-percentage" style="color: var(--admin-primary);"></i>
                            </div>
                            <div class="metric-value">${((monthlySummary.totalFees / monthlySummary.totalRevenue) * 100).toFixed(1)}%</div>
                            <div class="metric-change">
                                月間手数料: ¥${monthlySummary.totalFees.toLocaleString()}
                            </div>
                        </div>
                    </div>

                    <!-- 取引履歴 -->
                    <div class="admin-card">
                        <div class="admin-card-header">
                            <h3>現金取引履歴</h3>
                            <div class="admin-card-actions">
                                <select style="padding: var(--space-2) var(--space-4); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                                    <option value="all">全ての取引</option>
                                    <option value="completed">完了</option>
                                    <option value="pending">処理中</option>
                                    <option value="failed">失敗</option>
                                </select>
                            </div>
                        </div>
                        <div class="admin-card-content">
                            <div class="table-container">
                                <table class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>取引ID</th>
                                            <th>顧客名</th>
                                            <th>担当セラピスト</th>
                                            <th>サービス</th>
                                            <th>金額</th>
                                            <th>手数料</th>
                                            <th>純売上</th>
                                            <th>取引日時</th>
                                            <th>ステータス</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${adminData.paypayTransactions.map(tx => `
                                            <tr>
                                                <td>
                                                    <div style="font-family: monospace; font-size: 0.9rem;">${tx.id}</div>
                                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">${tx.paypayData.transactionId.substring(0, 20)}...</div>
                                                </td>
                                                <td><strong>${tx.customerName}</strong></td>
                                                <td>${tx.therapistName}</td>
                                                <td>
                                                    <div>${tx.serviceType}</div>
                                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">${tx.location}</div>
                                                </td>
                                                <td><strong>¥${tx.amount.toLocaleString()}</strong></td>
                                                <td style="color: var(--admin-danger);">¥${tx.fee.toLocaleString()}</td>
                                                <td style="color: var(--admin-success);"><strong>¥${tx.netAmount.toLocaleString()}</strong></td>
                                                <td>
                                                    <div>${tx.transactionDate.split(' ')[0]}</div>
                                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">${tx.transactionDate.split(' ')[1]}</div>
                                                </td>
                                                <td>
                                                    <span class="status-badge ${tx.status === 'completed' ? 'status-approved' : tx.status === 'pending' ? 'status-pending' : 'status-rejected'}">
                                                        ${tx.status === 'completed' ? '完了' : tx.status === 'pending' ? '処理中' : '失敗'}
                                                    </span>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- セラピスト別売上 -->
                    <div class="admin-card" style="margin-top: var(--space-6);">
                        <div class="admin-card-header">
                            <h3>セラピスト別現金売上</h3>
                        </div>
                        <div class="admin-card-content">
                            <div class="grid grid-2" style="gap: var(--space-6);">
                                ${Object.entries(todaySummary.therapistPayouts).map(([therapistId, payout]) => {
                                    const therapist = adminData.therapists.find(t => t.id == therapistId);
                                    const transactions = adminData.paypayTransactions.filter(tx => tx.therapistId == therapistId);
                                    const totalAmount = transactions.reduce((sum, tx) => sum + tx.amount, 0);
                                    
                                    return `
                                        <div style="padding: var(--space-4); background: var(--admin-light-bg); border-radius: var(--border-radius);">
                                            <h4>${therapist ? therapist.name : 'セラピスト' + therapistId}</h4>
                                            <div class="grid grid-3" style="gap: var(--space-3); margin-top: var(--space-3); font-size: 0.9rem;">
                                                <div><strong>売上総額:</strong> ¥${totalAmount.toLocaleString()}</div>
                                                <div><strong>取引数:</strong> ${transactions.length}件</div>
                                                <div><strong>支払予定:</strong> ¥${payout.toLocaleString()}</div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // 現金決済関連機能のプレースホルダー
        function syncCashTransactions() {
            alert('現金取引同期機能（実装予定）\n\n実際の実装では：\n- 現金決済記録から最新取引を取得\n- 売上データを自動更新\n- セラピスト別支払額を計算');
        }

        function exportCashReport() {
            alert('現金レポート出力機能（実装予定）\n\n実際の実装では：\n- 期間指定でのレポート生成\n- CSV/PDF形式での出力\n- 税務申告用データの作成');
        }

        // 会員ランク自動計算関数
        function calculateMembershipRank(visits) {
            if (visits >= 50) return 'gold';
            if (visits >= 15) return 'silver';
            if (visits >= 5) return 'bronze';
            return 'regular';
        }

        // 当日予約可能かチェック
        function canBookSameDay(customer) {
            const rank = customer.membershipRank || calculateMembershipRank(customer.visits);
            return adminData.membershipSystem.ranks[rank].canBookSameDay;
        }

        // 支払い請求機能表示
        function showPaymentRequests() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header fade-in-up">
                    <h1 class="admin-title">
                        <i class="fas fa-qrcode"></i>
                        支払い請求・QRコード生成
                    </h1>
                    <div class="admin-header-actions">
                        <span class="status-badge ${adminData.paypayIntegration.isEnabled ? 'status-approved' : 'status-rejected'}">
                            現金決済 ${adminData.paypayIntegration.isEnabled ? '有効' : '無効'}
                        </span>
                    </div>
                </header>

                <div class="admin-content">
                    <!-- 手動請求作成 -->
                    <div class="admin-card" style="margin-bottom: var(--space-6);">
                        <div class="admin-card-header">
                            <h3>
                                <i class="fas fa-plus-circle"></i>
                                新規請求作成
                            </h3>
                        </div>
                        <div class="admin-card-content">
                            <div class="grid grid-2" style="gap: var(--space-6);">
                                <div>
                                    <label class="form-label">顧客選択</label>
                                    <select id="payment-customer" class="form-input" style="width: 100%;">
                                        <option value="">顧客を選択してください</option>
                                        ${adminData.customers.map(customer => 
                                            `<option value="${customer.id}">${customer.name} (${customer.membershipRank}会員)</option>`
                                        ).join('')}
                                    </select>
                                </div>
                                <div>
                                    <label class="form-label">担当セラピスト</label>
                                    <select id="payment-therapist" class="form-input" style="width: 100%;">
                                        <option value="">セラピストを選択してください</option>
                                        ${adminData.therapists.map(therapist => 
                                            `<option value="${therapist.id}">${therapist.name}</option>`
                                        ).join('')}
                                    </select>
                                </div>
                            </div>
                            
                            <div class="grid grid-3" style="gap: var(--space-6); margin-top: var(--space-6);">
                                <div>
                                    <label class="form-label">サービス内容</label>
                                    <input type="text" id="payment-service" class="form-input" placeholder="例：A-タイプ 90分" style="width: 100%;">
                                </div>
                                <div>
                                    <label class="form-label">請求金額（円）</label>
                                    <input type="number" id="payment-amount" class="form-input" placeholder="20000" min="1000" max="100000" style="width: 100%;">
                                </div>
                                <div>
                                    <label class="form-label">利用ホテル</label>
                                    <input type="text" id="payment-hotel" class="form-input" placeholder="例：グランドハイアット" style="width: 100%;">
                                </div>
                            </div>

                            <div style="margin-top: var(--space-6);">
                                <label class="form-label">備考・メモ</label>
                                <textarea id="payment-notes" class="form-input" rows="3" placeholder="特記事項があれば入力してください" style="width: 100%;"></textarea>
                            </div>

                            <div style="margin-top: var(--space-6); text-align: center;">
                                <button class="btn btn-success btn-large" onclick="generatePaymentQR()" style="padding: var(--space-4) var(--space-8);">
                                    <i class="fas fa-qrcode"></i>
                                    現金受付QRコード生成
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 定型サービス請求 -->
                    <div class="admin-card" style="margin-bottom: var(--space-6);">
                        <div class="admin-card-header">
                            <h3>
                                <i class="fas fa-list"></i>
                                定型サービス請求
                            </h3>
                        </div>
                        <div class="admin-card-content">
                            <div class="grid grid-3" style="gap: var(--space-6);">
                                ${adminData.services.map(service => `
                                    <div class="service-request-card">
                                        <h4>${service.name}</h4>
                                        <div class="service-price">¥${service.price.toLocaleString()}</div>
                                        <div class="service-description">${service.description}</div>
                                        <button class="btn btn-primary btn-small" onclick="quickPaymentRequest(${service.id}, '${service.name}', ${service.price})" style="margin-top: var(--space-3); width: 100%;">
                                            <i class="fas fa-qrcode"></i>
                                            QR生成
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- 生成されたQRコード表示エリア -->
                    <div id="qr-display-area" class="admin-card" style="display: none;">
                        <div class="admin-card-header">
                            <h3>
                                <i class="fas fa-qrcode"></i>
                                現金受付QRコード
                            </h3>
                            <button class="btn btn-outline btn-small" onclick="closeQRDisplay()">
                                <i class="fas fa-times"></i>
                                閉じる
                            </button>
                        </div>
                        <div class="admin-card-content">
                            <div class="grid grid-2" style="gap: var(--space-8); align-items: center;">
                                <div style="text-align: center;">
                                    <div id="qr-code-container" style="margin-bottom: var(--space-4);">
                                        <!-- QRコードがここに表示される -->
                                    </div>
                                    <p style="font-size: 0.9rem; color: var(--text-secondary);">
                                        QRコードで現金受付確認をしてください
                                    </p>
                                </div>
                                <div>
                                    <div id="payment-details" class="payment-summary">
                                        <!-- 支払い詳細がここに表示される -->
                                    </div>
                                    <div style="margin-top: var(--space-6);">
                                        <button class="btn btn-success" onclick="confirmPayment()" style="width: 100%;">
                                            <i class="fas fa-check"></i>
                                            支払い確認
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 最近の請求履歴 -->
                    <div class="admin-card">
                        <div class="admin-card-header">
                            <h3>
                                <i class="fas fa-history"></i>
                                最近の請求履歴
                            </h3>
                        </div>
                        <div class="admin-card-content">
                            <div class="table-container">
                                <table class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>請求日時</th>
                                            <th>顧客名</th>
                                            <th>サービス</th>
                                            <th>金額</th>
                                            <th>ステータス</th>
                                            <th>アクション</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${adminData.paypayTransactions.slice(0, 5).map(tx => `
                                            <tr>
                                                <td>${tx.transactionDate}</td>
                                                <td><strong>${tx.customerName}</strong></td>
                                                <td>${tx.serviceType}</td>
                                                <td><strong>¥${tx.amount.toLocaleString()}</strong></td>
                                                <td>
                                                    <span class="status-badge ${tx.status === 'completed' ? 'status-approved' : 'status-pending'}">
                                                        ${tx.status === 'completed' ? '完了' : '処理中'}
                                                    </span>
                                                </td>
                                                <td>
                                                    <button class="btn btn-outline btn-small" onclick="viewTransactionDetails('${tx.id}')">
                                                        詳細
                                                    </button>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // 現金受付QRコード生成（デモ版）
        function generatePaymentQR() {
            const customer = document.getElementById('payment-customer').value;
            const therapist = document.getElementById('payment-therapist').value;
            const service = document.getElementById('payment-service').value;
            const amount = document.getElementById('payment-amount').value;
            const hotel = document.getElementById('payment-hotel').value;
            const notes = document.getElementById('payment-notes').value;

            if (!customer || !amount || !service) {
                alert('顧客、金額、サービス内容は必須項目です。');
                return;
            }

            if (amount < 1000 || amount > 100000) {
                alert('金額は1,000円〜100,000円の範囲で入力してください。');
                return;
            }

            const customerData = adminData.customers.find(c => c.id == customer);
            const therapistData = adminData.therapists.find(t => t.id == therapist);

            // QRコード表示
            showQRCode({
                customer: customerData.name,
                therapist: therapistData ? therapistData.name : '未指定',
                service: service,
                amount: parseInt(amount),
                hotel: hotel,
                notes: notes
            });
        }

        // 定型サービス請求
        function quickPaymentRequest(serviceId, serviceName, price) {
            showQRCode({
                customer: '店頭決済',
                therapist: '未指定',
                service: serviceName,
                amount: price,
                hotel: '未指定',
                notes: '定型サービス請求'
            });
        }

        // QRコード表示
        function showQRCode(paymentData) {
            const qrArea = document.getElementById('qr-display-area');
            const qrContainer = document.getElementById('qr-code-container');
            const detailsContainer = document.getElementById('payment-details');

            // デモ用QRコード生成（実際は現金受付システムAPIを使用）
            qrContainer.innerHTML = `
                <div style="width: 200px; height: 200px; background: white; border: 2px solid #000; display: flex; align-items: center; justify-content: center; margin: 0 auto; border-radius: var(--radius-lg);">
                    <div style="text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: var(--space-2);">📱</div>
                        <div style="font-size: 0.8rem; font-weight: bold;">現金 QR</div>
                        <div style="font-size: 0.7rem; color: #666;">¥${paymentData.amount.toLocaleString()}</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: var(--space-3); font-size: 0.9rem; color: var(--text-secondary);">
                    ※実際の環境では本物のQRコードが生成されます
                </div>
            `;

            detailsContainer.innerHTML = `
                <div class="payment-detail-item">
                    <label>顧客名</label>
                    <value>${paymentData.customer}</value>
                </div>
                <div class="payment-detail-item">
                    <label>担当者</label>
                    <value>${paymentData.therapist}</value>
                </div>
                <div class="payment-detail-item">
                    <label>サービス</label>
                    <value>${paymentData.service}</value>
                </div>
                <div class="payment-detail-item">
                    <label>金額</label>
                    <value><strong>¥${paymentData.amount.toLocaleString()}</strong></value>
                </div>
                ${paymentData.hotel ? `
                    <div class="payment-detail-item">
                        <label>利用ホテル</label>
                        <value>${paymentData.hotel}</value>
                    </div>
                ` : ''}
                ${paymentData.notes ? `
                    <div class="payment-detail-item">
                        <label>備考</label>
                        <value>${paymentData.notes}</value>
                    </div>
                ` : ''}
            `;

            qrArea.style.display = 'block';
            qrArea.scrollIntoView({ behavior: 'smooth' });
        }

        // QRコード表示を閉じる
        function closeQRDisplay() {
            document.getElementById('qr-display-area').style.display = 'none';
        }

        // 支払い確認
        function confirmPayment() {
            if (confirm('支払いが完了しましたか？')) {
                alert('支払いが確認されました。\n\n実際の環境では：\n- 現金受付システムで自動確認\n- 売上データに自動反映\n- 顧客履歴に記録');
                closeQRDisplay();
                
                // フォームをリセット
                ['payment-customer', 'payment-therapist', 'payment-service', 'payment-amount', 'payment-hotel', 'payment-notes'].forEach(id => {
                    document.getElementById(id).value = '';
                });
            }
        }

        // 取引詳細表示
        function viewTransactionDetails(transactionId) {
            const transaction = adminData.paypayTransactions.find(tx => tx.id === transactionId);
            if (transaction) {
                alert(`取引詳細\\n\\n取引ID: ${transaction.id}\\n顧客: ${transaction.customerName}\\nサービス: ${transaction.serviceType}\\n金額: ¥${transaction.amount.toLocaleString()}\\nステータス: ${transaction.status}\\n\\n※実際の環境では詳細画面を表示`);
            }
        }

        // スタッフ総合管理（バック率設定 + 誕生日管理 + スタッフ管理統合）
        function showStaffManagement() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header fade-in-up">
                    <h1 class="admin-title">
                        <i class="fas fa-user-friends"></i>
                        スタッフ総合管理
                    </h1>
                </header>

                <div class="admin-content">
                    <!-- タブナビゲーション -->
                    <div style="margin-bottom: var(--space-6);">
                        <div class="tab-navigation" style="display: flex; gap: var(--space-2);">
                            <button class="tab-button active" onclick="switchStaffTab('therapists')" id="therapists-tab">
                                <i class="fas fa-user-friends"></i>
                                スタッフ一覧
                            </button>
                            <button class="tab-button" onclick="switchStaffTab('rates')" id="rates-tab">
                                <i class="fas fa-percentage"></i>
                                バック率設定
                            </button>
                            <button class="tab-button" onclick="switchStaffTab('birthdays')" id="birthdays-tab">
                                <i class="fas fa-birthday-cake"></i>
                                誕生日管理
                            </button>
                        </div>
                    </div>

                    <!-- スタッフ一覧タブ -->
                    <div id="therapists-staff-tab" class="tab-content">
                        <div class="grid" style="gap: var(--space-6);">
                            ${adminData.therapists.map(therapist => `
                                <div class="admin-card">
                                    <div class="admin-card-header">
                                        <h3>${therapist.name}</h3>
                                        <span class="status-badge status-approved">${therapist.status}</span>
                                    </div>
                                    <div class="admin-card-content">
                                        <p><strong>専門:</strong> ${therapist.specialty}</p>
                                        <p>${therapist.description}</p>
                                        <div style="margin-top: var(--space-4);">
                                            <button class="btn btn-outline btn-small">編集</button>
                                            <button class="btn btn-primary btn-small">スケジュール</button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- バック率設定タブ -->
                    <div id="rates-staff-tab" class="tab-content" style="display: none;">
                        ${adminData.therapistBackRates.map(rate => `
                            <div class="admin-card" style="margin-bottom: var(--space-6);">
                                <div class="admin-card-header">
                                    <h3>${rate.therapistName}</h3>
                                    <span class="status-badge status-approved">基本 ${rate.baseBackRate}%</span>
                                </div>
                                <div class="admin-card-content">
                                    <div class="grid grid-4" style="gap: var(--space-6);">
                                        <div class="metric-card">
                                            <div class="metric-header">
                                                <h4>基本バック率</h4>
                                                <i class="fas fa-percentage" style="color: var(--admin-accent);"></i>
                                            </div>
                                            <div class="metric-value">${rate.baseBackRate}%</div>
                                        </div>
                                        <div class="metric-card">
                                            <div class="metric-header">
                                                <h4>リピート客ボーナス</h4>
                                                <i class="fas fa-users" style="color: var(--admin-success);"></i>
                                            </div>
                                            <div class="metric-value">+${rate.performanceBonus.repeatCustomers}%</div>
                                        </div>
                                        <div class="metric-card">
                                            <div class="metric-header">
                                                <h4>高評価ボーナス</h4>
                                                <i class="fas fa-star" style="color: var(--admin-warning);"></i>
                                            </div>
                                            <div class="metric-value">+${rate.performanceBonus.highRating}%</div>
                                        </div>
                                        <div class="metric-card">
                                            <div class="metric-header">
                                                <h4>アップセルボーナス</h4>
                                                <i class="fas fa-arrow-up" style="color: var(--admin-primary);"></i>
                                            </div>
                                            <div class="metric-value">+${rate.performanceBonus.upselling}%</div>
                                        </div>
                                    </div>
                                    <div style="margin-top: var(--space-4);">
                                        <button class="btn btn-primary btn-small">設定変更</button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <!-- 誕生日管理タブ -->
                    <div id="birthdays-staff-tab" class="tab-content" style="display: none;">
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <h3>誕生日一覧</h3>
                                <button class="btn btn-primary" onclick="showAddBirthdayModal()">
                                    <i class="fas fa-plus"></i>
                                    誕生日追加
                                </button>
                            </div>
                            <div class="admin-card-content">
                                <div class="table-container">
                                    <table class="admin-table">
                                        <thead>
                                            <tr>
                                                <th>名前</th>
                                                <th>タイプ</th>
                                                <th>誕生日</th>
                                                <th>年齢</th>
                                                <th>好み</th>
                                                <th>昨年のギフト</th>
                                                <th>アクション</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${adminData.birthdays.map(birthday => `
                                                <tr>
                                                    <td><strong>${birthday.name}</strong></td>
                                                    <td>
                                                        <span class="status-badge ${birthday.type === 'therapist' ? 'status-approved' : 'status-pending'}">
                                                            ${birthday.type === 'therapist' ? 'スタッフ' : '顧客'}
                                                        </span>
                                                    </td>
                                                    <td>${birthday.birthday}</td>
                                                    <td>${birthday.age}歳</td>
                                                    <td>
                                                        ${birthday.preferences.map(pref => 
                                                            `<span style="background: rgba(99, 102, 241, 0.1); color: var(--admin-accent); padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; margin-right: 4px;">${pref}</span>`
                                                        ).join('')}
                                                    </td>
                                                    <td>
                                                        ${birthday.gifts && birthday.gifts.length > 0 ? 
                                                            `${birthday.gifts[birthday.gifts.length - 1].gift} (¥${birthday.gifts[birthday.gifts.length - 1].cost.toLocaleString()})` :
                                                            birthday.lastGift ? `${birthday.lastGift.gift} (¥${birthday.lastGift.cost.toLocaleString()})` : 
                                                            'なし'
                                                        }
                                                    </td>
                                                    <td>
                                                        <button class="btn btn-outline btn-small" onclick="editBirthday(${birthday.id})">編集</button>
                                                        <button class="btn btn-success btn-small" onclick="prepareBirthdayGift(${birthday.id})">ギフト</button>
                                                    </td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // 財務管理（支払管理 + キャスト売上 + 現金売上統合）
        function showFinancialManagement() {
            const content = document.querySelector('.admin-main');
            const todaySummary = adminData.salesSummary.daily['2024-06-15'];
            const monthlySummary = adminData.salesSummary.monthly['2024-06'];
            
            content.innerHTML = `
                <header class="admin-header fade-in-up">
                    <h1 class="admin-title">
                        <i class="fas fa-chart-line"></i>
                        財務管理
                    </h1>
                </header>

                <div class="admin-content">
                    <!-- タブナビゲーション -->
                    <div style="margin-bottom: var(--space-6);">
                        <div class="tab-navigation" style="display: flex; gap: var(--space-2);">
                            <button class="tab-button active" onclick="switchFinancialTab('overview')" id="overview-tab">
                                <i class="fas fa-chart-pie"></i>
                                売上概要
                            </button>
                            <button class="tab-button" onclick="switchFinancialTab('paypay')" id="paypay-tab">
                                <i class="fab fa-paypal"></i>
                                現金売上
                            </button>
                            <button class="tab-button" onclick="switchFinancialTab('payments')" id="payments-tab">
                                <i class="fas fa-money-check-alt"></i>
                                支払管理
                            </button>
                            <button class="tab-button" onclick="switchFinancialTab('therapist-sales')" id="therapist-sales-tab">
                                <i class="fas fa-user-check"></i>
                                キャスト別売上
                            </button>
                        </div>
                    </div>

                    <!-- 売上概要タブ -->
                    <div id="overview-financial-tab" class="tab-content">
                        <div class="grid grid-4" style="gap: var(--space-6); margin-bottom: var(--space-8);">
                            <div class="metric-card">
                                <div class="metric-header">
                                    <h4>今日の売上</h4>
                                    <i class="fas fa-yen-sign" style="color: var(--admin-success);"></i>
                                </div>
                                <div class="metric-value">¥${todaySummary.totalRevenue.toLocaleString()}</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-header">
                                    <h4>今月売上</h4>
                                    <i class="fas fa-chart-line" style="color: var(--admin-warning);"></i>
                                </div>
                                <div class="metric-value">¥${monthlySummary.totalRevenue.toLocaleString()}</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-header">
                                    <h4>手数料</h4>
                                    <i class="fas fa-percentage" style="color: var(--admin-danger);"></i>
                                </div>
                                <div class="metric-value">¥${monthlySummary.totalFees.toLocaleString()}</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-header">
                                    <h4>純売上</h4>
                                    <i class="fas fa-wallet" style="color: var(--admin-accent);"></i>
                                </div>
                                <div class="metric-value">¥${monthlySummary.netRevenue.toLocaleString()}</div>
                            </div>
                        </div>
                    </div>

                    <!-- 現金売上タブ -->
                    <div id="paypay-financial-tab" class="tab-content" style="display: none;">
                        <!-- 現金売上詳細はshowCashManagement()の内容を簡略化 -->
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <h3>現金取引履歴</h3>
                            </div>
                            <div class="admin-card-content">
                                <div class="table-container">
                                    <table class="admin-table">
                                        <thead>
                                            <tr>
                                                <th>取引日時</th>
                                                <th>顧客名</th>
                                                <th>金額</th>
                                                <th>手数料</th>
                                                <th>純売上</th>
                                                <th>ステータス</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${adminData.paypayTransactions.map(tx => `
                                                <tr>
                                                    <td>${tx.transactionDate}</td>
                                                    <td><strong>${tx.customerName}</strong></td>
                                                    <td>¥${tx.amount.toLocaleString()}</td>
                                                    <td style="color: var(--admin-danger);">¥${tx.fee.toLocaleString()}</td>
                                                    <td style="color: var(--admin-success);">¥${tx.netAmount.toLocaleString()}</td>
                                                    <td>
                                                        <span class="status-badge ${tx.status === 'completed' ? 'status-approved' : 'status-pending'}">
                                                            ${tx.status === 'completed' ? '完了' : '処理中'}
                                                        </span>
                                                    </td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 支払管理タブ -->
                    <div id="payments-financial-tab" class="tab-content" style="display: none;">
                        ${adminData.paymentSchedules.map(schedule => `
                            <div class="admin-card" style="margin-bottom: var(--space-6);">
                                <div class="admin-card-header">
                                    <h3>${schedule.therapistName}</h3>
                                    <span class="status-badge ${schedule.paymentType === 'daily' ? 'status-approved' : 'status-pending'}">
                                        ${schedule.paymentType === 'daily' ? '日払い' : '週払い'}
                                    </span>
                                </div>
                                <div class="admin-card-content">
                                    <div class="grid grid-3" style="gap: var(--space-6);">
                                        <div class="metric-card">
                                            <div class="metric-header">
                                                <h4>現在残高</h4>
                                                <i class="fas fa-wallet" style="color: var(--admin-success);"></i>
                                            </div>
                                            <div class="metric-value">¥${schedule.currentBalance.toLocaleString()}</div>
                                        </div>
                                        <div class="metric-card">
                                            <div class="metric-header">
                                                <h4>最終支払日</h4>
                                                <i class="fas fa-calendar" style="color: var(--admin-accent);"></i>
                                            </div>
                                            <div class="metric-value" style="font-size: 1rem;">${schedule.lastPayment.date}</div>
                                        </div>
                                        <div class="metric-card">
                                            <div class="metric-header">
                                                <h4>最終支払額</h4>
                                                <i class="fas fa-yen-sign" style="color: var(--admin-warning);"></i>
                                            </div>
                                            <div class="metric-value">¥${schedule.lastPayment.amount.toLocaleString()}</div>
                                        </div>
                                    </div>
                                    <div style="margin-top: var(--space-4);">
                                        <button class="btn btn-success btn-small" onclick="payNow(${schedule.id})">今すぐ支払</button>
                                        <button class="btn btn-outline btn-small" onclick="viewPaymentHistory(${schedule.id})">支払履歴</button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <!-- キャスト別売上タブ -->
                    <div id="therapist-sales-financial-tab" class="tab-content" style="display: none;">
                        ${adminData.therapistSales.map(sales => {
                            const currentMonth = sales.monthlyData['2024-06'];
                            const targetProgress = (currentMonth.totalSales / sales.currentMonthTarget * 100).toFixed(1);
                            
                            return `
                                <div class="admin-card" style="margin-bottom: var(--space-6);">
                                    <div class="admin-card-header">
                                        <h3>${sales.therapistName}</h3>
                                        <span class="status-badge ${targetProgress >= 100 ? 'status-approved' : targetProgress >= 75 ? 'status-pending' : 'status-rejected'}">
                                            目標達成率 ${targetProgress}%
                                        </span>
                                    </div>
                                    <div class="admin-card-content">
                                        <div class="grid grid-4" style="gap: var(--space-6);">
                                            <div class="metric-card">
                                                <div class="metric-header">
                                                    <h4>今月売上</h4>
                                                    <i class="fas fa-yen-sign" style="color: var(--admin-success);"></i>
                                                </div>
                                                <div class="metric-value">¥${currentMonth.totalSales.toLocaleString()}</div>
                                            </div>
                                            <div class="metric-card">
                                                <div class="metric-header">
                                                    <h4>完了予約数</h4>
                                                    <i class="fas fa-check-circle" style="color: var(--admin-accent);"></i>
                                                </div>
                                                <div class="metric-value">${currentMonth.completedBookings}件</div>
                                            </div>
                                            <div class="metric-card">
                                                <div class="metric-header">
                                                    <h4>リピート率</h4>
                                                    <i class="fas fa-user-check" style="color: var(--admin-warning);"></i>
                                                </div>
                                                <div class="metric-value">${currentMonth.repeatCustomerRate}%</div>
                                            </div>
                                            <div class="metric-card">
                                                <div class="metric-header">
                                                    <h4>稼働日数</h4>
                                                    <i class="fas fa-calendar-check" style="color: var(--admin-primary);"></i>
                                                </div>
                                                <div class="metric-value">${currentMonth.workingDays}日</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        // コンテンツ管理統合
        function showContentManagement() {
            alert('コンテンツ管理機能（実装予定）\\n\\n- CMS管理\\n- ホテル管理\\n- レビュー管理\\n- ニュースレター\\n- コラム管理\\nを統合した画面を表示します');
        }

        // タブ切り替え関数群
        function switchCustomerTab(tab) {
            // 顧客管理のタブ切り替え
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
            
            if (tab === 'normal') {
                document.getElementById('normal-tab').classList.add('active');
                document.getElementById('normal-customers-tab').style.display = 'block';
            } else if (tab === 'ng') {
                document.getElementById('ng-tab').classList.add('active');
                document.getElementById('ng-customers-tab').style.display = 'block';
            }
        }

        function switchStaffTab(tab) {
            // スタッフ管理のタブ切り替え
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
            
            document.getElementById(tab + '-tab').classList.add('active');
            document.getElementById(tab + '-staff-tab').style.display = 'block';
        }

        function switchFinancialTab(tab) {
            // 財務管理のタブ切り替え
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
            
            document.getElementById(tab + '-tab').classList.add('active');
            document.getElementById(tab + '-financial-tab').style.display = 'block';
        }

        // バナー表示管理機能
        function togglePromotionBanner(promoId) {
            const promo = adminData.promotions.find(p => p.id === promoId);
            if (!promo) return;

            promo.showOnHomeBanner = !promo.showOnHomeBanner;
            
            // バナー表示の確認メッセージ
            if (promo.showOnHomeBanner) {
                alert(`「${promo.title}」をホームページバナーに表示しました。\n\nバナーテキスト: ${promo.bannerText}\n\n※ 実際のホームページに反映されます。`);
            } else {
                alert(`「${promo.title}」のホームページバナー表示を停止しました。`);
            }
            
            // 画面を更新
            showPromotions();
        }

        // バナープレビュー更新
        function updateBannerPreview() {
            const text = document.getElementById('promo-banner-text').value || '🌟 夏の疲れを癒そう！90分コース20%OFF実施中！';
            const color = document.getElementById('promo-banner-color').value || '#ff6b6b';
            const preview = document.getElementById('banner-preview');
            
            if (preview) {
                preview.style.background = color;
                preview.textContent = text;
            }
        }

        // カラーピッカーとテキストフィールドの同期
        document.addEventListener('DOMContentLoaded', function() {
            const colorPicker = document.getElementById('promo-banner-color');
            const colorText = document.getElementById('promo-banner-color-text');
            const bannerText = document.getElementById('promo-banner-text');
            
            if (colorPicker) {
                colorPicker.addEventListener('change', function() {
                    if (colorText) colorText.value = this.value;
                    updateBannerPreview();
                });
            }
            
            if (bannerText) {
                bannerText.addEventListener('input', updateBannerPreview);
            }
        });

        // プロモーション保存機能を更新
        function savePromotion() {
            const title = document.getElementById('promo-title').value;
            const description = document.getElementById('promo-description').value;
            const discount = document.getElementById('promo-discount').value;
            const type = document.getElementById('promo-type').value;
            const startDate = document.getElementById('promo-start').value;
            const endDate = document.getElementById('promo-end').value;
            const showBanner = document.getElementById('promo-show-banner').checked;
            const bannerText = document.getElementById('promo-banner-text').value;
            const bannerColor = document.getElementById('promo-banner-color').value;

            if (!title || !description || !discount || !startDate || !endDate) {
                alert('すべての必須項目を入力してください');
                return;
            }

            const newPromo = {
                id: adminData.promotions.length + 1,
                title: title,
                description: description,
                discount: parseFloat(discount),
                discountType: type,
                startDate: startDate,
                endDate: endDate,
                status: 'active',
                usageCount: 0,
                showOnHomeBanner: showBanner,
                bannerText: bannerText || `🌟 ${title}`,
                bannerColor: bannerColor || '#ff6b6b'
            };

            adminData.promotions.push(newPromo);
            alert('キャンペーンを保存しました');
            showPromotions();
        }

        // コンテンツ管理統合
        function showContentManagement() {
            const content = document.querySelector('.admin-main');
            content.innerHTML = `
                <header class="admin-header">
                    <h1 class="admin-title">コンテンツ管理システム</h1>
                    <div style="display: flex; gap: var(--space-3);">
                        <button class="btn btn-primary" onclick="addHotelImage()">
                            <i class="fas fa-image"></i> ホテル画像追加
                        </button>
                        <button class="btn btn-secondary" onclick="exportContentData()">
                            <i class="fas fa-download"></i> データエクスポート
                        </button>
                    </div>
                </header>

                <div class="tab-navigation">
                    <button class="tab-button active" id="services-cms-tab" onclick="switchContentTab('services')">
                        <i class="fas fa-spa"></i> 施術内容管理
                    </button>
                    <button class="tab-button" id="hotels-cms-tab" onclick="switchContentTab('hotels')">
                        <i class="fas fa-hotel"></i> ホテル管理
                    </button>
                    <button class="tab-button" id="campaigns-cms-tab" onclick="switchContentTab('campaigns')">
                        <i class="fas fa-bullhorn"></i> キャンペーン管理
                    </button>
                    <button class="tab-button" id="reviews-cms-tab" onclick="switchContentTab('reviews')">
                        <i class="fas fa-star"></i> レビュー管理
                    </button>
                    <button class="tab-button" id="newsletter-cms-tab" onclick="switchContentTab('newsletter')">
                        <i class="fas fa-envelope"></i> ニュースレター
                    </button>
                    <button class="tab-button" id="blog-cms-tab" onclick="switchContentTab('blog')">
                        <i class="fas fa-blog"></i> コラム管理
                    </button>
                    <button class="tab-button" id="safety-cms-tab" onclick="switchContentTab('safety')">
                        <i class="fas fa-shield-virus"></i> 感染対策機器
                    </button>
                </div>

                <!-- 施術内容管理タブ -->
                <div class="tab-content" id="services-content-tab" style="display: block;">
                    <div class="admin-card">
                        <div class="admin-card-header">
                            <h3 class="admin-card-title">施術内容・コース管理</h3>
                            <button class="btn btn-primary" onclick="addNewService()">
                                <i class="fas fa-plus"></i> 新規サービス追加
                            </button>
                        </div>
                        <div class="admin-card-content">
                            ${renderServicesCMS()}
                        </div>
                    </div>
                </div>

                <!-- ホテル管理タブ -->
                <div class="tab-content" id="hotels-content-tab" style="display: none;">
                    <div class="admin-card">
                        <div class="admin-card-header">
                            <h3 class="admin-card-title">対応可能ホテル一覧</h3>
                            <button class="btn btn-primary" onclick="addNewHotel()">
                                <i class="fas fa-plus"></i> 新規ホテル追加
                            </button>
                        </div>
                        <div class="admin-card-content">
                            ${renderHotelsCMS()}
                        </div>
                    </div>
                </div>

                <!-- キャンペーン管理タブ -->
                <div class="tab-content" id="campaigns-content-tab" style="display: none;">
                    <div class="admin-card">
                        <div class="admin-card-header">
                            <h3 class="admin-card-title">バナー表示中のキャンペーン</h3>
                        </div>
                        <div class="admin-card-content">
                            ${renderActiveBanners()}
                        </div>
                    </div>
                </div>

                <!-- レビュー管理タブ -->
                <div class="tab-content" id="reviews-content-tab" style="display: none;">
                    <div class="admin-card">
                        <div class="admin-card-header">
                            <h3 class="admin-card-title">顧客レビュー管理</h3>
                        </div>
                        <div class="admin-card-content">
                            ${renderReviewsCMS()}
                        </div>
                    </div>
                </div>

                <!-- ニュースレター管理タブ -->
                <div class="tab-content" id="newsletter-content-tab" style="display: none;">
                    <div class="admin-card">
                        <div class="admin-card-header">
                            <h3 class="admin-card-title">一斉配信管理</h3>
                        </div>
                        <div class="admin-card-content">
                            ${renderNewsletterCMS()}
                        </div>
                    </div>
                </div>

                <!-- コラム管理タブ -->
                <div class="tab-content" id="blog-content-tab" style="display: none;">
                    <div class="admin-card">
                        <div class="admin-card-header">
                            <h3 class="admin-card-title">健康コラム管理</h3>
                        </div>
                        <div class="admin-card-content">
                            ${renderBlogCMS()}
                        </div>
                    </div>
                </div>

                <!-- 感染対策機器管理タブ -->
                <div class="tab-content" id="safety-content-tab" style="display: none;">
                    <div class="admin-card">
                        <div class="admin-card-header">
                            <h3 class="admin-card-title">医療機器・感染対策機器管理</h3>
                            <button class="btn btn-primary" onclick="addNewMedicalEquipment()">
                                <i class="fas fa-plus"></i> 新規機器追加
                            </button>
                        </div>
                        <div class="admin-card-content">
                            ${renderMedicalEquipmentCMS()}
                        </div>
                    </div>
                </div>
            `;
        }

        // CMSタブ切り替え
        function switchContentTab(tab) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
            
            document.getElementById(tab + '-cms-tab').classList.add('active');
            document.getElementById(tab + '-content-tab').style.display = 'block';
        }

        // ホテル管理CMS
        function renderHotelsCMS() {
            return `
                <div style="display: grid; gap: var(--space-4);">
                    ${adminData.hotels.map(hotel => `
                        <div style="border: 1px solid var(--border-gray); border-radius: var(--radius-lg); padding: var(--space-4);">
                            <div style="display: grid; grid-template-columns: 200px 1fr auto; gap: var(--space-4); align-items: center;">
                                <div style="aspect-ratio: 16/9; background: var(--light-gray); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; font-size: 0.9rem; color: var(--text-secondary); position: relative; overflow: hidden;">
                                    ${hotel.imageUrl ? `<img src="${hotel.imageUrl}" style="width: 100%; height: 100%; object-fit: cover;">` : '<i class="fas fa-image"></i> 横長画像'}
                                    <button onclick="uploadHotelImage(${hotel.id})" style="position: absolute; top: 4px; right: 4px; background: rgba(0,0,0,0.7); color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 0.7rem;">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>
                                <div>
                                    <h4 style="margin: 0 0 var(--space-2); font-weight: 600;">${hotel.name}</h4>
                                    <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: var(--space-1);">
                                        <i class="fas fa-map-marker-alt"></i> ${hotel.area} | 
                                        <i class="fas fa-eye"></i> ${hotel.visits}回利用
                                    </div>
                                    <div style="font-size: 0.8rem; color: var(--text-muted);">
                                        更新: ${hotel.lastUpdate || '2024-06-15'}
                                    </div>
                                </div>
                                <div style="display: flex; flex-direction: column; gap: var(--space-2);">
                                    <button class="btn btn-small" onclick="editHotel(${hotel.id})">
                                        <i class="fas fa-edit"></i> 編集
                                    </button>
                                    <button class="btn btn-small btn-danger" onclick="deleteHotel(${hotel.id})">
                                        <i class="fas fa-trash"></i> 削除
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderActiveBanners() {
            const activeBanners = adminData.promotions.filter(p => p.showOnHomeBanner && p.status === 'active');
            if (activeBanners.length === 0) {
                return '<div style="text-align: center; padding: var(--space-8); color: var(--text-secondary);">現在バナー表示中のキャンペーンはありません</div>';
            }
            
            return activeBanners.map(promo => `
                <div style="margin-bottom: var(--space-4); padding: var(--space-4); border: 1px solid var(--border-gray); border-radius: var(--radius-lg);">
                    <div style="margin-bottom: var(--space-3);">
                        <h4 style="margin: 0; color: var(--text-primary);">${promo.title}</h4>
                    </div>
                    <div style="background: ${promo.bannerColor}; color: white; padding: var(--space-3); border-radius: var(--radius-md); text-align: center; font-weight: 600; margin-bottom: var(--space-3);">
                        ${promo.bannerText}
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">
                            期間: ${promo.startDate} - ${promo.endDate} | 利用回数: ${promo.usageCount}回
                        </div>
                        <button class="btn btn-small btn-danger" onclick="togglePromotionBanner(${promo.id})">
                            <i class="fas fa-eye-slash"></i> バナー停止
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function renderReviewsCMS() {
            return `
                <div style="display: grid; gap: var(--space-3);">
                    ${adminData.reviews.map(review => `
                        <div style="border: 1px solid var(--border-gray); border-radius: var(--radius-lg); padding: var(--space-4);">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--space-3);">
                                <div>
                                    <h4 style="margin: 0 0 var(--space-1);">${review.customerName}</h4>
                                    <div style="color: var(--text-secondary); font-size: 0.9rem;">${review.service} | ${review.date}</div>
                                </div>
                                <div style="display: flex; align-items: center; gap: var(--space-2);">
                                    <div style="color: #fbbf24;">
                                        ${'★'.repeat(review.rating)}${'☆'.repeat(5-review.rating)}
                                    </div>
                                    <span class="status-badge status-${review.status === 'approved' ? 'approved' : 'pending'}">
                                        ${review.status === 'approved' ? '承認済み' : '承認待ち'}
                                    </span>
                                </div>
                            </div>
                            <p style="margin-bottom: var(--space-3); color: var(--text-secondary);">${review.comment}</p>
                            <div style="display: flex; gap: var(--space-2);">
                                <button class="btn btn-small" onclick="approveReview(${review.id})">承認</button>
                                <button class="btn btn-small btn-danger" onclick="rejectReview(${review.id})">非承認</button>
                                <button class="btn btn-small" onclick="editReview(${review.id})">編集</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderNewsletterCMS() {
            return `
                <div style="display: grid; gap: var(--space-4);">
                    <div style="background: var(--light-gray); padding: var(--space-4); border-radius: var(--radius-lg);">
                        <h4 style="margin-bottom: var(--space-3);">クイック配信</h4>
                        <div style="display: grid; gap: var(--space-3);">
                            <input type="text" id="quick-title" placeholder="件名" style="padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                            <textarea id="quick-content" rows="4" placeholder="メッセージ内容" style="padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);"></textarea>
                            <select id="quick-recipients" style="padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                                <option value="all">全会員</option>
                                <option value="active">アクティブ会員</option>
                                <option value="vip">VIP会員</option>
                            </select>
                            <button class="btn btn-primary" onclick="sendQuickNewsletter()">
                                <i class="fas fa-paper-plane"></i> 一斉配信
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <h4 style="margin-bottom: var(--space-3);">配信履歴</h4>
                        ${adminData.newsletters.map(newsletter => `
                            <div style="border: 1px solid var(--border-gray); border-radius: var(--radius-lg); padding: var(--space-3); margin-bottom: var(--space-2);">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <h5 style="margin: 0;">${newsletter.title}</h5>
                                        <div style="font-size: 0.9rem; color: var(--text-secondary);">
                                            ${newsletter.sentAt} | ${newsletter.recipients}名に配信
                                        </div>
                                    </div>
                                    <span class="status-badge status-approved">${newsletter.status === 'sent' ? '配信済み' : '下書き'}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderBlogCMS() {
            return `
                <div style="display: grid; gap: var(--space-4);">
                    <div style="background: var(--light-gray); padding: var(--space-4); border-radius: var(--radius-lg);">
                        <h4 style="margin-bottom: var(--space-3);">新規コラム作成</h4>
                        <div style="display: grid; gap: var(--space-3);">
                            <input type="text" id="blog-title" placeholder="コラムタイトル" style="padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);">
                            <textarea id="blog-content" rows="8" placeholder="コラム内容..." style="padding: var(--space-3); border: 1px solid var(--border-gray); border-radius: var(--radius-md);"></textarea>
                            <div style="display: flex; gap: var(--space-2);">
                                <button class="btn btn-outline" onclick="saveBlogDraft()">
                                    <i class="fas fa-save"></i> 下書き保存
                                </button>
                                <button class="btn btn-secondary" onclick="previewBlog()">
                                    <i class="fas fa-eye"></i> プレビュー
                                </button>
                                <button class="btn btn-primary" onclick="publishBlog()">
                                    <i class="fas fa-globe"></i> 公開
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ホテル管理関数
        function uploadHotelImage(hotelId) {
            const hotel = adminData.hotels.find(h => h.id === hotelId);
            if (!hotel) return;

            const imageUrl = prompt('画像URLを入力してください（横長の画像推奨 16:9 アスペクト比）:', hotel.imageUrl || '');
            if (imageUrl !== null) {
                hotel.imageUrl = imageUrl;
                hotel.lastUpdate = new Date().toISOString().split('T')[0];
                alert('ホテル画像を更新しました');
                showContentManagement();
            }
        }

        function addNewHotel() {
            const name = prompt('ホテル名を入力してください:');
            if (!name) return;
            
            const area = prompt('エリアを入力してください:', '中洲');
            if (!area) return;

            const newHotel = {
                id: adminData.hotels.length + 1,
                name: name,
                area: area,
                visits: 0,
                imageUrl: '',
                lastUpdate: new Date().toISOString().split('T')[0]
            };

            adminData.hotels.push(newHotel);
            alert('新しいホテルを追加しました');
            showContentManagement();
        }

        function editHotel(hotelId) {
            const hotel = adminData.hotels.find(h => h.id === hotelId);
            if (!hotel) return;

            const newName = prompt('ホテル名:', hotel.name);
            if (newName && newName !== hotel.name) {
                hotel.name = newName;
                hotel.lastUpdate = new Date().toISOString().split('T')[0];
                alert('ホテル情報を更新しました');
                showContentManagement();
            }
        }

        function deleteHotel(hotelId) {
            if (confirm('このホテルを削除してもよろしいですか？')) {
                const index = adminData.hotels.findIndex(h => h.id === hotelId);
                if (index !== -1) {
                    adminData.hotels.splice(index, 1);
                    alert('ホテルを削除しました');
                    showContentManagement();
                }
            }
        }

        // 施術内容管理CMS
        function renderServicesCMS() {
            return `
                <div style="display: grid; gap: var(--space-4);">
                    ${adminData.services.map(service => `
                        <div style="border: 1px solid var(--border-gray); border-radius: var(--radius-lg); padding: var(--space-6); ${service.popular ? 'border-left: 4px solid #ffd700;' : ''}">
                            <div style="display: flex; justify-content: between; align-items: start; margin-bottom: var(--space-4);">
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-2);">
                                        <h3 style="margin: 0; font-weight: 700; color: var(--text-primary);">${service.name}</h3>
                                        ${service.popular ? '<span style="background: linear-gradient(135deg, #ffd700, #ffed4e); color: #92400e; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: 600;"><i class="fas fa-star"></i> 人気</span>' : ''}
                                    </div>
                                    <p style="margin: 0 0 var(--space-3); color: var(--text-secondary); font-weight: 500;">${service.subtitle}</p>
                                    <p style="margin: 0 0 var(--space-4); color: var(--text-secondary); line-height: 1.6;">${service.description}</p>
                                    
                                    <div style="display: flex; flex-wrap: wrap; gap: var(--space-2); margin-bottom: var(--space-4);">
                                        ${service.tags.map(tag => `
                                            <span style="background: var(--light-gray); color: var(--text-primary); padding: var(--space-1) var(--space-3); border-radius: var(--radius-full); font-size: 0.85rem; font-weight: 500;">
                                                #${tag}
                                            </span>
                                        `).join('')}
                                    </div>
                                    
                                    <div style="background: var(--light-gray); padding: var(--space-4); border-radius: var(--radius-md); margin-bottom: var(--space-4);">
                                        <h4 style="margin: 0 0 var(--space-3); font-size: 1rem; color: var(--text-primary);">
                                            <i class="fas fa-yen-sign"></i> 料金設定
                                        </h4>
                                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: var(--space-3);">
                                            ${Object.entries(service.pricing).map(([duration, price]) => `
                                                <div style="text-align: center; padding: var(--space-2); background: white; border-radius: var(--radius-md);">
                                                    <div style="font-weight: 600; color: var(--text-primary);">${duration}</div>
                                                    <div style="font-size: 1.1rem; font-weight: 700; color: var(--accent-purple);">¥${price.toLocaleString()}</div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="display: flex; flex-direction: column; gap: var(--space-2); margin-left: var(--space-4);">
                                    <button class="btn btn-small" onclick="editService(${service.id})">
                                        <i class="fas fa-edit"></i> 編集
                                    </button>
                                    <button class="btn btn-small ${service.popular ? 'btn-danger' : 'btn-primary'}" onclick="toggleServicePopular(${service.id})">
                                        <i class="fas fa-${service.popular ? 'star-half-alt' : 'star'}"></i>
                                        ${service.popular ? '人気解除' : '人気設定'}
                                    </button>
                                    <button class="btn btn-small btn-danger" onclick="deleteService(${service.id})">
                                        <i class="fas fa-trash"></i> 削除
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // 施術内容管理関数
        function addNewService() {
            const name = prompt('サービス名を入力してください:');
            if (!name) return;
            
            const subtitle = prompt('サブタイトルを入力してください:', '新しいサービス');
            const description = prompt('詳細説明を入力してください:', 'サービスの詳細説明をここに入力');
            const tags = prompt('タグをカンマ区切りで入力してください:', '新サービス,おすすめ');

            const newService = {
                id: adminData.services.length + 1,
                name: name,
                subtitle: subtitle || '新しいサービス',
                description: description || 'サービスの詳細説明',
                tags: tags ? tags.split(',').map(t => t.trim()) : ['新サービス'],
                duration: ['60分'],
                pricing: { '60分': 30000 },
                popular: false,
                status: 'active'
            };

            adminData.services.push(newService);
            alert('新しいサービスを追加しました');
            showContentManagement();
        }

        function editService(serviceId) {
            const service = adminData.services.find(s => s.id === serviceId);
            if (!service) return;

            const newName = prompt('サービス名:', service.name);
            if (newName && newName !== service.name) {
                service.name = newName;
            }

            const newSubtitle = prompt('サブタイトル:', service.subtitle);
            if (newSubtitle && newSubtitle !== service.subtitle) {
                service.subtitle = newSubtitle;
            }

            const newDescription = prompt('詳細説明:', service.description);
            if (newDescription && newDescription !== service.description) {
                service.description = newDescription;
            }

            const newTags = prompt('タグ（カンマ区切り）:', service.tags.join(', '));
            if (newTags) {
                service.tags = newTags.split(',').map(t => t.trim());
            }

            alert('サービス情報を更新しました');
            showContentManagement();
        }

        function toggleServicePopular(serviceId) {
            const service = adminData.services.find(s => s.id === serviceId);
            if (!service) return;

            service.popular = !service.popular;
            alert(`「${service.name}」の人気設定を${service.popular ? '有効' : '無効'}にしました`);
            showContentManagement();
        }

        function deleteService(serviceId) {
            if (confirm('このサービスを削除してもよろしいですか？')) {
                const index = adminData.services.findIndex(s => s.id === serviceId);
                if (index !== -1) {
                    adminData.services.splice(index, 1);
                    alert('サービスを削除しました');
                    showContentManagement();
                }
            }
        }

        // 医療機器管理CMS
        function renderMedicalEquipmentCMS() {
            return `
                <div style="display: grid; gap: var(--space-4);">
                    ${adminData.medicalEquipment.map(equipment => `
                        <div style="border: 1px solid var(--border-gray); border-radius: var(--radius-lg); padding: var(--space-6); ${equipment.medicalGrade ? 'border-left: 4px solid #10b981;' : ''}">
                            <div style="display: grid; grid-template-columns: 200px 1fr auto; gap: var(--space-6); align-items: start;">
                                <div style="aspect-ratio: 4/3; background: var(--light-gray); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; font-size: 0.9rem; color: var(--text-secondary); position: relative; overflow: hidden;">
                                    ${equipment.imageUrl ? `<img src="${equipment.imageUrl}" style="width: 100%; height: 100%; object-fit: cover;" alt="${equipment.name}">` : '<i class="fas fa-image"></i> 機器画像'}
                                    <button onclick="uploadEquipmentImage(${equipment.id})" style="position: absolute; top: 4px; right: 4px; background: rgba(0,0,0,0.7); color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 0.7rem;">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>
                                
                                <div>
                                    <div style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-2);">
                                        <h3 style="margin: 0; font-weight: 700; color: var(--text-primary);">${equipment.name}</h3>
                                        ${equipment.medicalGrade ? '<span style="background: linear-gradient(135deg, #10b981, #34d399); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: 600;"><i class="fas fa-certificate"></i> 医療認定</span>' : ''}
                                    </div>
                                    <div style="background: rgba(16, 185, 129, 0.1); color: #059669; padding: var(--space-1) var(--space-3); border-radius: var(--radius-full); font-size: 0.8rem; font-weight: 600; display: inline-block; margin-bottom: var(--space-3);">
                                        ${equipment.category}
                                    </div>
                                    <p style="margin: 0 0 var(--space-4); color: var(--text-secondary); line-height: 1.6;">${equipment.description}</p>
                                    
                                    <div style="background: var(--light-gray); padding: var(--space-3); border-radius: var(--radius-md); margin-bottom: var(--space-3);">
                                        <h4 style="margin: 0 0 var(--space-2); font-size: 0.9rem; color: var(--text-primary);">
                                            <i class="fas fa-check-circle"></i> 主要機能・特徴
                                        </h4>
                                        <div style="display: flex; flex-wrap: wrap; gap: var(--space-1);">
                                            ${equipment.features.map(feature => `
                                                <span style="background: white; color: var(--text-primary); padding: var(--space-1) var(--space-2); border-radius: var(--radius-md); font-size: 0.8rem;">
                                                    • ${feature}
                                                </span>
                                            `).join('')}
                                        </div>
                                    </div>
                                    
                                    <div style="font-size: 0.85rem; color: var(--text-muted); background: rgba(59, 130, 246, 0.05); padding: var(--space-2); border-radius: var(--radius-md);">
                                        <strong>仕様:</strong> ${equipment.specifications}
                                    </div>
                                </div>
                                
                                <div style="display: flex; flex-direction: column; gap: var(--space-2);">
                                    <button class="btn btn-small" onclick="editMedicalEquipment(${equipment.id})">
                                        <i class="fas fa-edit"></i> 編集
                                    </button>
                                    <button class="btn btn-small ${equipment.medicalGrade ? 'btn-danger' : 'btn-primary'}" onclick="toggleMedicalGrade(${equipment.id})">
                                        <i class="fas fa-${equipment.medicalGrade ? 'certificate' : 'plus-circle'}"></i>
                                        ${equipment.medicalGrade ? '認定解除' : '医療認定'}
                                    </button>
                                    <button class="btn btn-small btn-danger" onclick="deleteMedicalEquipment(${equipment.id})">
                                        <i class="fas fa-trash"></i> 削除
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // 医療機器管理関数
        function uploadEquipmentImage(equipmentId) {
            const equipment = adminData.medicalEquipment.find(e => e.id === equipmentId);
            if (!equipment) return;

            const imageUrl = prompt('機器画像URLを入力してください:', equipment.imageUrl || '');
            if (imageUrl !== null) {
                equipment.imageUrl = imageUrl;
                alert('機器画像を更新しました');
                showContentManagement();
            }
        }

        function addNewMedicalEquipment() {
            const name = prompt('機器名を入力してください:');
            if (!name) return;
            
            const category = prompt('カテゴリを入力してください:', '消毒システム');
            const description = prompt('詳細説明を入力してください:', '機器の詳細説明');

            const newEquipment = {
                id: adminData.medicalEquipment.length + 1,
                name: name,
                category: category || '消毒システム',
                description: description || '機器の詳細説明',
                imageUrl: '',
                features: ['高品質', '安全性確保'],
                specifications: '仕様詳細',
                medicalGrade: false,
                status: 'active'
            };

            adminData.medicalEquipment.push(newEquipment);
            alert('新しい医療機器を追加しました');
            showContentManagement();
        }

        function editMedicalEquipment(equipmentId) {
            const equipment = adminData.medicalEquipment.find(e => e.id === equipmentId);
            if (!equipment) return;

            const newName = prompt('機器名:', equipment.name);
            if (newName && newName !== equipment.name) {
                equipment.name = newName;
            }

            const newDescription = prompt('詳細説明:', equipment.description);
            if (newDescription && newDescription !== equipment.description) {
                equipment.description = newDescription;
            }

            const newSpecifications = prompt('仕様:', equipment.specifications);
            if (newSpecifications && newSpecifications !== equipment.specifications) {
                equipment.specifications = newSpecifications;
            }

            alert('機器情報を更新しました');
            showContentManagement();
        }

        function toggleMedicalGrade(equipmentId) {
            const equipment = adminData.medicalEquipment.find(e => e.id === equipmentId);
            if (!equipment) return;

            equipment.medicalGrade = !equipment.medicalGrade;
            alert(`「${equipment.name}」の医療認定を${equipment.medicalGrade ? '有効' : '無効'}にしました`);
            showContentManagement();
        }

        function deleteMedicalEquipment(equipmentId) {
            if (confirm('この医療機器を削除してもよろしいですか？')) {
                const index = adminData.medicalEquipment.findIndex(e => e.id === equipmentId);
                if (index !== -1) {
                    adminData.medicalEquipment.splice(index, 1);
                    alert('医療機器を削除しました');
                    showContentManagement();
                }
            }
        }
    </script>
    <style>
        .membership-badge {
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .membership-badge.regular {
            background: rgba(107, 114, 128, 0.1);
            color: #6b7280;
        }
        
        .membership-badge.premium {
            background: rgba(99, 102, 241, 0.1);
            color: var(--admin-accent);
        }
        
        .membership-badge.vip {
            background: rgba(245, 158, 11, 0.1);
            color: var(--admin-warning);
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        #customers-table th,
        #customers-table td {
            white-space: nowrap;
        }
        
        @media (max-width: 768px) {
            #customers-table {
                font-size: 0.85rem;
            }
            
            #customers-table th,
            #customers-table td {
                padding: var(--space-2) !important;
            }
        }
    </style>
</body>
</html>